"use strict";const e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-rate")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-rate/components/uni-rate/uni-rate.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const t=e.defineComponent({__name:"add-review",setup(t){const n=e.ref(null),a=e.ref(""),o=e.reactive({companyName:"",rating:0,cons:"",city:"",address:""}),i=e.ref(!1),s=async()=>{if(o.companyName?0===o.rating?(e.index.showToast({title:"请选择评分",icon:"none"}),0):o.cons?o.city||(e.index.showToast({title:"请选城市",icon:"none"}),0):(e.index.showToast({title:"请填写评价",icon:"none"}),0):(e.index.showToast({title:"请输入标题",icon:"none"}),0))try{i.value=!0,await c(o),e.index.showToast({title:"提交成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),1e3)}catch(t){e.index.showToast({title:"提交失败",icon:"error"})}finally{i.value=!1}},c=async t=>{const n=(t=>{const n=JSON.stringify(t);return e.CryptoJS.AES.encrypt(n,"your-secret-key-here").toString()})(t),a=await e.Ys.callFunction({name:"addCompanyReview",data:{encryptedData:n}});if(0!==a.result.code)throw new Error(a.result.message);return a.result},r=e.ref([]),u=e.ref([]),l=e.ref(""),d=async()=>{try{const{result:t}=await e.Ys.callFunction({name:"getCityList"});0===t.code&&(r.value=t.data)}catch(t){e.index.showToast({title:"获取省份失败",icon:"none"})}},m=async()=>{try{0===r.value.length&&await d(),n.value.open()}catch(t){console.error("城市选择错误:",t),e.index.showToast({title:"获取城市列表失败",icon:"none"})}},p=async t=>{l.value=t.name,await(async t=>{try{const{result:n}=await e.Ys.callFunction({name:"getCityList",data:{province:t}});0===n.code&&(u.value=n.data)}catch(n){e.index.showToast({title:"获取城市失败",icon:"none"})}})(t.code)},y=()=>{a.value?(o.city=a.value,v()):e.index.showToast({title:"请选择城市",icon:"none"})},v=()=>{n.value.close(),a.value=""};e.onMounted((async()=>{await d()}));const h=e.index.getSystemInfoSync().statusBarHeight,w=()=>{e.index.navigateBack()},f=()=>{e.index.showToast({title:"已保存草稿",icon:"success"})},g=e.ref("default");return e.onMounted((()=>{(()=>{try{const t=e.index.getStorageSync("theme");t&&(g.value=t)}catch(t){console.error("获取主题失败:",t)}})()})),(t,c)=>({a:e.o(w),b:e.o(f),c:e.unref(h)+"px",d:o.companyName,e:e.o((e=>o.companyName=e.detail.value)),f:e.o((e=>o.rating=e)),g:e.p({size:30,value:o.rating,modelValue:o.rating}),h:o.cons,i:e.o((e=>o.cons=e.detail.value)),j:e.t(o.city||"请选择城市"),k:e.o(m),l:o.address,m:e.o((e=>o.address=e.detail.value)),n:i.value,o:e.o(s),p:e.unref(h)+88+"rpx",q:e.n(`theme-${g.value}`),r:e.o(v),s:e.o(y),t:e.f(r.value,((t,n,a)=>({a:e.t(t.name),b:t.code,c:l.value===t.name?1:"",d:e.o((e=>p(t)),t.code)}))),v:e.f(u.value,((t,n,o)=>({a:e.t(t.name),b:t.code,c:a.value===t.name?1:"",d:e.o((e=>(e=>{a.value=e.name})(t)),t.code)}))),w:e.sr(n,"1e5eacf0-1",{k:"cityPopup"}),x:e.p({type:"bottom"})})}});qq.createPage(t);
