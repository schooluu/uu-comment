"use strict";const e=require("../../../common/vendor.js");if(!Array){e.resolveComponent("uni-rate")()}Math;const t=e.defineComponent({__name:"detail",setup(t){const a=e.ref(null),n=e.ref([]),o=e.ref(0),i=e.ref(""),l=e.index.getSystemInfoSync().statusBarHeight,u=e.ref("default"),s=()=>{e.index.navigateBack()},d=()=>{e.index.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},r=async t=>{try{const{result:a}=await e.Ys.callFunction({name:"getCompanyComments",data:{companyId:t}});0===a.code&&(n.value=a.data)}catch(a){e.index.showToast({title:"获取评论失败",icon:"none"})}},c=async()=>{try{e.index.showLoading({title:"发表中..."});const{result:t}=await e.Ys.callFunction({name:"addCompanyComment",data:{companyId:a.value._id,content:i.value,rating:o.value}});0===t.code&&(e.index.showToast({title:"评论成功"}),i.value="",o.value=0,await r(a.value._id)),e.index.hideLoading()}catch(t){e.index.showToast({title:"评论失败",icon:"none"})}},v=e=>{const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`};return e.onMounted((()=>{const t=e.index.getStorageSync("theme");t&&(u.value=t);const n=getCurrentPages(),o=n[n.length-1].options.id;o&&((async t=>{e.index.showLoading({title:"加载中..."});try{const{result:n}=await e.Ys.callFunction({name:"getCompanyDetail",data:{id:t}});0===n.code&&(a.value=n.data)}catch(n){e.index.showToast({title:"获取详情失败",icon:"none"})}finally{e.index.hideLoading()}})(o),r(o))})),(t,r)=>e.e({a:e.o(s),b:e.o(d),c:e.unref(l)+"px",d:a.value},a.value?{e:e.t(a.value.companyName),f:e.p({value:a.value.rating,size:"15"}),g:e.t(a.value.reviewCount||0),h:e.t(a.value.viewCount||0),i:e.t(a.value.address)}:{},{j:a.value},a.value?{k:e.t(a.value.cons)}:{},{l:e.t(n.value.length),m:e.f(n.value,((t,a,n)=>({a:e.t(t.userName||"匿名用户"),b:"3312192e-1-"+n,c:e.p({value:t.rating,size:"15"}),d:e.t(v(t.createdAt)),e:e.t(t.content),f:t._id}))),n:e.o((e=>o.value=e)),o:e.p({size:"20",modelValue:o.value}),p:e.o(c),q:i.value,r:e.o((e=>i.value=e.detail.value)),s:e.o(c),t:e.unref(l)+88+"rpx",v:e.n(`theme-${u.value}`)})}});qq.createPage(t);
