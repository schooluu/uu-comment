"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/assets.js");if(!Array){(e.resolveComponent("uni-rate")+e.resolveComponent("uni-popup"))()}Math||(t+(()=>"../../../uni_modules/uni-rate/components/uni-rate/uni-rate.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const t=()=>"../../../components/comment/CompanySkeleton.js",n=e.defineComponent({__name:"index",setup(t){const n=e.ref([]),o=e.ref(""),l=e.ref(null),s=e.ref(1),i=e.ref(!0),u=e.ref(!1),c=e.ref(""),r=e.ref([]),d=e.ref([]),v=e.ref(""),p=e.index.getSystemInfoSync().statusBarHeight,m=e=>{const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},f=async(a=1,t=!1)=>{t||(u.value=!0);try{const{result:l}=await e.Ys.callFunction({name:"getCompanyList",data:{page:a,pageSize:10,keyword:o.value,city:c.value}});if(0===l.code){const e=l.data.map((e=>({...e,isExpanded:!1})));t?n.value=[...n.value,...e]:setTimeout((()=>{n.value=e,u.value=!1}),500),i.value=10===l.data.length,s.value=a}}catch(l){e.index.showToast({title:"获取数据失败",icon:"none"}),u.value=!1}},h=()=>{n.value=[],s.value=1,i.value=!0,f(1)},g=()=>{h()},x=()=>{o.value="",h()},y=()=>{e.index.navigateTo({url:"/pages/comment/add/add-review"})};e.onMounted((()=>{e.index.getStorageSync("hasShownDisclaimer")||l.value.open(),f()}));const w=()=>{e.index.setStorageSync("hasShownDisclaimer",!0),l.value.close()},S=e.ref(null),C=()=>{S.value.open()},T=()=>{S.value.close()},b=()=>{e.index.setClipboardData({data:"962723968@qq.com",success:()=>{e.index.showToast({title:"邮箱已复制",icon:"success"})}})};e.onReachBottom((()=>{(async()=>{i.value&&!u.value&&await f(s.value+1,!0)})()})),e.onMounted((()=>{f()}));const _=()=>{e.index.showActionSheet({itemList:r.value.map((e=>e.name)),success:async a=>{const t=r.value[a.tapIndex];v.value=t.name,await(async a=>{try{const{result:t}=await e.Ys.callFunction({name:"getCityList",data:{province:a}});0===t.code&&(d.value=t.data)}catch(t){e.index.showToast({title:"获取城市失败",icon:"none"})}})(t.code),e.index.showActionSheet({itemList:d.value.map((e=>e.name)),success:e=>{c.value=d.value[e.tapIndex].name,h()}})}})};e.onMounted((async()=>{await(async()=>{try{const{result:a}=await e.Ys.callFunction({name:"getCityList"});0===a.code&&(r.value=a.data)}catch(a){e.index.showToast({title:"获取省份失败",icon:"none"})}})(),f()}));const q=e=>e.length>100,M=e.ref(0),$=e.ref(0),j=e.ref(0),L=()=>{e.index.showToast({title:`总计 ${M.value} 条点评`,icon:"none"})},k=()=>{e.index.showToast({title:`已收录 ${$.value} 家企业`,icon:"none"})},D=()=>{e.index.showToast({title:`今日新增 ${j.value} 条点评`,icon:"none"})};e.onMounted((async()=>{await(async()=>{try{const{result:a}=await e.Ys.callFunction({name:"getStatistics"});0===a.code&&(M.value=a.data.totalReviews,$.value=a.data.totalCompanies,j.value=a.data.todayReviews)}catch(a){console.error("获取统计数据失败:",a)}})()}));const E=e.ref("default"),F=[{name:"default",label:"默认紫"},{name:"blue",label:"深邃蓝"},{name:"green",label:"自然绿"},{name:"red",label:"热情红"}],A=()=>{e.index.showActionSheet({itemList:F.map((e=>e.label)),success:a=>{var t;t=F[a.tapIndex].name,E.value=t,e.index.setStorageSync("theme",t)}})};return e.onMounted((()=>{const a=e.index.getStorageSync("theme");a&&(E.value=a)})),(t,s)=>e.e({a:e.o(A),b:e.unref(p)+"px",c:e.t(M.value||"0"),d:e.o(L),e:e.t($.value||"0"),f:e.o(k),g:e.t(j.value||"0"),h:e.o(D),i:e.unref(p)+88+"rpx",j:e.o(g),k:o.value,l:e.o((e=>o.value=e.detail.value)),m:o.value},o.value?{n:e.o(x)}:{},{o:e.t(c.value||"选择城市"),p:e.o(_),q:e.unref(p)+"rpx",r:u.value},u.value?{s:e.f(5,((e,a,t)=>({a:e,b:"15f5966f-0-"+t})))}:{},{t:u.value},u.value?{}:0===n.value.length?{w:a._imports_0,x:e.o(y)}:{y:e.f(n.value,((a,t,n)=>e.e({a:e.t(a.companyName),b:"15f5966f-1-"+n,c:e.p({value:a.rating,size:"15"}),d:e.t(a.rating||0),e:a.cons},a.cons?e.e({f:e.t(a.cons),g:a.isExpanded?"":1,h:q(a.cons)},q(a.cons)?{i:e.t(a.isExpanded?"收起":"查看更多"),j:e.o((e=>(e=>{e.isExpanded=!e.isExpanded})(a)),a._id)}:{}):{},{k:e.t(a.viewCount||0),l:e.t(a.reviewCount||0),m:e.t(m(a.createTime)),n:e.t(a.city),o:a._id,p:t,q:e.o((t=>{return n=a._id,void e.index.navigateTo({url:`/pages/comment/detail/detail?id=${n}`});var n}),a._id)})))},{v:0===n.value.length,z:u.value?"":1,A:e.o(C),B:e.o(y),C:e.o(w),D:e.sr(l,"15f5966f-2",{k:"disclaimerPopup"}),E:e.p({type:"center"}),F:n.value.length>0},n.value.length>0?e.e({G:u.value},(u.value||i.value,{}),{H:!i.value}):{},{I:e.o(T),J:e.o(b),K:e.o(T),L:e.sr(S,"15f5966f-3",{k:"complaintPopup"}),M:e.p({type:"center"}),N:e.n(`theme-${E.value}`)})}});qq.createPage(n);
