"use strict";const e=require("../../../common/vendor.js"),a={__name:"add",setup(a){const t=e.ref(""),i=e.ref([]),n=e.ref(""),o=e.ref("public"),s=e.ref([]),l=e.computed((()=>({public:"公开",friends:"仅好友可见",private:"仅自己可见"}[o.value]))),c=e.computed((()=>t.value.trim()||i.value.length>0)),u=()=>{e.index.navigateBack()},r=async()=>{if(c.value)try{e.index.showLoading({title:"发布中..."});const{result:a}=await e.Ys.callFunction({name:"wx_add_moment",data:{content:t.value,mediaList:i.value,location:n.value,privacy:o.value}});if(0!==a.code)throw new Error(a.msg);e.index.showToast({title:"发布成功",icon:"success"}),e.index.$emit("refreshMoments"),setTimeout((()=>{e.index.navigateBack()}),1500)}catch(a){e.index.showToast({title:a.message||"发布失败",icon:"none"})}finally{e.index.hideLoading()}},d=()=>{e.index.showActionSheet({itemList:["拍摄","从相册选择"],success:a=>{0===a.tapIndex||e.index.chooseImage({count:9-i.value.length,success:async a=>{e.index.showLoading({title:"上传中..."});try{const t=await(async a=>{console.log("uploadImages",a[0]);try{const t=a.map((a=>new Promise(((t,i)=>{e.Ys.uploadFile({filePath:a,cloudPath:`wx-moments/${Date.now()}-${Math.random().toString(36).slice(-6)}${a.match(/\.[^.]+$/)}`,success:e=>{t({type:"image",url:e.fileID})},fail:i})}))));return await Promise.all(t)}catch(t){return console.error(t),e.index.showToast({title:t.message||"图片上传失败",icon:"none"}),[]}})(a.tempFilePaths);i.value.push(...t)}finally{e.index.hideLoading()}}})}})},m=()=>{e.index.showActionSheet({itemList:["公开","仅好友可见","仅自己可见"],success:e=>{o.value=["public","friends","private"][e.tapIndex]}})},v=()=>{e.index.chooseLocation({success:e=>{n.value=e.name}})};return(a,o)=>e.e({a:e.o(u),b:c.value?1:"",c:e.o(r),d:t.value,e:e.o((e=>t.value=e.detail.value)),f:e.f(i.value,((a,t,n)=>e.e({a:"image"===a.type},"image"===a.type?{b:a.url,c:e.o((a=>(a=>{const t=i.value.filter((e=>"image"===e.type)).map((e=>e.url));e.index.previewImage({urls:t,current:t[a]})})(t)),t)}:"video"===a.type?{e:a.url}:{},{d:"video"===a.type,f:e.o((e=>(e=>{i.value.splice(e,1)})(t)),t),g:t}))),g:i.value.length<9},i.value.length<9?{h:e.o(d)}:{},{i:e.t(l.value),j:e.o(m),k:e.t(n.value||"添加位置"),l:e.o(v),m:e.t(s.value.length?`已选${s.value.length}人`:"添加")})}},t=e._export_sfc(a,[["__scopeId","data-v-1aa514c0"]]);qq.createPage(t);
