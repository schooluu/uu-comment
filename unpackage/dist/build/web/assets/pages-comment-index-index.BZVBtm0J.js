import{o as a,c as e,w as t,a as l,i as s,d as c,r as n,g as u,b as o,e as d,f as i,h as f,n as r,u as _,t as p,j as m,k as v,l as y,F as g,m as k,Y as b,s as h,p as x,q as C,v as w,x as F,y as S,I as $,z as E,A as I,B as L}from"./index-UJd7_IDo.js";import{o as j,r as q,_ as T}from"./uni-rate.h5kmn-hW.js";import{_ as D}from"./uni-popup.D9MB7IGt.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const A=z({},[["render",function(c,n){const u=s;return a(),e(u,{class:"skeleton-card glass-effect"},{default:t((()=>[l(u,{class:"card-header"},{default:t((()=>[l(u,{class:"company-name skeleton-bg"}),l(u,{class:"rating-wrapper"},{default:t((()=>[l(u,{class:"rating skeleton-bg"})])),_:1})])),_:1}),l(u,{class:"card-content"},{default:t((()=>[l(u,{class:"cons-box skeleton-bg"})])),_:1}),l(u,{class:"card-footer"},{default:t((()=>[l(u,{class:"stats"},{default:t((()=>[l(u,{class:"stat-item skeleton-bg"}),l(u,{class:"stat-item skeleton-bg"}),l(u,{class:"date skeleton-bg"})])),_:1}),l(u,{class:"city-tag skeleton-bg"})])),_:1})])),_:1})}],["__scopeId","data-v-c515b885"]]),B=z(c({__name:"index",setup(c){const z=n([]),B=n(""),V=n(null),P=n(1),R=n(!0),Y=n(!1),H=n(""),M=n([]),N=n([]),U=n(""),G=u().statusBarHeight,J=a=>{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},K=async(a=1,e=!1)=>{e||(Y.value=!0);try{const{result:t}=await b.callFunction({name:"getCompanyList",data:{page:a,pageSize:10,keyword:B.value,city:H.value}});if(0===t.code){const l=t.data.map((a=>({...a,isExpanded:!1})));e?z.value=[...z.value,...l]:setTimeout((()=>{z.value=l,Y.value=!1}),500),R.value=10===t.data.length,P.value=a}}catch(t){h({title:"获取数据失败",icon:"none"}),Y.value=!1}},O=()=>{z.value=[],P.value=1,R.value=!0,K(1)},Q=()=>{O()},W=()=>{B.value="",O()},X=()=>{x({url:"/pages/comment/add/add-review"})};o((()=>{d("hasShownDisclaimer")||V.value.open(),K()}));const Z=()=>{C("hasShownDisclaimer",!0),V.value.close()},aa=n(null),ea=()=>{aa.value.open()},ta=()=>{aa.value.close()},la=()=>{w({data:"962723968@qq.com",success:()=>{h({title:"邮箱已复制",icon:"success"})}})};j((()=>{(async()=>{R.value&&!Y.value&&await K(P.value+1,!0)})()})),o((()=>{K()}));const sa=()=>{F({itemList:M.value.map((a=>a.name)),success:async a=>{const e=M.value[a.tapIndex];U.value=e.name,await(async a=>{try{const{result:e}=await b.callFunction({name:"getCityList",data:{province:a}});0===e.code&&(N.value=e.data)}catch(e){h({title:"获取城市失败",icon:"none"})}})(e.code),F({itemList:N.value.map((a=>a.name)),success:a=>{H.value=N.value[a.tapIndex].name,O()}})}})};o((async()=>{await(async()=>{try{const{result:a}=await b.callFunction({name:"getCityList"});0===a.code&&(M.value=a.data)}catch(a){h({title:"获取省份失败",icon:"none"})}})(),K()}));const ca=n(0),na=n(0),ua=n(0),oa=()=>{h({title:`总计 ${ca.value} 条点评`,icon:"none"})},da=()=>{h({title:`已收录 ${na.value} 家企业`,icon:"none"})},ia=()=>{h({title:`今日新增 ${ua.value} 条点评`,icon:"none"})};o((async()=>{await(async()=>{try{const{result:a}=await b.callFunction({name:"getStatistics"});0===a.code&&(ca.value=a.data.totalReviews,na.value=a.data.totalCompanies,ua.value=a.data.todayReviews)}catch(a){console.error("获取统计数据失败:",a)}})()}));const fa=n(d("theme")||"default"),ra=[{name:"default",label:"默认紫"},{name:"blue",label:"深邃蓝"},{name:"green",label:"自然绿"},{name:"red",label:"热情红"}],_a=()=>{F({itemList:ra.map((a=>a.label)),success:a=>{var e,t;e=ra[a.tapIndex].name,fa.value=e,document.documentElement.setAttribute("data-theme",e),C("theme",e),h({title:`已切换至${null==(t=ra.find((a=>a.name===e)))?void 0:t.label}主题`,icon:"none"})}})};return o((()=>{const a=d("theme");a&&document.documentElement.setAttribute("data-theme",a)})),(c,n)=>{const u=S,o=s,d=$,b=E,h=q(i("uni-rate"),T),C=I,w=q(i("uni-popup"),D);return a(),e(o,{class:"container"},{default:t((()=>[l(o,{class:"nav-bar",style:r({paddingTop:_(G)+"px"})},{default:t((()=>[l(o,{class:"nav-content"},{default:t((()=>[l(o,{class:"nav-left"},{default:t((()=>[l(u,{class:"app-title"},{default:t((()=>[f("人人点评")])),_:1}),l(u,{class:"app-subtitle"},{default:t((()=>[f("匿名化点评，避雷指南")])),_:1})])),_:1}),l(o,{class:"nav-right"},{default:t((()=>[l(o,{class:"nav-btn theme-btn",onClick:_a},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("🎨")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),l(o,{class:"intro-section",style:r({marginTop:_(G)+88+"rpx"})},{default:t((()=>[l(o,{class:"intro-cards"},{default:t((()=>[l(o,{class:"intro-card glass-effect",onClick:oa},{default:t((()=>[l(o,{class:"card-content"},{default:t((()=>[l(u,{class:"count"},{default:t((()=>[f(p(ca.value||"0"),1)])),_:1}),l(u,{class:"label"},{default:t((()=>[f("总点评")])),_:1})])),_:1}),l(u,{class:"icon"},{default:t((()=>[f("📝")])),_:1})])),_:1}),l(o,{class:"intro-card glass-effect",onClick:da},{default:t((()=>[l(o,{class:"card-content"},{default:t((()=>[l(u,{class:"count"},{default:t((()=>[f(p(na.value||"0"),1)])),_:1}),l(u,{class:"label"},{default:t((()=>[f("已收录")])),_:1})])),_:1}),l(u,{class:"icon"},{default:t((()=>[f("🏢")])),_:1})])),_:1}),l(o,{class:"intro-card glass-effect",onClick:ia},{default:t((()=>[l(o,{class:"card-content"},{default:t((()=>[l(u,{class:"count"},{default:t((()=>[f(p(ua.value||"0"),1)])),_:1}),l(u,{class:"label"},{default:t((()=>[f("今日新增")])),_:1})])),_:1}),l(u,{class:"icon"},{default:t((()=>[f("🔥")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),l(o,{class:"search-section",style:r({marginTop:_(G)+"rpx"})},{default:t((()=>[l(o,{class:"search-wrapper glass-effect"},{default:t((()=>[l(o,{class:"search-input-box"},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("🔍")])),_:1}),l(d,{class:"input",modelValue:B.value,"onUpdate:modelValue":n[0]||(n[0]=a=>B.value=a),placeholder:"搜索点评标题","placeholder-class":"placeholder","confirm-type":"search",onConfirm:Q},null,8,["modelValue"]),B.value?(a(),e(u,{key:0,class:"clear-icon",onClick:W},{default:t((()=>[f("✕")])),_:1})):m("",!0)])),_:1}),l(o,{class:"divider"}),l(o,{class:"location-picker",onClick:sa},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("📍")])),_:1}),l(u,{class:"location-text"},{default:t((()=>[f(p(H.value||"选择城市"),1)])),_:1}),l(u,{class:"icon-arrow"},{default:t((()=>[f("▼")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),Y.value?(a(),v(g,{key:0},y(5,(a=>l(A,{key:a}))),64)):m("",!0),l(o,{class:k(["company-list",{"fade-in":!Y.value}])},{default:t((()=>[Y.value?(a(),v(g,{key:0},[],64)):0===z.value.length?(a(),e(o,{key:1,class:"empty-state"},{default:t((()=>[l(b,{class:"empty-image",src:"./static/images/empty.png",mode:"aspectFit"}),l(u,{class:"empty-text"},{default:t((()=>[f("暂无数据")])),_:1}),l(u,{class:"empty-tips"},{default:t((()=>[f("快来添加第一条评价吧")])),_:1}),l(o,{class:"empty-btn",onClick:X},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("✏️")])),_:1}),l(u,{class:"text"},{default:t((()=>[f("写点评")])),_:1})])),_:1})])),_:1})):(a(!0),v(g,{key:2},y(z.value,((s,c)=>(a(),e(o,{key:s._id,class:"company-card glass-effect",style:r({"--index":c}),"hover-class":"company-card-hover",onClick:a=>{return e=s._id,void x({url:`/pages/comment/detail/detail?id=${e}`});var e}},{default:t((()=>[l(o,{class:"card-header"},{default:t((()=>[l(u,{class:"company-name"},{default:t((()=>[f(p(s.companyName),1)])),_:2},1024),l(o,{class:"rating-wrapper"},{default:t((()=>[l(h,{value:s.rating,size:"18",color:"#FFB800"},null,8,["value"]),l(u,{class:"rating-text"},{default:t((()=>[f(p(s.rating||0),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),l(o,{class:"card-content"},{default:t((()=>[s.cons?(a(),e(o,{key:0,class:"cons-box"},{default:t((()=>{return[l(u,{class:k(["cons-text",{truncated:!s.isExpanded}])},{default:t((()=>[f(p(s.cons),1)])),_:2},1032,["class"]),(c=s.cons,c.length>100?(a(),e(u,{key:0,class:"expand-btn",onClick:L((a=>(a=>{a.isExpanded=!a.isExpanded})(s)),["stop"])},{default:t((()=>[f(p(s.isExpanded?"收起":"查看更多"),1)])),_:2},1032,["onClick"])):m("",!0))];var c})),_:2},1024)):m("",!0)])),_:2},1024),l(o,{class:"card-footer"},{default:t((()=>[l(o,{class:"stats"},{default:t((()=>[l(o,{class:"stat-item"},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("👁️")])),_:1}),l(u,{class:"count"},{default:t((()=>[f(p(s.viewCount||0),1)])),_:2},1024)])),_:2},1024),l(o,{class:"stat-item"},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("💬")])),_:1}),l(u,{class:"count"},{default:t((()=>[f(p(s.reviewCount||0),1)])),_:2},1024)])),_:2},1024),l(u,{class:"date"},{default:t((()=>[f(p(J(s.createTime)),1)])),_:2},1024)])),_:2},1024),l(u,{class:"city-tag"},{default:t((()=>[f(p(s.city),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["style","onClick"])))),128))])),_:1},8,["class"]),l(o,{class:"float-btns"},{default:t((()=>[l(o,{class:"float-btn glass-effect complaint-btn",onClick:ea},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("📢")])),_:1})])),_:1}),l(o,{class:"float-btn glass-effect",onClick:X},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("✏️")])),_:1})])),_:1})])),_:1}),l(w,{ref_key:"disclaimerPopup",ref:V,type:"center"},{default:t((()=>[l(o,{class:"disclaimer-popup"},{default:t((()=>[l(o,{class:"popup-header"},{default:t((()=>[l(u,{class:"title"},{default:t((()=>[f("免责声明")])),_:1})])),_:1}),l(o,{class:"popup-content"},{default:t((()=>[l(u,{class:"text"},{default:t((()=>[f("1. 本平台仅提供信息分享服务，所有内容均来自用户发布。")])),_:1}),l(u,{class:"text"},{default:t((()=>[f("2. 用户发布的内容仅代表个人观点，请理性对待。")])),_:1}),l(u,{class:"text"},{default:t((()=>[f("3. 如发现违规内容，请及时联系我们处理。")])),_:1}),l(u,{class:"text"},{default:t((()=>[f("4. 平台保留对违规内容的处理权利。")])),_:1})])),_:1}),l(o,{class:"popup-footer"},{default:t((()=>[l(C,{class:"confirm-btn",onClick:Z},{default:t((()=>[f("我已了解")])),_:1})])),_:1})])),_:1})])),_:1},512),z.value.length>0?(a(),e(o,{key:1,class:"load-more"},{default:t((()=>[Y.value?(a(),e(o,{key:0,class:"loading"},{default:t((()=>[l(o,{class:"loading-icon"}),l(u,{class:"loading-text"},{default:t((()=>[f("加载中...")])),_:1})])),_:1})):R.value?m("",!0):(a(),e(u,{key:1,class:"no-more"},{default:t((()=>[f("没有更多了")])),_:1}))])),_:1})):m("",!0),l(w,{ref_key:"complaintPopup",ref:aa,type:"center"},{default:t((()=>[l(o,{class:"complaint-popup glass-effect"},{default:t((()=>[l(o,{class:"popup-header"},{default:t((()=>[l(u,{class:"title"},{default:t((()=>[f("投诉建议")])),_:1}),l(u,{class:"close-icon",onClick:ta},{default:t((()=>[f("✕")])),_:1})])),_:1}),l(o,{class:"popup-content"},{default:t((()=>[l(o,{class:"content-item"},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("📧")])),_:1}),l(o,{class:"item-info"},{default:t((()=>[l(u,{class:"label"},{default:t((()=>[f("邮箱联系")])),_:1}),l(u,{class:"value"},{default:t((()=>[f("962723968@qq.com")])),_:1})])),_:1}),l(C,{class:"copy-btn",onClick:la},{default:t((()=>[f("复制")])),_:1})])),_:1}),l(o,{class:"content-item"},{default:t((()=>[l(u,{class:"icon"},{default:t((()=>[f("⚠️")])),_:1}),l(o,{class:"item-info"},{default:t((()=>[l(u,{class:"label"},{default:t((()=>[f("温馨提示")])),_:1}),l(u,{class:"desc"},{default:t((()=>[f("如发现任何违规或不当内容，请及时联系我们处理，我们会在24小时内给予回复。")])),_:1})])),_:1})])),_:1})])),_:1}),l(o,{class:"popup-footer"},{default:t((()=>[l(C,{class:"confirm-btn",onClick:ta},{default:t((()=>[f("我知道了")])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1})}}}),[["__scopeId","data-v-06fd2e23"]]);export{B as default};
