import{d as a,r as e,g as t,o as l,a as s,D as n,b as u,c,e as o,w as d,f as i,h as r,n as m,u as f,v as _,z as v,i as p,j as y,F as g,k as h,E as w,G as C,Y as b,s as k,H as x,l as S,m as V,I as j,t as F}from"./index-BIIEW6ik.js";import{_ as z}from"./uni-rate.D3KgNUNb.js";import{r as D}from"./uni-app.es.BWa1T1E-.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=I(a({__name:"detail",setup(a){const I=e(null),T=e([]),$=e(0),M=e(""),A=t().statusBarHeight,H=e("default"),N=()=>{w()},U=()=>{uni.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},Y=async a=>{try{const{result:e}=await b.callFunction({name:"getCompanyComments",data:{companyId:a}});0===e.code&&(T.value=e.data)}catch(e){k({title:"获取评论失败",icon:"none"})}},B=async()=>{try{C({title:"发表中..."});const{result:a}=await b.callFunction({name:"addCompanyComment",data:{companyId:I.value._id,content:M.value,rating:$.value}});0===a.code&&(k({title:"评论成功"}),M.value="",$.value=0,await Y(I.value._id)),x()}catch(a){k({title:"评论失败",icon:"none"})}},E=a=>{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`};return l((()=>{const a=s("theme");a&&(H.value=a);const e=n(),t=e[e.length-1].options.id;t&&((async a=>{C({title:"加载中..."});try{const{result:e}=await b.callFunction({name:"getCompanyDetail",data:{id:a}});0===e.code&&(I.value=e.data)}catch(e){k({title:"获取详情失败",icon:"none"})}finally{x()}})(t),Y(t))})),(a,e)=>{const t=S,l=V,s=D(u("uni-rate"),z),n=j,w=F;return c(),o(l,{class:h(["container",`theme-${H.value}`])},{default:d((()=>[i(l,{class:"nav-bar",style:m({paddingTop:f(A)+"px"})},{default:d((()=>[i(l,{class:"nav-content"},{default:d((()=>[i(l,{class:"nav-left"},{default:d((()=>[i(l,{class:"back-btn",onClick:N},{default:d((()=>[i(t,{class:"icon"},{default:d((()=>[r("←")])),_:1})])),_:1}),i(t,{class:"nav-title"},{default:d((()=>[r("详情")])),_:1})])),_:1}),i(l,{class:"nav-right"},{default:d((()=>[i(l,{class:"share-btn",onClick:U},{default:d((()=>[i(t,{class:"icon"},{default:d((()=>[r("📤")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),i(l,{class:"main-content",style:m({paddingTop:f(A)+88+"rpx"})},{default:d((()=>[I.value?(c(),o(l,{key:0,class:"company-info"},{default:d((()=>[i(l,{class:"header"},{default:d((()=>[i(t,{class:"name"},{default:d((()=>[r(_(I.value.companyName),1)])),_:1}),i(l,{class:"stats-box"},{default:d((()=>[i(l,{class:"rating-box"},{default:d((()=>[i(s,{value:I.value.rating,size:"15"},null,8,["value"]),i(t,{class:"review-count"},{default:d((()=>[r(_(I.value.reviewCount||0)+"条点评",1)])),_:1})])),_:1}),i(t,{class:"view-count"},{default:d((()=>[i(t,{class:"icon"},{default:d((()=>[r("👁️")])),_:1}),r(" "+_(I.value.viewCount||0),1)])),_:1})])),_:1}),i(t,{class:"address"},{default:d((()=>[r(_(I.value.address),1)])),_:1})])),_:1})])),_:1})):v("",!0),I.value?(c(),o(l,{key:1,class:"company-info comments-section"},{default:d((()=>[i(l,{class:"section-title"},{default:d((()=>[i(t,{class:"title"},{default:d((()=>[r("评价")])),_:1})])),_:1}),i(l,{style:{color:"darkorange"}},{default:d((()=>[r(_(I.value.cons),1)])),_:1})])),_:1})):v("",!0),i(l,{class:"comments-section"},{default:d((()=>[i(l,{class:"section-title"},{default:d((()=>[i(t,{class:"title"},{default:d((()=>[r("看法")])),_:1}),i(t,{class:"count"},{default:d((()=>[r("("+_(T.value.length)+")",1)])),_:1})])),_:1}),i(l,{class:"comment-list"},{default:d((()=>[(c(!0),p(g,null,y(T.value,(a=>(c(),o(l,{key:a._id,class:"comment-item"},{default:d((()=>[i(l,{class:"comment-header"},{default:d((()=>[i(l,{class:"user-info"},{default:d((()=>[i(t,{class:"username"},{default:d((()=>[r(_(a.userName||"匿名用户"),1)])),_:2},1024),i(s,{value:a.rating,size:"15"},null,8,["value"])])),_:2},1024),i(t,{class:"time"},{default:d((()=>[r(_(E(a.createdAt)),1)])),_:2},1024)])),_:2},1024),i(l,{class:"comment-content"},{default:d((()=>[i(t,{class:"text"},{default:d((()=>[r(_(a.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),i(l,{class:"comment-form"},{default:d((()=>[i(l,{class:"rating-input"},{default:d((()=>[i(s,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=a=>$.value=a),size:"20"},null,8,["modelValue"])])),_:1}),i(n,{class:"input",modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=a=>M.value=a),placeholder:"说说你的看法...",onConfirm:B},null,8,["modelValue"]),i(w,{class:"submit-btn",onClick:B},{default:d((()=>[i(t,{class:"icon"},{default:d((()=>[r("✏️")])),_:1}),i(t,null,{default:d((()=>[r("发表")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1},8,["class"])}}}),[["__scopeId","data-v-6bc23098"]]);export{T as default};
