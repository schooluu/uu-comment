import{r as e,o as a,e as l,w as s,l as t,s as n,a4 as c,x as o,c as u,f as i,a5 as m,k as r,h as d,t as f,u as v,i as p,j as _,F as k,A as g,B as h,m as y,q as w,y as b,v as C,U as x,I as j,z as T,S as L}from"./index-7gMq5wzL.js";import{a as F,o as I}from"./uni-app.es.BYM_4RZF.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U="https://qcloud.dpfile.com/pc/pawK4KeJSDNVINhfwh9CoLJPFluB-tnHSd3heJ_jybtNIYslSlGEPeQVyA4hZRCP.jpg",E=M({__name:"index",setup(M){const E=["æ˜Ÿæ²³æ—…äºº","å¤æ—¥å¾®é£","è“è“æ±½æ°´","æ©™å­æ±½çƒ","å¤œç©ºå®ˆæœ›","æ™¨æ›¦å¾®å…‰","äº‘ç«¯æ¼«æ­¥","æœˆä¸‹ç‹¬è¡Œ","ç™½èŒ¶æ¸…æ¬¢","é’æŸ æ—¶å…‰","æ¸©æŸ”æ˜Ÿçƒ","æ™´ç©ºä¸‡é‡Œ","é£ä¸­è¯—äºº","æµ·ç›å†°æ²™","å±±é‡å¬é£","æ©˜å­æµ·å²¸","é“¶æ²³ä¿¡ä½¿","å¾®å…‰æ‹¾æ¢¦","æ™šé£é‚®å·®","é›¾é‡Œçœ‹èŠ±","æ£®æ—ä¹‹å¿ƒ","é›¨ååˆæ™´","äº‘æœµæ”¶é›†è€…","å¤å¤œè¤ç«"];function P(){return E[Math.floor(Math.random()*E.length)]}const S=["ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡ï¼","åŒ¿ååˆ†äº«ï¼Œè½»æ¾è‡ªåœ¨~","æ¯ä¸€å¤©éƒ½å€¼å¾—è®°å½•ã€‚","ç”¨å¿ƒæ„Ÿå—ç”Ÿæ´»çš„ç¾å¥½ã€‚","ç§‘æŠ€è®©åŒ¿åæ›´æ¸©æš–ã€‚","ä¸–ç•Œå¾ˆå¤§ï¼Œå¿ƒæƒ…å¾ˆç¾ã€‚","åšè‡ªå·±çš„å°å¤ªé˜³ â˜€ï¸","åŒ¿åä¸å­¤å•ï¼Œæ¸©æš–åœ¨èº«è¾¹ã€‚","è®°å½•æ­¤åˆ»ï¼Œé‡è§æ›´å¥½çš„è‡ªå·±ã€‚","ä¿æŒå¥½å¥‡ï¼Œä¿æŒçƒ­çˆ±ï¼"],V=S[Math.floor(Math.random()*S.length)],H=["åŒ¿åæ ‘æ´ Â· ç¾å¥½ç”Ÿæ´»","ç”¨æ¸©æŸ”æ²»æ„ˆä¸–ç•Œ","æ¯ä¸€å¤©éƒ½å€¼å¾—è®°å½•","è®©å¿ƒæƒ…è‡ªç”±æµåŠ¨","ç§‘æŠ€è®©æ¸©æš–å‘ç”Ÿ","åœ¨è¿™é‡Œé‡è§ç¾å¥½","åˆ†äº«ä½ çš„æ•…äº‹","åšè‡ªå·±çš„å°å¤ªé˜³","ä¸–ç•Œå¾ˆå¤§ï¼Œæ¸©æš–å¾ˆè¿‘","ç”¨åŒ¿åå®ˆæŠ¤çœŸå¿ƒ"];e(H[0]);const J=e(""),N=e(!0);let Q=null,q=0,z=0;function A(){clearTimeout(Q);const e=H[q];J.value="",z=0,function a(){z<=e.length?(J.value=e.slice(0,z),z++,Q=setTimeout(a,60)):setTimeout((()=>{q=(q+1)%H.length,A()}),1800)}()}a((()=>{A(),setInterval((()=>{N.value=!N.value}),500)}));const B=e(!1),D=e(!1),K=e(""),G=e(-1),R=e({}),Y=e(1),Z=e(10),$=e(!1),O=e(!0),W=e([]),X=async(e=!1)=>{if(!$.value&&(O.value||e))try{$.value=!0;const a=new Promise((e=>setTimeout(e,800))),[{result:l}]=await Promise.all([t.callFunction({name:"wx_get_list",data:{page:e?1:Y.value,pageSize:Z.value}}),a]);if(0!==l.code)throw new Error(l.msg);{const a=l.data.list.map((e=>({...e,username:P(),avatar:U,comments:(e.comments||[]).map((e=>({...e,username:P()}))),likes:(e.likes||[]).map((()=>P()))})));e?(W.value=a,Y.value=1):(W.value=[...W.value,...a],Y.value++),O.value=l.data.hasMore}}catch(a){n({title:a.message||"è·å–æœ‹å‹åœˆå¤±è´¥",icon:"none"})}finally{$.value=!1,e&&c()}};F((()=>{X(!0)})),I((()=>{X()}));const ee=async()=>{if(K.value.trim()){B.value=!1,D.value=!1,n({title:"è¯„è®ºæˆåŠŸ",icon:"none"});try{const{result:e}=await t.callFunction({name:"wx_add_comment",data:{momentId:W.value[G.value]._id,content:K.value}});if(0!==e.code)throw new Error(e.msg);{const e=W.value[G.value];e.comments||(e.comments=[]),e.comments.push({username:P(),content:K.value,create_time:Date.now()}),K.value=""}}catch(e){n({title:e.message||"è¯„è®ºå¤±è´¥",icon:"none"})}}},ae=async()=>{y({url:"/pages/wx/home/add"})},le=()=>{B.value=!1,D.value=!1,K.value="",G.value=-1},se=()=>{D.value=!D.value},te=()=>{n({title:"è§†é¢‘åŠ è½½å¤±è´¥",icon:"none"})},ne=["ğŸ˜Š","ğŸ˜‚","ğŸ¤£","â¤ï¸","ğŸ˜","ğŸ¤”","ğŸ˜’","ğŸ‘","ğŸ‘","ğŸ˜³","ğŸ¥º","ğŸ˜­","ğŸ˜˜","ğŸ¤—","ğŸ™„","ğŸ˜´","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ˜ˆ","ğŸ‘»","ğŸ‘½","ğŸ¤–","ğŸ’©","ğŸ˜º","ğŸ’ª","ğŸ‘Š","âœŒï¸","ğŸ¤","ğŸ™","ğŸ‘","ğŸ™Œ","ğŸ‘","ğŸ¤²"];return(e,a)=>{const c=b,y=o,F=C,I=x,M=j,E=T,S=L;return u(),l(y,{class:"moments-container"},{default:s((()=>[i(y,{class:"header"},{default:s((()=>[i(c,{class:"bg-image",src:"https://img1.imgtp.com/2023/07/10/0Qv6Qw4w.png",mode:"aspectFill"}),i(y,{class:"header-gradient"}),i(y,{class:"header-blur"}),i(y,{class:"header-glow"}),i(y,{class:"slogan-area"},{default:s((()=>[i(F,{class:"slogan-typing"},{default:s((()=>[m("span",{innerHTML:J.value},null,8,["innerHTML"]),m("span",{class:r(["cursor",{blink:N.value}])},"|",2)])),_:1}),i(F,{class:"signature"},{default:s((()=>[d(f(v(V)),1)])),_:1})])),_:1})])),_:1}),i(y,{class:"moments-list"},{default:s((()=>[(u(!0),p(k,null,_(W.value,((e,a)=>(u(),l(y,{class:"moment-item",key:a},{default:s((()=>[i(c,{class:"user-avatar avatar-glow",src:e.avatar,mode:"aspectFill"},null,8,["src"]),i(y,{class:"content-area"},{default:s((()=>[i(y,{class:"username"},{default:s((()=>[d(f(e.username),1)])),_:2},1024),i(F,{class:"text-content"},{default:s((()=>[d(f(e.content),1)])),_:2},1024),e.mediaType?(u(),l(y,{key:0,class:"media-content"},{default:s((()=>["video"===e.mediaType?(u(),l(I,{key:0,src:e.mediaUrl,poster:e.poster,class:"video-content video-radius",controls:"","show-center-play-btn":"","enable-play-gesture":"","show-fullscreen-btn":"","show-play-btn":"","object-fit":"contain",onError:te},null,8,["src","poster"])):"image"===e.mediaType?(u(),l(y,{key:1,class:r(["image-gallery",`columns-${e.mediaUrls.length}`])},{default:s((()=>[(u(!0),p(k,null,_(e.mediaUrls,((a,s)=>(u(),l(c,{key:s,src:a,mode:"aspectFill",class:"image-content image-radius",onClick:l=>{return s=e.mediaUrls,t=a,void(s&&s.length&&w({urls:s,current:t}));var s,t}},null,8,["src","onClick"])))),128))])),_:2},1032,["class"])):g("",!0)])),_:2},1024)):g("",!0),i(y,{class:"bottom-info"},{default:s((()=>[i(F,{class:"time"},{default:s((()=>[d(f(e.time),1)])),_:2},1024),i(y,{class:"actions"},{default:s((()=>[i(y,{class:r(["action-btn like-btn",{liked:e.isLiked,animating:R.value[a]}]),onClick:e=>(async e=>{try{const a=W.value[e];R.value[e]=!0;const{result:l}=await t.callFunction({name:"wx_add_toggle_like",data:{momentId:a._id}});if(0!==l.code)throw new Error(l.msg);a.isLiked=l.data.isLiked,a.isLiked?(a.likes||(a.likes=[]),a.likes.push(P())):a.likes.pop(),setTimeout((()=>{R.value[e]=!1}),1e3)}catch(a){n({title:a.message||"æ“ä½œå¤±è´¥",icon:"none"})}})(a)},{default:s((()=>[i(F,{class:"icon iconfont"},{default:s((()=>[d(f(e.isLiked?"â¤ï¸":"ğŸ¤"),1)])),_:2},1024),i(F,{class:"action-text"},{default:s((()=>[d(f(e.isLiked?"å·²èµ":"ç‚¹èµ"),1)])),_:2},1024),R.value[a]?(u(),l(y,{key:0,class:"like-burst-particles"},{default:s((()=>[(u(),p(k,null,_(8,(e=>i(y,{key:e,class:r(["particle","p"+e])},null,8,["class"]))),64))])),_:1})):g("",!0)])),_:2},1032,["class","onClick"]),i(y,{class:"action-btn comment-btn",onClick:e=>(e=>{G.value=e,B.value=!0})(a)},{default:s((()=>[i(F,{class:"icon iconfont"},{default:s((()=>[d("ğŸ’¬")])),_:1}),i(F,{class:"action-text"},{default:s((()=>[d("è¯„è®º")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),e.likes&&e.likes.length?(u(),l(y,{key:1,class:"likes-section"},{default:s((()=>[i(F,{class:"like-users"},{default:s((()=>[d(f(e.likes.join("ã€")),1)])),_:2},1024)])),_:2},1024)):g("",!0),e.comments&&0!==e.comments.length?(u(),l(y,{key:2,class:"comments-section"},{default:s((()=>[(u(!0),p(k,null,_(e.comments,((e,a)=>(u(),l(y,{class:"comment-item",key:a},{default:s((()=>[i(c,{class:"comment-anon-icon",src:U}),i(F,{class:"comment-user"},{default:s((()=>[d(f(e.username)+"ï¼š",1)])),_:2},1024),i(F,{class:"comment-content"},{default:s((()=>[d(f(e.content),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):g("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),B.value?(u(),l(y,{key:0,class:"comment-popup",onClick:le},{default:s((()=>[i(y,{class:"comment-box animated-popup",onClick:a[1]||(a[1]=h((()=>{}),["stop"]))},{default:s((()=>[i(y,{class:"comment-input-area"},{default:s((()=>[i(M,{class:"comment-input",modelValue:K.value,"onUpdate:modelValue":a[0]||(a[0]=e=>K.value=e),placeholder:"@åŒ¿åç”¨æˆ· è¯´ç‚¹ä»€ä¹ˆ...",focus:B.value,onConfirm:ee},null,8,["modelValue","focus"]),i(y,{class:"toolbar"},{default:s((()=>[i(F,{class:"emoji-btn",onClick:se},{default:s((()=>[d("ğŸ˜Š")])),_:1}),i(E,{class:r(["submit-btn",{active:K.value.trim()}]),onClick:ee},{default:s((()=>[d("å‘é€")])),_:1},8,["class"])])),_:1})])),_:1}),D.value?(u(),l(y,{key:0,class:"emoji-panel"},{default:s((()=>[i(S,{"scroll-y":"",class:"emoji-list"},{default:s((()=>[i(y,{class:"emoji-group"},{default:s((()=>[(u(),p(k,null,_(ne,((e,a)=>i(F,{key:a,class:"emoji-item",onClick:a=>(e=>{K.value+=e})(e)},{default:s((()=>[d(f(e),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1})):g("",!0),i(y,{class:"publish-btn",onClick:ae},{default:s((()=>[i(y,{class:"icon-wrapper"},{default:s((()=>[i(F,{class:"iconfont"},{default:s((()=>[d("+")])),_:1})])),_:1})])),_:1}),$.value?(u(),l(y,{key:1,class:"tech-loading"},{default:s((()=>[(u(),p(k,null,_(4,(e=>i(y,{class:"dot",key:e}))),64)),i(F,{class:"loading-text"},{default:s((()=>[d("åŠ è½½ä¸­...")])),_:1})])),_:1})):g("",!0)])),_:1})}}},[["__scopeId","data-v-1e71b732"]]);export{E as default};
