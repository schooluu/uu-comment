import{r as e,e as a,w as s,Y as l,s as t,a4 as c,v as n,c as o,f as i,h as u,i as m,j as d,t as r,k as f,F as _,z as v,A as p,l as k,x as y,q as g,T as h,I as b,y as w,S as x}from"./index-BG1tn67b.js";import{a as C,o as j}from"./uni-app.es.DDvCcZ8H.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";const E="https://img0.baidu.com/it/u=1415523915,841919565&fm=253&app=120&size=w931&n=0&f=JPEG&fmt=auto?sec=1713286800&t=a9e21a0e5650a672fa2cbd3b133ed7e0",L=F({__name:"index",setup(F){const L=e(!1),T=e(!1),I=e(""),U=e(-1),z=e({}),S=e(1),V=e(10),q=e(!1),A=e(!0),D=e([]),G=async(e=!1)=>{if(!q.value&&(A.value||e))try{q.value=!0;const{result:a}=await l.callFunction({name:"wx_get_list",data:{page:e?1:S.value,pageSize:V.value}});if(0!==a.code)throw new Error(a.msg);e?(D.value=a.data.list,S.value=1):(D.value=[...D.value,...a.data.list],S.value++),A.value=a.data.hasMore}catch(a){t({title:a.message||"èŽ·å–æœ‹å‹åœˆå¤±è´¥",icon:"none"})}finally{q.value=!1,e&&c()}};C((()=>{G(!0)})),j((()=>{G()}));const J=async()=>{if(I.value.trim())try{const{result:e}=await l.callFunction({name:"wx_add_comment",data:{momentId:D.value[U.value]._id,content:I.value}});if(0!==e.code)throw new Error(e.msg);{const e=D.value[U.value];e.comments||(e.comments=[]),e.comments.push({username:"æˆ‘",content:I.value,create_time:Date.now()}),I.value="",L.value=!1,T.value=!1,t({title:"è¯„è®ºæˆåŠŸ",icon:"success"})}}catch(e){t({title:e.message||"è¯„è®ºå¤±è´¥",icon:"none"})}},M=async()=>{k({url:"/pages/wx/home/add"})},O=()=>{L.value=!1,T.value=!1,I.value="",U.value=-1},P=()=>{T.value=!T.value},R=()=>{t({title:"è§†é¢‘åŠ è½½å¤±è´¥",icon:"none"})},Y=["ðŸ˜Š","ðŸ˜‚","ðŸ¤£","â¤ï¸","ðŸ˜","ðŸ¤”","ðŸ˜’","ðŸ‘","ðŸ‘Ž","ðŸ˜³","ðŸ¥º","ðŸ˜­","ðŸ˜˜","ðŸ¤—","ðŸ™„","ðŸ˜´","ðŸ¤®","ðŸ¤§","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ˜ˆ","ðŸ‘»","ðŸ‘½","ðŸ¤–","ðŸ’©","ðŸ˜º","ðŸ’ª","ðŸ‘Š","âœŒï¸","ðŸ¤ž","ðŸ™","ðŸ‘","ðŸ™Œ","ðŸ‘","ðŸ¤²"];return(e,c)=>{const k=y,C=g,j=n,F=h,S=b,V=w,q=x;return o(),a(j,{class:"moments-container"},{default:s((()=>[i(j,{class:"header"},{default:s((()=>[i(k,{class:"bg-image",src:E,mode:"aspectFill"}),i(j,{class:"avatar-area"},{default:s((()=>[i(j,{class:"user-info"},{default:s((()=>[i(C,{class:"nickname"},{default:s((()=>[u("ç”¨æˆ·æ˜µç§°")])),_:1}),i(k,{class:"avatar",src:E,mode:"aspectFill"})])),_:1})])),_:1})])),_:1}),i(j,{class:"moments-list"},{default:s((()=>[(o(!0),m(_,null,d(D.value,((e,c)=>(o(),a(j,{class:"moment-item",key:c},{default:s((()=>[i(k,{class:"user-avatar",src:e.avatar,mode:"aspectFill"},null,8,["src"]),i(j,{class:"content-area"},{default:s((()=>[i(j,{class:"username"},{default:s((()=>[u(r(e.username),1)])),_:2},1024),i(C,{class:"text-content"},{default:s((()=>[u(r(e.content),1)])),_:2},1024),e.mediaType?(o(),a(j,{key:0,class:"media-content"},{default:s((()=>["video"===e.mediaType?(o(),a(F,{key:0,src:e.mediaUrl,poster:e.poster,class:"video-content",controls:"","show-center-play-btn":"","enable-play-gesture":"","show-fullscreen-btn":"","show-play-btn":"","object-fit":"contain",onError:R},null,8,["src","poster"])):"image"===e.mediaType?(o(),a(j,{key:1,class:f(["image-gallery",`columns-${e.mediaUrls.length}`])},{default:s((()=>[(o(!0),m(_,null,d(e.mediaUrls,((e,s)=>(o(),a(k,{key:s,src:e,mode:"aspectFill",class:"image-content"},null,8,["src"])))),128))])),_:2},1032,["class"])):v("",!0)])),_:2},1024)):v("",!0),i(j,{class:"bottom-info"},{default:s((()=>[i(C,{class:"time"},{default:s((()=>[u(r(e.time),1)])),_:2},1024),i(j,{class:"actions"},{default:s((()=>[i(j,{class:f(["action-btn like-btn",{liked:e.isLiked,animating:z.value[c]}]),onClick:e=>(async e=>{try{const a=D.value[e];z.value[e]=!0;const{result:s}=await l.callFunction({name:"wx_add_toggle_like",data:{momentId:a._id}});if(0!==s.code)throw new Error(s.msg);if(a.isLiked=s.data.isLiked,a.isLiked)a.likes||(a.likes=[]),a.likes.push("æˆ‘");else{const e=a.likes.indexOf("æˆ‘");e>-1&&a.likes.splice(e,1)}setTimeout((()=>{z.value[e]=!1}),1e3)}catch(a){t({title:a.message||"æ“ä½œå¤±è´¥",icon:"none"})}})(c)},{default:s((()=>[i(C,{class:"icon"},{default:s((()=>[u(r(e.isLiked?"â¤ï¸":"ðŸ¤"),1)])),_:2},1024)])),_:2},1032,["class","onClick"]),i(j,{class:"action-btn comment-btn",onClick:e=>(e=>{U.value=e,L.value=!0})(c)},{default:s((()=>[i(C,{class:"icon"},{default:s((()=>[u("ðŸ’¬")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),e.likes&&e.likes.length?(o(),a(j,{key:1,class:"likes-section"},{default:s((()=>[i(C,{class:"like-users"},{default:s((()=>[u(r(e.likes.join("ã€")),1)])),_:2},1024)])),_:2},1024)):v("",!0),e.comments&&0!==e.comments.length?(o(),a(j,{key:2,class:"comments-section"},{default:s((()=>[(o(!0),m(_,null,d(e.comments,((e,l)=>(o(),a(j,{class:"comment-item",key:l},{default:s((()=>[i(C,{class:"comment-user"},{default:s((()=>[u(r(e.username)+"ï¼š",1)])),_:2},1024),i(C,{class:"comment-content"},{default:s((()=>[u(r(e.content),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):v("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),L.value?(o(),a(j,{key:0,class:"comment-popup",onClick:O},{default:s((()=>[i(j,{class:"comment-box",onClick:c[1]||(c[1]=p((()=>{}),["stop"]))},{default:s((()=>[i(j,{class:"comment-input-area"},{default:s((()=>[i(S,{class:"comment-input",modelValue:I.value,"onUpdate:modelValue":c[0]||(c[0]=e=>I.value=e),placeholder:"è¯„è®º",focus:L.value,onConfirm:J},null,8,["modelValue","focus"]),i(j,{class:"toolbar"},{default:s((()=>[i(C,{class:"emoji-btn",onClick:P},{default:s((()=>[u("ðŸ˜Š")])),_:1}),i(V,{class:f(["submit-btn",{active:I.value.trim()}]),onClick:J},{default:s((()=>[u("å‘é€")])),_:1},8,["class"])])),_:1})])),_:1}),T.value?(o(),a(j,{key:0,class:"emoji-panel"},{default:s((()=>[i(q,{"scroll-y":"",class:"emoji-list"},{default:s((()=>[i(j,{class:"emoji-group"},{default:s((()=>[(o(),m(_,null,d(Y,((e,a)=>i(C,{key:a,class:"emoji-item",onClick:a=>(e=>{I.value+=e})(e)},{default:s((()=>[u(r(e),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})):v("",!0)])),_:1})])),_:1})):v("",!0),i(j,{class:"publish-btn",onClick:M},{default:s((()=>[i(j,{class:"icon-wrapper"},{default:s((()=>[i(C,{class:"iconfont"},{default:s((()=>[u("+")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a65f0f71"]]);export{L as default};
