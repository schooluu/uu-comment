import{r as a,O as l,e,w as s,x as t,c,f as o,h as u,k as i,t as n,i as d,j as r,F as f,A as _,G as p,H as m,l as v,s as h,a5 as g,J as y,D as k,a1 as w,q as b,a6 as C,v as j,L as x,S as F,y as I,U as P}from"./index-4VJyEHA-.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const L=$({__name:"add",setup($){const L=a(""),D=a([]),V=a(""),M=a("public"),S=a([]),U=a(!1),q=l((()=>({public:"公开",friends:"仅好友可见",private:"仅自己可见"}[M.value]))),A=l((()=>L.value.trim()||D.value.length>0)),E=["😊","😂","🤣","❤️","😍","🤔","😒","👍","👎","😳","🥺","😭","😘","🤗","🙄","😴","🤮","🤧","😷","🤒","🤕","😈","👻","👽","🤖","💩","😺","💪","👊","✌️","🤞","🙏","👏","🙌","👐","🤲"],G=a(!1),H=()=>{G.value=!G.value},J=()=>{p()},O=async()=>{if(A.value){U.value=!0;try{m({title:"发布中..."});const{result:a}=await v.callFunction({name:"wx_add_moment",data:{content:L.value,mediaList:D.value,location:V.value,privacy:M.value}});if(0!==a.code)throw new Error(a.msg);h({title:"发布成功",icon:"success"}),g("refreshMoments"),setTimeout((()=>{p()}),1500)}catch(a){h({title:a.message||"发布失败",icon:"none"})}finally{y(),U.value=!1}}},T=()=>{k({itemList:["拍摄","从相册选择"],success:a=>{0===a.tapIndex||w({count:9-D.value.length,success:async a=>{m({title:"上传中..."});try{const l=await(async a=>{console.log("uploadImages",a[0]);try{const l=a.map((a=>new Promise(((l,e)=>{v.uploadFile({filePath:a,cloudPath:`wx-moments/${Date.now()}-${Math.random().toString(36).slice(-6)}${a.match(/\.[^.]+$/)}`,success:a=>{l({type:"image",url:a.fileID})},fail:e})}))));return await Promise.all(l)}catch(l){return console.error(l),h({title:l.message||"图片上传失败",icon:"none"}),[]}})(a.tempFilePaths);D.value.push(...l)}finally{y()}}})}})},z=()=>{k({itemList:["公开","仅好友可见","仅自己可见"],success:a=>{M.value=["public","friends","private"][a.tapIndex]}})},B=()=>{C({success:a=>{V.value=a.name}})};return(a,l)=>{const p=j,m=t,v=x,h=F,g=I,y=P;return c(),e(m,{class:"publish-container"},{default:s((()=>[o(m,{class:"nav-bar gradient-bar"},{default:s((()=>[o(m,{class:"nav-left"},{default:s((()=>[o(p,{class:"cancel",onClick:J},{default:s((()=>[o(p,{class:"cancel-icon"},{default:s((()=>[u("✕")])),_:1}),u(" 取消 ")])),_:1})])),_:1}),o(m,{class:"nav-center"},{default:s((()=>[o(p,{class:"nav-title"},{default:s((()=>[u("发布动态")])),_:1})])),_:1}),o(m,{class:"nav-right"},{default:s((()=>[o(p,{class:i(["publish",{active:A.value}]),onClick:O},{default:s((()=>[u(" 发表 ")])),_:1},8,["class"])])),_:1})])),_:1}),o(m,{class:"content-area"},{default:s((()=>[o(m,{class:"input-header"},{default:s((()=>[o(p,{class:"input-label"},{default:s((()=>[u("分享你的想法")])),_:1}),o(p,{class:"char-count"},{default:s((()=>[u(n(L.value.length)+"/1000",1)])),_:1})])),_:1}),o(v,{class:"content-input",modelValue:L.value,"onUpdate:modelValue":l[0]||(l[0]=a=>L.value=a),placeholder:"这一刻的想法...支持表情😊","placeholder-style":"color: #a0aec0;",maxlength:"1000","auto-height":""},null,8,["modelValue"]),o(m,{class:"input-footer"},{default:s((()=>[o(m,{class:"emoji-toolbar"},{default:s((()=>[o(p,{class:"emoji-btn",onClick:H},{default:s((()=>[o(p,{class:"emoji-icon"},{default:s((()=>[u("😊")])),_:1}),u(" 表情 ")])),_:1})])),_:1}),o(m,{class:"input-actions"},{default:s((()=>[o(p,{class:i(["word-count",{warning:L.value.length>800}])},{default:s((()=>[u(n(L.value.length),1)])),_:1},8,["class"])])),_:1})])),_:1}),G.value?(c(),e(m,{key:0,class:"emoji-panel"},{default:s((()=>[o(m,{class:"emoji-header"},{default:s((()=>[o(p,{class:"emoji-title"},{default:s((()=>[u("选择表情")])),_:1}),o(p,{class:"emoji-close",onClick:H},{default:s((()=>[u("✕")])),_:1})])),_:1}),o(h,{"scroll-x":"",class:"emoji-list"},{default:s((()=>[(c(),d(f,null,r(E,((a,l)=>o(p,{key:l,class:"emoji-item",onClick:l=>(a=>{L.value+=a})(a)},{default:s((()=>[u(n(a),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})):_("",!0)])),_:1}),(D.value.length,c(),e(m,{key:0,class:"media-area"},{default:s((()=>[o(m,{class:"media-header"},{default:s((()=>[o(p,{class:"media-title"},{default:s((()=>[u("媒体内容")])),_:1}),o(p,{class:"media-count"},{default:s((()=>[u(n(D.value.length)+"/9",1)])),_:1})])),_:1}),o(m,{class:"media-grid"},{default:s((()=>[(c(!0),d(f,null,r(D.value,((a,l)=>(c(),e(m,{key:l,class:"media-item"},{default:s((()=>[o(m,{class:"media-wrapper"},{default:s((()=>["image"===a.type?(c(),e(g,{key:0,src:a.url,mode:"aspectFill",class:"media-img",onClick:a=>(a=>{const l=D.value.filter((a=>"image"===a.type)).map((a=>a.url));b({urls:l,current:l[a]})})(l)},null,8,["src","onClick"])):"video"===a.type?(c(),e(m,{key:1,class:"video-preview-wrap"},{default:s((()=>[o(y,{src:a.url,class:"video-preview"},null,8,["src"]),o(m,{class:"video-overlay"},{default:s((()=>[o(p,{class:"video-play-icon"},{default:s((()=>[u("▶")])),_:1}),o(p,{class:"video-duration"},{default:s((()=>[u("00:30")])),_:1})])),_:1})])),_:2},1024)):_("",!0),o(m,{class:"media-actions"},{default:s((()=>[o(p,{class:"delete-btn",onClick:a=>(a=>{D.value.splice(a,1)})(l)},{default:s((()=>[u("✕")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),D.value.length<9?(c(),e(m,{key:0,class:"add-btn",onClick:T},{default:s((()=>[o(m,{class:"add-icon"},{default:s((()=>[u("+")])),_:1}),o(p,{class:"add-text"},{default:s((()=>[u("添加")])),_:1})])),_:1})):_("",!0)])),_:1})])),_:1})),o(m,{class:"bottom-options"},{default:s((()=>[o(m,{class:"options-header"},{default:s((()=>[o(p,{class:"options-title"},{default:s((()=>[u("发布设置")])),_:1})])),_:1}),o(m,{class:"option-item",onClick:z},{default:s((()=>[o(m,{class:"option-left"},{default:s((()=>[o(p,{class:"option-icon"},{default:s((()=>[u("👁️")])),_:1}),o(p,{class:"option-label"},{default:s((()=>[u("谁可以看")])),_:1})])),_:1}),o(m,{class:"option-right"},{default:s((()=>[o(p,{class:"option-value"},{default:s((()=>[u(n(q.value),1)])),_:1}),o(p,{class:"option-arrow"},{default:s((()=>[u("›")])),_:1})])),_:1})])),_:1}),o(m,{class:"option-item",onClick:B},{default:s((()=>[o(m,{class:"option-left"},{default:s((()=>[o(p,{class:"option-icon"},{default:s((()=>[u("📍")])),_:1}),o(p,{class:"option-label"},{default:s((()=>[u("所在位置")])),_:1})])),_:1}),o(m,{class:"option-right"},{default:s((()=>[o(p,{class:"option-value"},{default:s((()=>[u(n(V.value||"添加位置"),1)])),_:1}),o(p,{class:"option-arrow"},{default:s((()=>[u("›")])),_:1})])),_:1})])),_:1}),o(m,{class:"option-item"},{default:s((()=>[o(m,{class:"option-left"},{default:s((()=>[o(p,{class:"option-icon"},{default:s((()=>[u("@")])),_:1}),o(p,{class:"option-label"},{default:s((()=>[u("提醒谁看")])),_:1})])),_:1}),o(m,{class:"option-right"},{default:s((()=>[o(p,{class:"option-value"},{default:s((()=>[u(n(S.value.length?`已选${S.value.length}人`:"添加"),1)])),_:1}),o(p,{class:"option-arrow"},{default:s((()=>[u("›")])),_:1})])),_:1})])),_:1})])),_:1}),U.value?(c(),e(m,{key:1,class:"tech-loading"},{default:s((()=>[(c(),d(f,null,r(4,(a=>o(m,{class:"dot",key:a}))),64)),o(p,{class:"loading-text"},{default:s((()=>[u("发布中...")])),_:1})])),_:1})):_("",!0)])),_:1})}}},[["__scopeId","data-v-4eed1ea8"]]);export{L as default};
