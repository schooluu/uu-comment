import{r as a,O as l,e,w as s,x as t,c,f as o,h as u,k as i,t as n,i as d,j as r,F as f,A as _,G as p,H as m,l as v,s as h,a5 as g,J as y,D as k,a1 as w,q as b,a6 as C,v as j,L as x,S as F,y as I,U as P}from"./index-4VJyEHA-.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const L=$({__name:"add",setup($){const L=a(""),D=a([]),V=a(""),M=a("public"),S=a([]),U=a(!1),q=l((()=>({public:"å…¬å¼€",friends:"ä»…å¥½å‹å¯è§",private:"ä»…è‡ªå·±å¯è§"}[M.value]))),A=l((()=>L.value.trim()||D.value.length>0)),E=["ğŸ˜Š","ğŸ˜‚","ğŸ¤£","â¤ï¸","ğŸ˜","ğŸ¤”","ğŸ˜’","ğŸ‘","ğŸ‘","ğŸ˜³","ğŸ¥º","ğŸ˜­","ğŸ˜˜","ğŸ¤—","ğŸ™„","ğŸ˜´","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ˜ˆ","ğŸ‘»","ğŸ‘½","ğŸ¤–","ğŸ’©","ğŸ˜º","ğŸ’ª","ğŸ‘Š","âœŒï¸","ğŸ¤","ğŸ™","ğŸ‘","ğŸ™Œ","ğŸ‘","ğŸ¤²"],G=a(!1),H=()=>{G.value=!G.value},J=()=>{p()},O=async()=>{if(A.value){U.value=!0;try{m({title:"å‘å¸ƒä¸­..."});const{result:a}=await v.callFunction({name:"wx_add_moment",data:{content:L.value,mediaList:D.value,location:V.value,privacy:M.value}});if(0!==a.code)throw new Error(a.msg);h({title:"å‘å¸ƒæˆåŠŸ",icon:"success"}),g("refreshMoments"),setTimeout((()=>{p()}),1500)}catch(a){h({title:a.message||"å‘å¸ƒå¤±è´¥",icon:"none"})}finally{y(),U.value=!1}}},T=()=>{k({itemList:["æ‹æ‘„","ä»ç›¸å†Œé€‰æ‹©"],success:a=>{0===a.tapIndex||w({count:9-D.value.length,success:async a=>{m({title:"ä¸Šä¼ ä¸­..."});try{const l=await(async a=>{console.log("uploadImages",a[0]);try{const l=a.map((a=>new Promise(((l,e)=>{v.uploadFile({filePath:a,cloudPath:`wx-moments/${Date.now()}-${Math.random().toString(36).slice(-6)}${a.match(/\.[^.]+$/)}`,success:a=>{l({type:"image",url:a.fileID})},fail:e})}))));return await Promise.all(l)}catch(l){return console.error(l),h({title:l.message||"å›¾ç‰‡ä¸Šä¼ å¤±è´¥",icon:"none"}),[]}})(a.tempFilePaths);D.value.push(...l)}finally{y()}}})}})},z=()=>{k({itemList:["å…¬å¼€","ä»…å¥½å‹å¯è§","ä»…è‡ªå·±å¯è§"],success:a=>{M.value=["public","friends","private"][a.tapIndex]}})},B=()=>{C({success:a=>{V.value=a.name}})};return(a,l)=>{const p=j,m=t,v=x,h=F,g=I,y=P;return c(),e(m,{class:"publish-container"},{default:s((()=>[o(m,{class:"nav-bar gradient-bar"},{default:s((()=>[o(m,{class:"nav-left"},{default:s((()=>[o(p,{class:"cancel",onClick:J},{default:s((()=>[o(p,{class:"cancel-icon"},{default:s((()=>[u("âœ•")])),_:1}),u(" å–æ¶ˆ ")])),_:1})])),_:1}),o(m,{class:"nav-center"},{default:s((()=>[o(p,{class:"nav-title"},{default:s((()=>[u("å‘å¸ƒåŠ¨æ€")])),_:1})])),_:1}),o(m,{class:"nav-right"},{default:s((()=>[o(p,{class:i(["publish",{active:A.value}]),onClick:O},{default:s((()=>[u(" å‘è¡¨ ")])),_:1},8,["class"])])),_:1})])),_:1}),o(m,{class:"content-area"},{default:s((()=>[o(m,{class:"input-header"},{default:s((()=>[o(p,{class:"input-label"},{default:s((()=>[u("åˆ†äº«ä½ çš„æƒ³æ³•")])),_:1}),o(p,{class:"char-count"},{default:s((()=>[u(n(L.value.length)+"/1000",1)])),_:1})])),_:1}),o(v,{class:"content-input",modelValue:L.value,"onUpdate:modelValue":l[0]||(l[0]=a=>L.value=a),placeholder:"è¿™ä¸€åˆ»çš„æƒ³æ³•...æ”¯æŒè¡¨æƒ…ğŸ˜Š","placeholder-style":"color: #a0aec0;",maxlength:"1000","auto-height":""},null,8,["modelValue"]),o(m,{class:"input-footer"},{default:s((()=>[o(m,{class:"emoji-toolbar"},{default:s((()=>[o(p,{class:"emoji-btn",onClick:H},{default:s((()=>[o(p,{class:"emoji-icon"},{default:s((()=>[u("ğŸ˜Š")])),_:1}),u(" è¡¨æƒ… ")])),_:1})])),_:1}),o(m,{class:"input-actions"},{default:s((()=>[o(p,{class:i(["word-count",{warning:L.value.length>800}])},{default:s((()=>[u(n(L.value.length),1)])),_:1},8,["class"])])),_:1})])),_:1}),G.value?(c(),e(m,{key:0,class:"emoji-panel"},{default:s((()=>[o(m,{class:"emoji-header"},{default:s((()=>[o(p,{class:"emoji-title"},{default:s((()=>[u("é€‰æ‹©è¡¨æƒ…")])),_:1}),o(p,{class:"emoji-close",onClick:H},{default:s((()=>[u("âœ•")])),_:1})])),_:1}),o(h,{"scroll-x":"",class:"emoji-list"},{default:s((()=>[(c(),d(f,null,r(E,((a,l)=>o(p,{key:l,class:"emoji-item",onClick:l=>(a=>{L.value+=a})(a)},{default:s((()=>[u(n(a),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})):_("",!0)])),_:1}),(D.value.length,c(),e(m,{key:0,class:"media-area"},{default:s((()=>[o(m,{class:"media-header"},{default:s((()=>[o(p,{class:"media-title"},{default:s((()=>[u("åª’ä½“å†…å®¹")])),_:1}),o(p,{class:"media-count"},{default:s((()=>[u(n(D.value.length)+"/9",1)])),_:1})])),_:1}),o(m,{class:"media-grid"},{default:s((()=>[(c(!0),d(f,null,r(D.value,((a,l)=>(c(),e(m,{key:l,class:"media-item"},{default:s((()=>[o(m,{class:"media-wrapper"},{default:s((()=>["image"===a.type?(c(),e(g,{key:0,src:a.url,mode:"aspectFill",class:"media-img",onClick:a=>(a=>{const l=D.value.filter((a=>"image"===a.type)).map((a=>a.url));b({urls:l,current:l[a]})})(l)},null,8,["src","onClick"])):"video"===a.type?(c(),e(m,{key:1,class:"video-preview-wrap"},{default:s((()=>[o(y,{src:a.url,class:"video-preview"},null,8,["src"]),o(m,{class:"video-overlay"},{default:s((()=>[o(p,{class:"video-play-icon"},{default:s((()=>[u("â–¶")])),_:1}),o(p,{class:"video-duration"},{default:s((()=>[u("00:30")])),_:1})])),_:1})])),_:2},1024)):_("",!0),o(m,{class:"media-actions"},{default:s((()=>[o(p,{class:"delete-btn",onClick:a=>(a=>{D.value.splice(a,1)})(l)},{default:s((()=>[u("âœ•")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),D.value.length<9?(c(),e(m,{key:0,class:"add-btn",onClick:T},{default:s((()=>[o(m,{class:"add-icon"},{default:s((()=>[u("+")])),_:1}),o(p,{class:"add-text"},{default:s((()=>[u("æ·»åŠ ")])),_:1})])),_:1})):_("",!0)])),_:1})])),_:1})),o(m,{class:"bottom-options"},{default:s((()=>[o(m,{class:"options-header"},{default:s((()=>[o(p,{class:"options-title"},{default:s((()=>[u("å‘å¸ƒè®¾ç½®")])),_:1})])),_:1}),o(m,{class:"option-item",onClick:z},{default:s((()=>[o(m,{class:"option-left"},{default:s((()=>[o(p,{class:"option-icon"},{default:s((()=>[u("ğŸ‘ï¸")])),_:1}),o(p,{class:"option-label"},{default:s((()=>[u("è°å¯ä»¥çœ‹")])),_:1})])),_:1}),o(m,{class:"option-right"},{default:s((()=>[o(p,{class:"option-value"},{default:s((()=>[u(n(q.value),1)])),_:1}),o(p,{class:"option-arrow"},{default:s((()=>[u("â€º")])),_:1})])),_:1})])),_:1}),o(m,{class:"option-item",onClick:B},{default:s((()=>[o(m,{class:"option-left"},{default:s((()=>[o(p,{class:"option-icon"},{default:s((()=>[u("ğŸ“")])),_:1}),o(p,{class:"option-label"},{default:s((()=>[u("æ‰€åœ¨ä½ç½®")])),_:1})])),_:1}),o(m,{class:"option-right"},{default:s((()=>[o(p,{class:"option-value"},{default:s((()=>[u(n(V.value||"æ·»åŠ ä½ç½®"),1)])),_:1}),o(p,{class:"option-arrow"},{default:s((()=>[u("â€º")])),_:1})])),_:1})])),_:1}),o(m,{class:"option-item"},{default:s((()=>[o(m,{class:"option-left"},{default:s((()=>[o(p,{class:"option-icon"},{default:s((()=>[u("@")])),_:1}),o(p,{class:"option-label"},{default:s((()=>[u("æé†’è°çœ‹")])),_:1})])),_:1}),o(m,{class:"option-right"},{default:s((()=>[o(p,{class:"option-value"},{default:s((()=>[u(n(S.value.length?`å·²é€‰${S.value.length}äºº`:"æ·»åŠ "),1)])),_:1}),o(p,{class:"option-arrow"},{default:s((()=>[u("â€º")])),_:1})])),_:1})])),_:1})])),_:1}),U.value?(c(),e(m,{key:1,class:"tech-loading"},{default:s((()=>[(c(),d(f,null,r(4,(a=>o(m,{class:"dot",key:a}))),64)),o(p,{class:"loading-text"},{default:s((()=>[u("å‘å¸ƒä¸­...")])),_:1})])),_:1})):_("",!0)])),_:1})}}},[["__scopeId","data-v-4eed1ea8"]]);export{L as default};
