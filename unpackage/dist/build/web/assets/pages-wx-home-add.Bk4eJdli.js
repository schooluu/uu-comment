import{r as a,O as e,e as l,w as s,x as t,c,f as u,h as i,k as n,i as o,j as d,t as r,F as m,A as v,G as f,H as p,l as _,s as h,a6 as y,J as g,D as k,a1 as b,q as w,a7 as C,v as x,L as j,S as F,y as I,U as P}from"./index-D2hZ7yQh.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const L=$({__name:"add",setup($){const L=a(""),D=a([]),V=a(""),M=a("public"),S=a([]),U=a(!1),q=e((()=>({public:"ÂÖ¨ÂºÄ",friends:"‰ªÖÂ•ΩÂèãÂèØËßÅ",private:"‰ªÖËá™Â∑±ÂèØËßÅ"}[M.value]))),A=e((()=>L.value.trim()||D.value.length>0)),E=["üòä","üòÇ","ü§£","‚ù§Ô∏è","üòç","ü§î","üòí","üëç","üëé","üò≥","ü•∫","üò≠","üòò","ü§ó","üôÑ","üò¥","ü§Æ","ü§ß","üò∑","ü§í","ü§ï","üòà","üëª","üëΩ","ü§ñ","üí©","üò∫","üí™","üëä","‚úåÔ∏è","ü§û","üôè","üëè","üôå","üëê","ü§≤"],G=a(!1),H=()=>{G.value=!G.value},J=()=>{f()},O=async()=>{if(A.value){U.value=!0;try{p({title:"ÂèëÂ∏É‰∏≠..."});const{result:a}=await _.callFunction({name:"wx_add_moment",data:{content:L.value,mediaList:D.value,location:V.value,privacy:M.value}});if(0!==a.code)throw new Error(a.msg);h({title:"ÂèëÂ∏ÉÊàêÂäü",icon:"success"}),y("refreshMoments"),setTimeout((()=>{f()}),1500)}catch(a){h({title:a.message||"ÂèëÂ∏ÉÂ§±Ë¥•",icon:"none"})}finally{g(),U.value=!1}}},T=()=>{k({itemList:["ÊãçÊëÑ","‰ªéÁõ∏ÂÜåÈÄâÊã©"],success:a=>{0===a.tapIndex||b({count:9-D.value.length,success:async a=>{p({title:"‰∏ä‰º†‰∏≠..."});try{const e=await(async a=>{console.log("uploadImages",a[0]);try{const e=a.map((a=>new Promise(((e,l)=>{_.uploadFile({filePath:a,cloudPath:`wx-moments/${Date.now()}-${Math.random().toString(36).slice(-6)}${a.match(/\.[^.]+$/)}`,success:a=>{e({type:"image",url:a.fileID})},fail:l})}))));return await Promise.all(e)}catch(e){return console.error(e),h({title:e.message||"ÂõæÁâá‰∏ä‰º†Â§±Ë¥•",icon:"none"}),[]}})(a.tempFilePaths);D.value.push(...e)}finally{g()}}})}})},z=()=>{k({itemList:["ÂÖ¨ÂºÄ","‰ªÖÂ•ΩÂèãÂèØËßÅ","‰ªÖËá™Â∑±ÂèØËßÅ"],success:a=>{M.value=["public","friends","private"][a.tapIndex]}})},B=()=>{C({success:a=>{V.value=a.name}})};return(a,e)=>{const f=x,p=t,_=j,h=F,y=I,g=P;return c(),l(p,{class:"publish-container"},{default:s((()=>[u(p,{class:"nav-bar gradient-bar"},{default:s((()=>[u(f,{class:"cancel",onClick:J},{default:s((()=>[i("ÂèñÊ∂à")])),_:1}),u(p,{class:"publish-btn-wrap"},{default:s((()=>[u(f,{class:n(["publish",{active:A.value}]),onClick:O},{default:s((()=>[u(p,{class:"publish-btn-glow"}),i(" ÂèëË°® ")])),_:1},8,["class"])])),_:1})])),_:1}),u(p,{class:"content-area"},{default:s((()=>[u(_,{class:"content-input",modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=a=>L.value=a),placeholder:"Ëøô‰∏ÄÂàªÁöÑÊÉ≥Ê≥ï...ÊîØÊåÅË°®ÊÉÖüòä","placeholder-style":"color: #999;",maxlength:"1000","auto-height":""},null,8,["modelValue"]),u(p,{class:"emoji-toolbar"},{default:s((()=>[u(f,{class:"emoji-btn",onClick:H},{default:s((()=>[i("üòä")])),_:1})])),_:1}),G.value?(c(),l(p,{key:0,class:"emoji-panel"},{default:s((()=>[u(h,{"scroll-x":"",class:"emoji-list"},{default:s((()=>[(c(),o(m,null,d(E,((a,e)=>u(f,{key:e,class:"emoji-item",onClick:e=>(a=>{L.value+=a})(a)},{default:s((()=>[i(r(a),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})):v("",!0)])),_:1}),u(p,{class:"media-area"},{default:s((()=>[u(p,{class:"media-grid"},{default:s((()=>[(c(!0),o(m,null,d(D.value,((a,e)=>(c(),l(p,{key:e,class:"media-item"},{default:s((()=>["image"===a.type?(c(),l(y,{key:0,src:a.url,mode:"aspectFill",class:"media-img",onClick:a=>(a=>{const e=D.value.filter((a=>"image"===a.type)).map((a=>a.url));w({urls:e,current:e[a]})})(e)},null,8,["src","onClick"])):"video"===a.type?(c(),l(p,{key:1,class:"video-preview-wrap"},{default:s((()=>[u(g,{src:a.url,class:"video-preview video-radius"},null,8,["src"]),u(p,{class:"video-play-icon"},{default:s((()=>[i("‚ñ∂")])),_:1})])),_:2},1024)):v("",!0),u(p,{class:"delete-btn",onClick:a=>(a=>{D.value.splice(a,1)})(e)},{default:s((()=>[i("√ó")])),_:2},1032,["onClick"])])),_:2},1024)))),128)),D.value.length<9?(c(),l(p,{key:0,class:"add-btn",onClick:T},{default:s((()=>[u(f,{class:"iconfont"},{default:s((()=>[i("+")])),_:1})])),_:1})):v("",!0)])),_:1})])),_:1}),u(p,{class:"bottom-options"},{default:s((()=>[u(p,{class:"option-item",onClick:z},{default:s((()=>[u(f,null,{default:s((()=>[i("Ë∞ÅÂèØ‰ª•Áúã")])),_:1}),u(f,{class:"value"},{default:s((()=>[i(r(q.value),1)])),_:1})])),_:1}),u(p,{class:"option-item",onClick:B},{default:s((()=>[u(f,null,{default:s((()=>[i("ÊâÄÂú®‰ΩçÁΩÆ")])),_:1}),u(f,{class:"value"},{default:s((()=>[i(r(V.value||"Ê∑ªÂä†‰ΩçÁΩÆ"),1)])),_:1})])),_:1}),u(p,{class:"option-item"},{default:s((()=>[u(f,null,{default:s((()=>[i("ÊèêÈÜíË∞ÅÁúã")])),_:1}),u(f,{class:"value"},{default:s((()=>[i(r(S.value.length?`Â∑≤ÈÄâ${S.value.length}‰∫∫`:"Ê∑ªÂä†"),1)])),_:1})])),_:1})])),_:1}),U.value?(c(),l(p,{key:0,class:"tech-loading"},{default:s((()=>[(c(),o(m,null,d(4,(a=>u(p,{class:"dot",key:a}))),64)),u(f,{class:"loading-text"},{default:s((()=>[i("ÂèëÂ∏É‰∏≠...")])),_:1})])),_:1})):v("",!0)])),_:1})}}},[["__scopeId","data-v-0c10e04c"]]);export{L as default};
