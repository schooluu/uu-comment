import{r as a,O as e,e as l,w as s,x as t,c,f as u,h as n,k as o,t as i,i as d,j as r,F as f,A as p,G as v,H as _,l as m,s as h,a7 as y,J as k,a1 as g,q as w,v as b,L as C,S as j,y as q,U as x,I as V,a6 as Q}from"./index-ExXaUzHb.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=F({__name:"add",setup(F){const P=a(""),E=a([]),I=a(""),U=a("public");a([]);const J=a(!1);e((()=>({public:"公开",friends:"仅好友可见",private:"仅自己可见"}[U.value])));const L=e((()=>P.value.trim()||E.value.length>0)),O=["😊","😂","🤣","❤️","😍","🤔","😒","👍","👎","😳","🥺","😭","😘","🤗","🙄","😴","🤮","🤧","😷","🤒","🤕","😈","👻","👽","🤖","💩","😺","💪","👊","✌️","🤞","🙏","👏","🙌","👐","🤲"],S=a(!1),T=()=>{S.value=!S.value},$=()=>{v()},A=async()=>{if(L.value){J.value=!0;try{_({title:"发布中..."});const{result:a}=await m.callFunction({name:"wx_add_moment",data:{content:P.value,mediaList:E.value,location:I.value,privacy:U.value,contactType:H.value,contactValue:M.value}});if(0!==a.code)throw new Error(a.msg);h({title:"发布成功",icon:"success"}),y("refreshMoments"),setTimeout((()=>{v()}),1500)}catch(a){h({title:a.message||"发布失败",icon:"none"})}finally{k(),J.value=!1}}},D=()=>{g({count:9-E.value.length,success:async a=>{_({title:"上传中..."});try{const e=await(async a=>{console.log("uploadImages",a[0]);try{const e=a.map((a=>new Promise(((e,l)=>{Q({url:"http://117.72.208.124:40027/api/v1/upload",filePath:a,name:"file",formData:{},success:a=>{try{const s=JSON.parse(a.data);s.status?e({type:"image",url:s.data.links.url,key:s.data.key,thumbnail_url:s.data.links.thumbnail_url}):l(new Error(s.message||"上传失败"))}catch(s){l(new Error("解析上传结果失败"))}},fail:a=>{console.error("上传失败:",a),l(a)}})}))));return await Promise.all(e)}catch(e){return console.error(e),h({title:e.message||"图片上传失败",icon:"none"}),[]}})(a.tempFilePaths);E.value.push(...e)}finally{k()}}})},G=a(!1),H=a("wechat"),M=a(""),N={wechat:"请输入微信号",phone:"请输入手机号",qq:"请输入QQ号",email:"请输入邮箱"},z=e((()=>N[H.value]));e((()=>{if(!M.value)return"未填写";return`${{wechat:"微信",phone:"手机",qq:"QQ",email:"邮箱"}[H.value]}: ${M.value}`}));const B=a=>{H.value=a},K=()=>{G.value=!1},R=()=>{M.value=""};return(a,e)=>{const v=b,_=t,m=C,h=j,y=q,k=x,g=V;return c(),l(_,{class:"publish-container"},{default:s((()=>[u(_,{class:"nav-bar gradient-bar"},{default:s((()=>[u(_,{class:"nav-left"},{default:s((()=>[u(v,{class:"cancel",onClick:$},{default:s((()=>[u(v,{class:"cancel-icon"},{default:s((()=>[n("✕")])),_:1}),n(" 取消 ")])),_:1})])),_:1}),u(_,{class:"nav-center"},{default:s((()=>[u(v,{class:"nav-title"},{default:s((()=>[n("发布动态")])),_:1})])),_:1}),u(_,{class:"nav-right"},{default:s((()=>[u(v,{class:o(["publish",{active:L.value}]),onClick:A},{default:s((()=>[n(" 发表 ")])),_:1},8,["class"])])),_:1})])),_:1}),u(_,{class:"content-area"},{default:s((()=>[u(_,{class:"input-header"},{default:s((()=>[u(v,{class:"input-label"},{default:s((()=>[n("分享你的想法")])),_:1}),u(v,{class:"char-count"},{default:s((()=>[n(i(P.value.length)+"/1000",1)])),_:1})])),_:1}),u(m,{class:"content-input",modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=a=>P.value=a),placeholder:"这一刻的想法...支持表情😊","placeholder-style":"color: #a0aec0;",maxlength:"1000","auto-height":""},null,8,["modelValue"]),u(_,{class:"input-footer"},{default:s((()=>[u(_,{class:"emoji-toolbar"},{default:s((()=>[u(v,{class:"emoji-btn",onClick:T},{default:s((()=>[u(v,{class:"emoji-icon"},{default:s((()=>[n("😊")])),_:1}),n(" 表情 ")])),_:1})])),_:1}),u(_,{class:"input-actions"},{default:s((()=>[u(v,{class:o(["word-count",{warning:P.value.length>800}])},{default:s((()=>[n(i(P.value.length),1)])),_:1},8,["class"])])),_:1})])),_:1}),S.value?(c(),l(_,{key:0,class:"emoji-panel"},{default:s((()=>[u(_,{class:"emoji-header"},{default:s((()=>[u(v,{class:"emoji-title"},{default:s((()=>[n("选择表情")])),_:1}),u(v,{class:"emoji-close",onClick:T},{default:s((()=>[n("✕")])),_:1})])),_:1}),u(h,{"scroll-x":"",class:"emoji-list"},{default:s((()=>[(c(),d(f,null,r(O,((a,e)=>u(v,{key:e,class:"emoji-item",onClick:e=>(a=>{P.value+=a})(a)},{default:s((()=>[n(i(a),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})):p("",!0)])),_:1}),(E.value.length,c(),l(_,{key:0,class:"media-area"},{default:s((()=>[u(_,{class:"media-header"},{default:s((()=>[u(v,{class:"media-title"},{default:s((()=>[n("照片")])),_:1}),u(v,{class:"media-count"},{default:s((()=>[n(i(E.value.length)+"/9",1)])),_:1})])),_:1}),u(_,{class:"media-grid"},{default:s((()=>[(c(!0),d(f,null,r(E.value,((a,e)=>(c(),l(_,{key:e,class:"media-item"},{default:s((()=>[u(_,{class:"media-wrapper"},{default:s((()=>["image"===a.type?(c(),l(y,{key:0,src:a.url,mode:"aspectFill",class:"media-img",onClick:a=>(a=>{const e=E.value.filter((a=>"image"===a.type)).map((a=>a.url));w({urls:e,current:e[a]})})(e)},null,8,["src","onClick"])):"video"===a.type?(c(),l(_,{key:1,class:"video-preview-wrap"},{default:s((()=>[u(k,{src:a.url,class:"video-preview"},null,8,["src"]),u(_,{class:"video-overlay"},{default:s((()=>[u(v,{class:"video-play-icon"},{default:s((()=>[n("▶")])),_:1}),u(v,{class:"video-duration"},{default:s((()=>[n("00:30")])),_:1})])),_:1})])),_:2},1024)):p("",!0),u(_,{class:"media-actions"},{default:s((()=>[u(v,{class:"delete-btn",onClick:a=>(a=>{E.value.splice(a,1)})(e)},{default:s((()=>[n("✕")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),E.value.length<9?(c(),l(_,{key:0,class:"add-btn",onClick:D},{default:s((()=>[u(_,{class:"add-icon"},{default:s((()=>[n("+")])),_:1}),u(v,{class:"add-text"},{default:s((()=>[n("添加")])),_:1})])),_:1})):p("",!0)])),_:1})])),_:1})),u(_,{class:"bottom-options"},{default:s((()=>[u(_,{class:"options-header"},{default:s((()=>[u(v,{class:"options-title"},{default:s((()=>[n("发布设置")])),_:1})])),_:1})])),_:1}),G.value?(c(),l(_,{key:1,class:"contact-panel"},{default:s((()=>[u(_,{class:"cp-row"},{default:s((()=>[u(v,{class:"cp-label"},{default:s((()=>[n("方式")])),_:1}),u(_,{class:"cp-types"},{default:s((()=>[u(v,{class:o(["cp-type","wechat"===H.value?"active":""]),onClick:e[1]||(e[1]=a=>B("wechat"))},{default:s((()=>[n("微信")])),_:1},8,["class"]),u(v,{class:o(["cp-type","phone"===H.value?"active":""]),onClick:e[2]||(e[2]=a=>B("phone"))},{default:s((()=>[n("手机")])),_:1},8,["class"]),u(v,{class:o(["cp-type","qq"===H.value?"active":""]),onClick:e[3]||(e[3]=a=>B("qq"))},{default:s((()=>[n("QQ")])),_:1},8,["class"]),u(v,{class:o(["cp-type","email"===H.value?"active":""]),onClick:e[4]||(e[4]=a=>B("email"))},{default:s((()=>[n("邮箱")])),_:1},8,["class"])])),_:1})])),_:1}),u(_,{class:"cp-row"},{default:s((()=>[u(v,{class:"cp-label"},{default:s((()=>[n("号码/账号")])),_:1}),u(g,{class:"cp-input",modelValue:M.value,"onUpdate:modelValue":e[5]||(e[5]=a=>M.value=a),placeholder:z.value},null,8,["modelValue","placeholder"])])),_:1}),u(_,{class:"cp-actions"},{default:s((()=>[u(v,{class:"cp-btn ghost",onClick:R},{default:s((()=>[n("清空")])),_:1}),u(v,{class:"cp-btn primary",onClick:K},{default:s((()=>[n("完成")])),_:1})])),_:1})])),_:1})):p("",!0),J.value?(c(),l(_,{key:2,class:"tech-loading"},{default:s((()=>[(c(),d(f,null,r(4,(a=>u(_,{class:"dot",key:a}))),64)),u(v,{class:"loading-text"},{default:s((()=>[n("发布中...")])),_:1})])),_:1})):p("",!0)])),_:1})}}},[["__scopeId","data-v-85ea70aa"]]);export{P as default};
