import{d as a,r as e,g as t,o as l,a as s,E as n,b as u,c,e as o,w as d,f as i,h as r,n as m,u as f,t as _,A as v,i as p,j as y,F as g,k as h,G as w,H as b,l as C,s as k,J as x,v as S,x as V,I as j,z as F}from"./index-DolKuS2b.js";import{_ as z}from"./uni-rate.yNwYjwbZ.js";import{r as I}from"./uni-app.es.cDdfTPLK.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";const $=T(a({__name:"detail",setup(a){const T=e(null),$=e([]),A=e(0),D=e(""),M=t().statusBarHeight,H=e("default"),N=()=>{w()},U=()=>{uni.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},B=async a=>{try{const{result:e}=await C.callFunction({name:"getCompanyComments",data:{companyId:a}});0===e.code&&($.value=e.data)}catch(e){k({title:"获取评论失败",icon:"none"})}},E=async()=>{try{b({title:"发表中..."});const{result:a}=await C.callFunction({name:"addCompanyComment",data:{companyId:T.value._id,content:D.value,rating:A.value}});0===a.code&&(k({title:"评论成功"}),D.value="",A.value=0,await B(T.value._id)),x()}catch(a){k({title:"评论失败",icon:"none"})}},G=a=>{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`};return l((()=>{const a=s("theme");a&&(H.value=a);const e=n(),t=e[e.length-1].options.id;t&&((async a=>{b({title:"加载中..."});try{const{result:e}=await C.callFunction({name:"getCompanyDetail",data:{id:a}});0===e.code&&(T.value=e.data)}catch(e){k({title:"获取详情失败",icon:"none"})}finally{x()}})(t),B(t))})),(a,e)=>{const t=S,l=V,s=I(u("uni-rate"),z),n=j,w=F;return c(),o(l,{class:h(["container",`theme-${H.value}`])},{default:d((()=>[i(l,{class:"nav-bar",style:m({paddingTop:f(M)+"px"})},{default:d((()=>[i(l,{class:"nav-content"},{default:d((()=>[i(l,{class:"nav-left"},{default:d((()=>[i(l,{class:"back-btn",onClick:N},{default:d((()=>[i(t,{class:"icon"},{default:d((()=>[r("←")])),_:1})])),_:1}),i(t,{class:"nav-title"},{default:d((()=>[r("详情")])),_:1})])),_:1}),i(l,{class:"nav-right"},{default:d((()=>[i(l,{class:"share-btn",onClick:U},{default:d((()=>[i(t,{class:"icon"},{default:d((()=>[r("📤")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),i(l,{class:"main-content",style:m({paddingTop:f(M)+88+"rpx"})},{default:d((()=>[T.value?(c(),o(l,{key:0,class:"company-info"},{default:d((()=>[i(l,{class:"header"},{default:d((()=>[i(t,{class:"name"},{default:d((()=>[r(_(T.value.companyName),1)])),_:1}),i(l,{class:"stats-box"},{default:d((()=>[i(l,{class:"rating-box"},{default:d((()=>[i(s,{value:T.value.rating,size:"15"},null,8,["value"]),i(t,{class:"review-count"},{default:d((()=>[r(_(T.value.reviewCount||0)+"条点评",1)])),_:1})])),_:1}),i(t,{class:"view-count"},{default:d((()=>[i(t,{class:"icon"},{default:d((()=>[r("👁️")])),_:1}),r(" "+_(T.value.viewCount||0),1)])),_:1})])),_:1}),i(t,{class:"address"},{default:d((()=>[r(_(T.value.address),1)])),_:1})])),_:1})])),_:1})):v("",!0),T.value?(c(),o(l,{key:1,class:"company-info comments-section"},{default:d((()=>[i(l,{class:"section-title"},{default:d((()=>[i(t,{class:"title"},{default:d((()=>[r("评价")])),_:1})])),_:1}),i(l,{style:{color:"darkorange"}},{default:d((()=>[r(_(T.value.cons),1)])),_:1})])),_:1})):v("",!0),i(l,{class:"comments-section"},{default:d((()=>[i(l,{class:"section-title"},{default:d((()=>[i(t,{class:"title"},{default:d((()=>[r("看法")])),_:1}),i(t,{class:"count"},{default:d((()=>[r("("+_($.value.length)+")",1)])),_:1})])),_:1}),i(l,{class:"comment-list"},{default:d((()=>[(c(!0),p(g,null,y($.value,(a=>(c(),o(l,{key:a._id,class:"comment-item"},{default:d((()=>[i(l,{class:"comment-header"},{default:d((()=>[i(l,{class:"user-info"},{default:d((()=>[i(t,{class:"username"},{default:d((()=>[r(_(a.userName||"匿名用户"),1)])),_:2},1024),i(s,{value:a.rating,size:"15"},null,8,["value"])])),_:2},1024),i(t,{class:"time"},{default:d((()=>[r(_(G(a.createdAt)),1)])),_:2},1024)])),_:2},1024),i(l,{class:"comment-content"},{default:d((()=>[i(t,{class:"text"},{default:d((()=>[r(_(a.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),i(l,{class:"comment-form"},{default:d((()=>[i(l,{class:"rating-input"},{default:d((()=>[i(s,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=a=>A.value=a),size:"20"},null,8,["modelValue"])])),_:1}),i(n,{class:"input",modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=a=>D.value=a),placeholder:"说说你的看法...",onConfirm:E},null,8,["modelValue"]),i(w,{class:"submit-btn",onClick:E},{default:d((()=>[i(t,{class:"icon"},{default:d((()=>[r("✏️")])),_:1}),i(t,null,{default:d((()=>[r("发表")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1},8,["class"])}}}),[["__scopeId","data-v-6bc23098"]]);export{$ as default};
