import{r as e,o as a,e as t,w as l,k as s,l as o,s as n,a4 as c,x as i,c as u,f as r,u as m,n as d,h as f,t as p,i as h,j as _,F as v,A as g,B as k,m as y,q as b,D as w,y as M,v as C,P as x,Q as T,U as j,I,z as F,S as q}from"./index-DolKuS2b.js";import{a as L,b as S,c as P,o as U,d as E}from"./uni-app.es.cDdfTPLK.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";const D=V({__name:"index",setup(V){const D=["æ˜Ÿæ²³æ—…äºº","å¤æ—¥å¾®é£","è“è“æ±½æ°´","æ©™å­æ±½çƒ","å¤œç©ºå®ˆæœ›","æ™¨æ›¦å¾®å…‰","äº‘ç«¯æ¼«æ­¥","æœˆä¸‹ç‹¬è¡Œ","ç™½èŒ¶æ¸…æ¬¢","é’æŸ æ—¶å…‰","æ¸©æŸ”æ˜Ÿçƒ","æ™´ç©ºä¸‡é‡Œ","é£ä¸­è¯—äºº","æµ·ç›å†°æ²™","å±±é‡å¬é£","æ©˜å­æµ·å²¸","é“¶æ²³ä¿¡ä½¿","å¾®å…‰æ‹¾æ¢¦","æ™šé£é‚®å·®","é›¾é‡Œçœ‹èŠ±","æ£®æ—ä¹‹å¿ƒ","é›¨ååˆæ™´","äº‘æœµæ”¶é›†è€…","å¤å¤œè¤ç«"];function Q(){return D[Math.floor(Math.random()*D.length)]}const $=["https://qcloud.dpfile.com/pc/pawK4KeJSDNVINhfwh9CoLJPFluB-tnHSd3heJ_jybtNIYslSlGEPeQVyA4hZRCP.jpg","https://images.unsplash.com/photo-1502685104226-ee32379fefbe?auto=format&fit=crop&w=256&q=60","https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=256&q=60","https://images.unsplash.com/photo-1527980965255-d3b416303d12?auto=format&fit=crop&w=256&q=60","https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?auto=format&fit=crop&w=256&q=60"],J=$[Math.floor(Math.random()*$.length)],N=["https://img1.imgtp.com/2023/07/10/0Qv6Qw4w.png","https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=1200&q=60","https://images.unsplash.com/photo-1517816743773-6e0fd518b4a6?auto=format&fit=crop&w=1200&q=60","https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d?auto=format&fit=crop&w=1200&q=60","https://images.unsplash.com/photo-1520975693411-0010e4aeba47?auto=format&fit=crop&w=1200&q=60"],z=N[Math.floor(Math.random()*N.length)],A=J,B=["ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡ï¼","åŒ¿ååˆ†äº«ï¼Œè½»æ¾è‡ªåœ¨~","æ¯ä¸€å¤©éƒ½å€¼å¾—è®°å½•ã€‚","ç”¨å¿ƒæ„Ÿå—ç”Ÿæ´»çš„ç¾å¥½ã€‚","ç§‘æŠ€è®©åŒ¿åæ›´æ¸©æš–ã€‚","ä¸–ç•Œå¾ˆå¤§ï¼Œå¿ƒæƒ…å¾ˆç¾ã€‚","åšè‡ªå·±çš„å°å¤ªé˜³ â˜€ï¸","åŒ¿åä¸å­¤å•ï¼Œæ¸©æš–åœ¨èº«è¾¹ã€‚","è®°å½•æ­¤åˆ»ï¼Œé‡è§æ›´å¥½çš„è‡ªå·±ã€‚","ä¿æŒå¥½å¥‡ï¼Œä¿æŒçƒ­çˆ±ï¼"],H=B[Math.floor(Math.random()*B.length)],K=["åŒ¿åæ ‘æ´ Â· ç¾å¥½ç”Ÿæ´»","ç”¨æ¸©æŸ”æ²»æ„ˆä¸–ç•Œ","æ¯ä¸€å¤©éƒ½å€¼å¾—è®°å½•","è®©å¿ƒæƒ…è‡ªç”±æµåŠ¨","ç§‘æŠ€è®©æ¸©æš–å‘ç”Ÿ","åœ¨è¿™é‡Œé‡è§ç¾å¥½","åˆ†äº«ä½ çš„æ•…äº‹","åšè‡ªå·±çš„å°å¤ªé˜³","ä¸–ç•Œå¾ˆå¤§ï¼Œæ¸©æš–å¾ˆè¿‘","ç”¨åŒ¿åå®ˆæŠ¤çœŸå¿ƒ"];e(K[0]);const Y=e(""),G=e(!0);let R=null,Z=0,O=0;function W(){clearTimeout(R);const e=K[Z];Y.value="",O=0,function a(){O<=e.length?(Y.value=e.slice(0,O),O++,R=setTimeout(a,60)):setTimeout((()=>{Z=(Z+1)%K.length,W()}),1800)}()}a((()=>{W(),setInterval((()=>{G.value=!G.value}),500)}));const X=e(!1),ee=e(!1),ae=e(""),te=e(-1),le=e({}),se=e(1),oe=e(10),ne=e(!1),ce=e(!0),ie=e([]),ue=async(e=!1)=>{if(!ne.value&&(ce.value||e))try{ne.value=!0;const a=new Promise((e=>setTimeout(e,800))),[{result:t}]=await Promise.all([o.callFunction({name:"wx_get_list",data:{page:e?1:se.value,pageSize:oe.value}}),a]);if(0!==t.code)throw new Error(t.msg);{const a=t.data.list.map((e=>({...e,username:Q(),avatar:$[Math.floor(Math.random()*$.length)],comments:(e.comments||[]).map((e=>({...e,username:Q(),avatar:$[Math.floor(Math.random()*$.length)]}))),likes:(e.likes||[]).map((()=>Q()))})));if(e)ie.value=a,se.value=2;else{const e=new Set((ie.value||[]).map((e=>e._id))),t=a.filter((a=>!e.has(a._id)));ie.value=[...ie.value||[],...t],se.value++}ce.value=t.data.hasMore}}catch(a){n({title:a.message||"è·å–æœ‹å‹åœˆå¤±è´¥",icon:"none"})}finally{ne.value=!1,e&&c()}};L((()=>{Ie(),je(),setTimeout((()=>{ue(!0)}),3e3)})),S((()=>{Ie()})),P((()=>{Ie()})),U((()=>{!ne.value&&ce.value&&ue()}));const re=async()=>{if(ae.value.trim()){X.value=!1,ee.value=!1,n({title:"è¯„è®ºæˆåŠŸ",icon:"none"});try{const{result:e}=await o.callFunction({name:"wx_add_comment",data:{momentId:ie.value[te.value]._id,content:ae.value}});if(0!==e.code)throw new Error(e.msg);{const e=ie.value[te.value];e.comments||(e.comments=[]),e.comments.push({username:Q(),content:ae.value,create_time:Date.now()}),ae.value=""}}catch(e){n({title:e.message||"è¯„è®ºå¤±è´¥",icon:"none"})}}},me=async()=>{y({url:"/pages/wx/home/add"})},de=()=>{X.value=!1,ee.value=!1,ae.value="",te.value=-1},fe=()=>{ee.value=!ee.value},pe=()=>{n({title:"è§†é¢‘åŠ è½½å¤±è´¥",icon:"none"})},he=()=>{n({title:"æœç´¢å³å°†ä¸Šçº¿",icon:"none"})},_e=()=>{w({itemList:["åˆ‡æ¢ä¸»é¢˜","å†…å®¹åå¥½","å¸®åŠ©ä¸åé¦ˆ"],success:e=>{const a=e.tapIndex;0===a&&n({title:"å·²åˆ‡æ¢ä¸»é¢˜",icon:"none"}),1===a&&n({title:"åå¥½è®¾ç½®æš‚æœªå¼€æ”¾",icon:"none"}),2===a&&n({title:"æ„Ÿè°¢ä½ çš„åé¦ˆ",icon:"none"})}})},ve=e(0);E((e=>{const a=e.scrollTop||0;ve.value=Math.min(30,.2*a)}));const ge=e("theme-day"),ke=()=>{const e=(new Date).getHours();ge.value=e>=6&&e<11?"theme-morning":e>=11&&e<18?"theme-day":"theme-night"};a((()=>{ke(),setInterval(ke,6e5)}));const ye=e(!1),be=e([]);let we=0;const Me=e=>{const a=be.value.findIndex((a=>a.id===e));-1!==a&&be.value.splice(a,1)},Ce=(e=4,a=1e3)=>{ye.value=!0;const t=Math.max(1,e),l=Math.floor(a/t);for(let s=0;s<t;s++){setTimeout((()=>{const e=we++;be.value.push({id:e,x:Math.floor(10+80*Math.random()),y:Math.floor(18+54*Math.random()),theme:["t-blue","t-violet","t-gold","t-mint","t-pink"][Math.floor(5*Math.random())]}),setTimeout((()=>{Me(e),0===be.value.length&&(ye.value=!1)}),2200)}),s*l)}},xe=async e=>{try{const a=ie.value[e];le.value[e]=!0;const{result:t}=await o.callFunction({name:"wx_add_toggle_like",data:{momentId:a._id}});if(0!==t.code)throw new Error(t.msg);a.isLiked=t.data.isLiked,a.isLiked?(a.likes||(a.likes=[]),a.likes.push(Q())):a.likes.pop(),setTimeout((()=>{le.value[e]=!1}),1e3)}catch(a){n({title:a.message||"æ“ä½œå¤±è´¥",icon:"none"})}};let Te=null;const je=()=>{Te||(ye.value=!0,Te=setInterval((()=>{const e=3+Math.floor(3*Math.random()),a=1e3+Math.floor(600*Math.random());Ce(e,a)}),1500+Math.floor(900*Math.random())))},Ie=()=>{clearInterval(Te),Te=null,ye.value=!1,be.value=[]},Fe=e=>{const a=e.likes&&e.likes.length||0,t=e.comments&&e.comments.length||0,l="video"===e.mediaType;return Math.floor(3*a+5*t+(l?18:8))},qe=e("recommend"),Le=e=>{qe.value=e,n({title:"recommend"===e?"æ¨è":"follow"===e?"å…³æ³¨":"é™„è¿‘",icon:"none"})},Se=e({}),Pe=e([{tag:"# çƒ­è®®",title:"ä»Šå¤©ä½ åŒ¿åè¡¨ç™½äº†å—ï¼Ÿ",sub:"çœŸå®è¡¨è¾¾è®©ä¸–ç•Œæ›´æ¸©æŸ”"},{tag:"# é™„è¿‘",title:"åŸå¸‚æ ‘æ´ï¼šè¯´è¯´ä½ çš„å°çƒ¦æ¼",sub:"æœ‰äººæ­£ç»å†ç€åŒæ ·çš„å¿ƒæƒ…"},{tag:"# æ¨è",title:"ä¸‰ä»¶è®©ä½ å¿«ä¹çš„å°äº‹",sub:"è®°å½•å¾®å…‰ï¼Œè®©ç”Ÿæ´»å‘äº®"}]),Ue=["ğŸ˜Š","ğŸ˜‚","ğŸ¤£","â¤ï¸","ğŸ˜","ğŸ¤”","ğŸ˜’","ğŸ‘","ğŸ‘","ğŸ˜³","ğŸ¥º","ğŸ˜­","ğŸ˜˜","ğŸ¤—","ğŸ™„","ğŸ˜´","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ˜ˆ","ğŸ‘»","ğŸ‘½","ğŸ¤–","ğŸ’©","ğŸ˜º","ğŸ’ª","ğŸ‘Š","âœŒï¸","ğŸ¤","ğŸ™","ğŸ‘","ğŸ™Œ","ğŸ‘","ğŸ¤²"];return(e,a)=>{const o=M,c=i,y=C,L=x,S=T,P=j,U=I,E=F,V=q;return u(),t(c,{class:s(["moments-container",ge.value])},{default:l((()=>[r(c,{class:"header"},{default:l((()=>[r(o,{class:"bg-image",src:m(z),mode:"aspectFill",style:d({transform:`translateY(${ve.value}px) scale(1.06)`})},null,8,["src","style"]),r(c,{class:"header-gradient"}),r(c,{class:"header-blur"}),r(c,{class:"header-glow"}),r(c,{class:"header-topbar"},{default:l((()=>[r(y,{class:"brand"},{default:l((()=>[f("åŒ¿ååœˆ")])),_:1}),r(c,{class:"top-actions"},{default:l((()=>[r(y,{class:"top-icon",onClick:he},{default:l((()=>[f("ğŸ”")])),_:1}),r(y,{class:"top-icon",onClick:_e},{default:l((()=>[f("â‹¯")])),_:1})])),_:1})])),_:1}),r(c,{class:"hero-card"},{default:l((()=>[r(o,{class:"hero-avatar",src:m(A),mode:"aspectFill"},null,8,["src"]),r(c,{class:"hero-text"},{default:l((()=>[r(y,{class:"hero-title"},{default:l((()=>[f(p(m(H)),1)])),_:1}),r(y,{class:"hero-sub"},{default:l((()=>[f("åŒ¿å Â· æ¸©æš– Â· çœŸå®")])),_:1}),r(c,{class:"hero-chips"},{default:l((()=>[r(y,{class:"chip active"},{default:l((()=>[f("æ¨è")])),_:1}),r(y,{class:"chip"},{default:l((()=>[f("å…³æ³¨")])),_:1}),r(y,{class:"chip"},{default:l((()=>[f("é™„è¿‘")])),_:1})])),_:1})])),_:1}),r(c,{class:"hero-cta",onClick:me},{default:l((()=>[r(y,{class:"cta-plus"},{default:l((()=>[f("+")])),_:1})])),_:1})])),_:1})])),_:1}),r(c,{class:"banner-topics"},{default:l((()=>[r(S,{class:"banner-swiper",circular:"",autoplay:"",interval:"4000"},{default:l((()=>[(u(!0),h(v,null,_(Pe.value,((e,a)=>(u(),t(L,{key:a},{default:l((()=>[r(c,{class:"topic-card",onClick:a=>(e=>{n({title:e.tag+" Â· "+e.title,icon:"none"})})(e)},{default:l((()=>[r(c,{class:"topic-tag"},{default:l((()=>[f(p(e.tag),1)])),_:2},1024),r(y,{class:"topic-title"},{default:l((()=>[f(p(e.title),1)])),_:2},1024),r(y,{class:"topic-sub"},{default:l((()=>[f(p(e.sub),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),r(c,{class:"segmented-tabs"},{default:l((()=>[r(c,{class:"seg-pill active",onClick:a[0]||(a[0]=e=>Le("recommend"))},{default:l((()=>[f("æ¨è")])),_:1}),r(c,{class:"seg-pill",onClick:a[1]||(a[1]=e=>Le("follow"))},{default:l((()=>[f("å…³æ³¨")])),_:1}),r(c,{class:"seg-pill",onClick:a[2]||(a[2]=e=>Le("nearby"))},{default:l((()=>[f("é™„è¿‘")])),_:1})])),_:1}),r(c,{class:"moments-list"},{default:l((()=>[(u(!0),h(v,null,_(ie.value,((e,a)=>(u(),t(c,{class:"moment-item",key:a},{default:l((()=>[r(o,{class:"user-avatar avatar-glow",src:e.avatar,mode:"aspectFill"},null,8,["src"]),r(c,{class:"content-area"},{default:l((()=>[r(c,{class:"meta-row"},{default:l((()=>[r(y,{class:"username"},{default:l((()=>[f(p(e.username),1)])),_:2},1024)])),_:2},1024),r(c,{class:"chip-row"},{default:l((()=>[r(y,{class:"chip"},{default:l((()=>[f("åŒ¿å")])),_:1}),e.mediaType?(u(),t(y,{key:0,class:"chip ghost"},{default:l((()=>[f("å›¾æ–‡")])),_:1})):g("",!0)])),_:2},1024),r(c,{class:s(["text-block",{clamped:!Se.value[a]}])},{default:l((()=>[r(y,{class:"text-content"},{default:l((()=>[f(p(e.content),1)])),_:2},1024)])),_:2},1032,["class"]),e.content&&e.content.length>60?(u(),t(c,{key:0,class:"expand-btn",onClick:e=>(e=>{Se.value[e]=!Se.value[e]})(a)},{default:l((()=>[f(p(Se.value[a]?"æ”¶èµ·":"å±•å¼€"),1)])),_:2},1032,["onClick"])):g("",!0),e.mediaType?(u(),t(c,{key:1,class:"media-content"},{default:l((()=>["video"===e.mediaType?(u(),t(P,{key:0,src:e.mediaUrl,poster:e.poster,class:"video-content video-radius",controls:"","show-center-play-btn":"","enable-play-gesture":"","show-fullscreen-btn":"","show-play-btn":"","object-fit":"contain",onError:pe},null,8,["src","poster"])):"image"===e.mediaType?(u(),t(c,{key:1,class:s(["image-gallery",`columns-${e.mediaUrls.length}`])},{default:l((()=>[(u(!0),h(v,null,_(e.mediaUrls,((a,l)=>(u(),t(o,{key:l,src:a,mode:"aspectFill",class:"image-content image-radius",onClick:t=>{return l=e.mediaUrls,s=a,void(l&&l.length&&b({urls:l,current:s}));var l,s}},null,8,["src","onClick"])))),128))])),_:2},1032,["class"])):g("",!0),r(c,{class:"media-badges"},{default:l((()=>[r(c,{class:"badge ghost"},{default:l((()=>[r(y,{class:"b-ic"},{default:l((()=>[f("ğŸ”¥")])),_:1}),r(y,{class:"b-txt"},{default:l((()=>{return[f(p((a=Fe(e),a||0===a?a>=1e4?(a/1e4).toFixed(1).replace(/\.0$/,"")+"w":a>=1e3?(a/1e3).toFixed(1).replace(/\.0$/,"")+"k":String(a):"0")),1)];var a})),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)):g("",!0),r(c,{class:"bottom-info"},{default:l((()=>[r(y,{class:"time"},{default:l((()=>[f(p(e.time),1)])),_:2},1024),r(c,{class:"actions"},{default:l((()=>[r(c,{class:s(["action-btn like-btn",{liked:e.isLiked,animating:le.value[a]}]),onClick:e=>(async e=>{await xe(e),Ce(3)})(a)},{default:l((()=>[r(y,{class:"icon iconfont"},{default:l((()=>[f(p(e.isLiked?"â¤ï¸":"ğŸ¤"),1)])),_:2},1024),r(y,{class:"action-text"},{default:l((()=>[f(p(e.isLiked?"å·²èµ":"ç‚¹èµ"),1)])),_:2},1024),r(y,{class:"action-count"},{default:l((()=>[f(p(e.likes&&e.likes.length||0),1)])),_:2},1024),le.value[a]?(u(),t(c,{key:0,class:"like-burst-particles"},{default:l((()=>[(u(),h(v,null,_(8,(e=>r(c,{key:e,class:s(["particle","p"+e])},null,8,["class"]))),64))])),_:1})):g("",!0)])),_:2},1032,["class","onClick"]),r(c,{class:"action-btn comment-btn",onClick:e=>(e=>{te.value=e,X.value=!0})(a)},{default:l((()=>[r(y,{class:"icon iconfont"},{default:l((()=>[f("ğŸ’¬")])),_:1}),r(y,{class:"action-text"},{default:l((()=>[f("è¯„è®º")])),_:1}),r(y,{class:"action-count"},{default:l((()=>[f(p(e.comments&&e.comments.length||0),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),e.likes&&e.likes.length?(u(),t(c,{key:2,class:"likes-section"},{default:l((()=>[r(y,{class:"like-users"},{default:l((()=>[f(p(e.likes.join("ã€")),1)])),_:2},1024)])),_:2},1024)):g("",!0),e.comments&&0!==e.comments.length?(u(),t(c,{key:3,class:"comments-section"},{default:l((()=>[(u(!0),h(v,null,_(e.comments,((e,a)=>(u(),t(c,{class:"comment-item",key:a},{default:l((()=>[r(o,{class:"comment-anon-icon",src:e.avatar||m(J)},null,8,["src"]),r(y,{class:"comment-user"},{default:l((()=>[f(p(e.username)+"ï¼š",1)])),_:2},1024),r(y,{class:"comment-content"},{default:l((()=>[f(p(e.content),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):g("",!0)])),_:2},1024),r(c,{class:"more-btn",onClick:e=>{w({itemList:["ä¸¾æŠ¥","æ‹‰é»‘","ä¸æ„Ÿå…´è¶£"],success:e=>{const a=e.tapIndex;0===a?n({title:"å·²æ”¶åˆ°ä¸¾æŠ¥",icon:"none"}):1===a?n({title:"å·²æ‹‰é»‘è¯¥ç”¨æˆ·",icon:"none"}):2===a&&n({title:"å°†å‡å°‘ç±»ä¼¼å†…å®¹",icon:"none"})}})}},{default:l((()=>[f("â‹¯")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),X.value?(u(),t(c,{key:0,class:"comment-popup",onClick:de},{default:l((()=>[r(c,{class:"comment-box animated-popup",onClick:a[4]||(a[4]=k((()=>{}),["stop"]))},{default:l((()=>[r(c,{class:"comment-input-area"},{default:l((()=>[r(U,{class:"comment-input",modelValue:ae.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ae.value=e),placeholder:"@åŒ¿åç”¨æˆ· è¯´ç‚¹ä»€ä¹ˆ...",focus:X.value,onConfirm:re},null,8,["modelValue","focus"]),r(c,{class:"toolbar"},{default:l((()=>[r(y,{class:"emoji-btn",onClick:fe},{default:l((()=>[f("ğŸ˜Š")])),_:1}),r(E,{class:s(["submit-btn",{active:ae.value.trim()}]),onClick:re},{default:l((()=>[f("å‘é€")])),_:1},8,["class"])])),_:1})])),_:1}),ee.value?(u(),t(c,{key:0,class:"emoji-panel"},{default:l((()=>[r(V,{"scroll-y":"",class:"emoji-list"},{default:l((()=>[r(c,{class:"emoji-group"},{default:l((()=>[(u(),h(v,null,_(Ue,((e,a)=>r(y,{key:a,class:"emoji-item",onClick:a=>(e=>{ae.value+=e})(e)},{default:l((()=>[f(p(e),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1})):g("",!0),r(c,{class:"publish-btn",onClick:me},{default:l((()=>[r(c,{class:"icon-wrapper"},{default:l((()=>[r(y,{class:"iconfont"},{default:l((()=>[f("+")])),_:1})])),_:1})])),_:1}),ye.value?(u(),t(c,{key:1,class:"fireworks"},{default:l((()=>[(u(!0),h(v,null,_(be.value,(e=>(u(),t(c,{key:e.id,class:"fw",style:d({left:e.x+"%",top:e.y+"%"})},{default:l((()=>[(u(),h(v,null,_(12,(a=>r(c,{key:a,class:s(["fw-p","p"+a,e.theme])},null,8,["class"]))),64))])),_:2},1032,["style"])))),128))])),_:1})):g("",!0)])),_:1},8,["class"])}}},[["__scopeId","data-v-940cf185"]]);export{D as default};
