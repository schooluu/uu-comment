import{d as a,r as e,b as t,A as l,e as s,o as n,c as u,w as c,a as o,f as d,t as i,h as m,j as r,k as f,F as _,B as v,Y as p,s as y,C as g,x as h,i as w,I as C,z as b}from"./index-CL_BCzV3.js";import{r as k,a as x,_ as V}from"./uni-rate.DN3BOT3k.js";const F=V(a({__name:"detail",setup(a){const V=e(null),F=e([]),z=e(0),I=e(""),S=async a=>{try{const{result:e}=await p.callFunction({name:"getCompanyComments",data:{companyId:a}});0===e.code&&(F.value=e.data)}catch(e){y({title:"获取评论失败",icon:"none"})}},j=async()=>{try{v({title:"发表中..."});const{result:a}=await p.callFunction({name:"addCompanyComment",data:{companyId:V.value._id,content:I.value,rating:z.value}});0===a.code&&(y({title:"评论成功"}),I.value="",z.value=0,await S(V.value._id)),g()}catch(a){y({title:"评论失败",icon:"none"})}},D=a=>{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`};return t((()=>{const a=l(),e=a[a.length-1].options.id;e&&((async a=>{v({title:"加载中..."});try{const{result:e}=await p.callFunction({name:"getCompanyDetail",data:{id:a}});0===e.code&&(V.value=e.data)}catch(e){y({title:"获取详情失败",icon:"none"})}finally{g()}})(e),S(e))})),(a,e)=>{const t=h,l=k(s("uni-rate"),x),v=w,p=C,y=b;return n(),u(v,{class:"container"},{default:c((()=>[V.value?(n(),u(v,{key:0,class:"company-info"},{default:c((()=>[o(v,{class:"header"},{default:c((()=>[o(t,{class:"name"},{default:c((()=>[d(i(V.value.companyName),1)])),_:1}),o(v,{class:"stats-box"},{default:c((()=>[o(v,{class:"rating-box"},{default:c((()=>[o(l,{value:V.value.rating,size:"15"},null,8,["value"]),o(t,{class:"review-count"},{default:c((()=>[d(i(V.value.reviewCount||0)+"条点评",1)])),_:1})])),_:1}),o(t,{class:"view-count"},{default:c((()=>[o(t,{class:"icon"},{default:c((()=>[d("👁️")])),_:1}),d(" "+i(V.value.viewCount||0),1)])),_:1})])),_:1}),o(t,{class:"address"},{default:c((()=>[d(i(V.value.address),1)])),_:1})])),_:1})])),_:1})):m("",!0),V.value?(n(),u(v,{key:1,class:"company-info comments-section"},{default:c((()=>[o(v,{class:"section-title"},{default:c((()=>[o(t,{class:"title"},{default:c((()=>[d("评价")])),_:1})])),_:1}),o(v,{style:{color:"darkorange"}},{default:c((()=>[d(i(V.value.cons),1)])),_:1})])),_:1})):m("",!0),o(v,{class:"comments-section"},{default:c((()=>[o(v,{class:"section-title"},{default:c((()=>[o(t,{class:"title"},{default:c((()=>[d("看法")])),_:1}),o(t,{class:"count"},{default:c((()=>[d("("+i(F.value.length)+")",1)])),_:1})])),_:1}),o(v,{class:"comment-list"},{default:c((()=>[(n(!0),r(_,null,f(F.value,(a=>(n(),u(v,{key:a._id,class:"comment-item"},{default:c((()=>[o(v,{class:"comment-header"},{default:c((()=>[o(v,{class:"user-info"},{default:c((()=>[o(t,{class:"username"},{default:c((()=>[d(i(a.userName||"匿名用户"),1)])),_:2},1024),o(l,{value:a.rating,size:"15"},null,8,["value"])])),_:2},1024),o(t,{class:"time"},{default:c((()=>[d(i(D(a.createdAt)),1)])),_:2},1024)])),_:2},1024),o(v,{class:"comment-content"},{default:c((()=>[o(t,{class:"text"},{default:c((()=>[d(i(a.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),o(v,{class:"comment-form"},{default:c((()=>[o(v,{class:"rating-input"},{default:c((()=>[o(l,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=a=>z.value=a),size:"20"},null,8,["modelValue"])])),_:1}),o(p,{class:"input",modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=a=>I.value=a),placeholder:"说说你的看法...",onConfirm:j},null,8,["modelValue"]),o(y,{class:"submit-btn",onClick:j},{default:c((()=>[o(t,{class:"icon"},{default:c((()=>[d("✏️")])),_:1}),o(t,null,{default:c((()=>[d("发表")])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-5b34fe37"]]);export{F as default};
