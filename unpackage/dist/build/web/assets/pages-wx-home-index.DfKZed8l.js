import{r as e,o as a,e as l,w as t,k as s,l as n,s as c,a4 as o,x as i,c as u,f as d,n as r,h as m,u as f,t as p,i as _,j as v,F as h,A as k,B as g,m as y,q as b,D as w,y as C,v as x,P as M,Q as j,U as I,I as T,z as F,S as L}from"./index-6yya9Cs4.js";import{a as S,b as P,c as V,o as E,d as J}from"./uni-app.es.BJtxcYaS.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U="https://qcloud.dpfile.com/pc/pawK4KeJSDNVINhfwh9CoLJPFluB-tnHSd3heJ_jybtNIYslSlGEPeQVyA4hZRCP.jpg",D=N({__name:"index",setup(N){const D=["星河旅人","夏日微风","蓝莓汽水","橙子汽球","夜空守望","晨曦微光","云端漫步","月下独行","白茶清欢","青柠时光","温柔星球","晴空万里","风中诗人","海盐冰沙","山野听风","橘子海岸","银河信使","微光拾梦","晚风邮差","雾里看花","森林之心","雨后初晴","云朵收集者","夏夜萤火"];function Q(){return D[Math.floor(Math.random()*D.length)]}const K=["今天也要元气满满！","匿名分享，轻松自在~","每一天都值得记录。","用心感受生活的美好。","科技让匿名更温暖。","世界很大，心情很美。","做自己的小太阳 ☀️","匿名不孤单，温暖在身边。","记录此刻，遇见更好的自己。","保持好奇，保持热爱！"],$=K[Math.floor(Math.random()*K.length)],q=["匿名树洞 · 美好生活","用温柔治愈世界","每一天都值得记录","让心情自由流动","科技让温暖发生","在这里遇见美好","分享你的故事","做自己的小太阳","世界很大，温暖很近","用匿名守护真心"];e(q[0]);const A=e(""),B=e(!0);let H=null,Y=0,z=0;function G(){clearTimeout(H);const e=q[Y];A.value="",z=0,function a(){z<=e.length?(A.value=e.slice(0,z),z++,H=setTimeout(a,60)):setTimeout((()=>{Y=(Y+1)%q.length,G()}),1800)}()}a((()=>{G(),setInterval((()=>{B.value=!B.value}),500)}));const R=e(!1),Z=e(!1),O=e(""),W=e(-1),X=e({}),ee=e(1),ae=e(10),le=e(!1),te=e(!0),se=e([]),ne=async(e=!1)=>{if(!le.value&&(te.value||e))try{le.value=!0;const a=new Promise((e=>setTimeout(e,800))),[{result:l}]=await Promise.all([n.callFunction({name:"wx_get_list",data:{page:e?1:ee.value,pageSize:ae.value}}),a]);if(0!==l.code)throw new Error(l.msg);{const a=l.data.list.map((e=>({...e,username:Q(),avatar:U,comments:(e.comments||[]).map((e=>({...e,username:Q()}))),likes:(e.likes||[]).map((()=>Q()))})));if(e)se.value=a,ee.value=2;else{const e=new Set((se.value||[]).map((e=>e._id))),l=a.filter((a=>!e.has(a._id)));se.value=[...se.value||[],...l],ee.value++}te.value=l.data.hasMore}}catch(a){c({title:a.message||"获取朋友圈失败",icon:"none"})}finally{le.value=!1,e&&o()}};S((()=>{xe(),Ce(),setTimeout((()=>{ne(!0)}),3e3)})),P((()=>{xe()})),V((()=>{xe()})),E((()=>{!le.value&&te.value&&ne()}));const ce=async()=>{if(O.value.trim()){R.value=!1,Z.value=!1,c({title:"评论成功",icon:"none"});try{const{result:e}=await n.callFunction({name:"wx_add_comment",data:{momentId:se.value[W.value]._id,content:O.value}});if(0!==e.code)throw new Error(e.msg);{const e=se.value[W.value];e.comments||(e.comments=[]),e.comments.push({username:Q(),content:O.value,create_time:Date.now()}),O.value=""}}catch(e){c({title:e.message||"评论失败",icon:"none"})}}},oe=async()=>{y({url:"/pages/wx/home/add"})},ie=()=>{R.value=!1,Z.value=!1,O.value="",W.value=-1},ue=()=>{Z.value=!Z.value},de=()=>{c({title:"视频加载失败",icon:"none"})},re=()=>{c({title:"搜索即将上线",icon:"none"})},me=()=>{w({itemList:["切换主题","内容偏好","帮助与反馈"],success:e=>{const a=e.tapIndex;0===a&&c({title:"已切换主题",icon:"none"}),1===a&&c({title:"偏好设置暂未开放",icon:"none"}),2===a&&c({title:"感谢你的反馈",icon:"none"})}})},fe=e(0);J((e=>{const a=e.scrollTop||0;fe.value=Math.min(30,.2*a)}));const pe=e("theme-day"),_e=()=>{const e=(new Date).getHours();pe.value=e>=6&&e<11?"theme-morning":e>=11&&e<18?"theme-day":"theme-night"};a((()=>{_e(),setInterval(_e,6e5)}));const ve=e(!1),he=e([]);let ke=0;const ge=e=>{const a=he.value.findIndex((a=>a.id===e));-1!==a&&he.value.splice(a,1)},ye=(e=4,a=1e3)=>{ve.value=!0;const l=Math.max(1,e),t=Math.floor(a/l);for(let s=0;s<l;s++){setTimeout((()=>{const e=ke++;he.value.push({id:e,x:Math.floor(10+80*Math.random()),y:Math.floor(18+54*Math.random()),theme:["t-blue","t-violet","t-gold","t-mint","t-pink"][Math.floor(5*Math.random())]}),setTimeout((()=>{ge(e),0===he.value.length&&(ve.value=!1)}),2200)}),s*t)}},be=async e=>{try{const a=se.value[e];X.value[e]=!0;const{result:l}=await n.callFunction({name:"wx_add_toggle_like",data:{momentId:a._id}});if(0!==l.code)throw new Error(l.msg);a.isLiked=l.data.isLiked,a.isLiked?(a.likes||(a.likes=[]),a.likes.push(Q())):a.likes.pop(),setTimeout((()=>{X.value[e]=!1}),1e3)}catch(a){c({title:a.message||"操作失败",icon:"none"})}};let we=null;const Ce=()=>{we||(ve.value=!0,we=setInterval((()=>{const e=3+Math.floor(3*Math.random()),a=1e3+Math.floor(600*Math.random());ye(e,a)}),1500+Math.floor(900*Math.random())))},xe=()=>{clearInterval(we),we=null,ve.value=!1,he.value=[]},Me=e=>{const a=e.likes&&e.likes.length||0,l=e.comments&&e.comments.length||0,t="video"===e.mediaType;return Math.floor(3*a+5*l+(t?18:8))},je=e("recommend"),Ie=e=>{je.value=e,c({title:"recommend"===e?"推荐":"follow"===e?"关注":"附近",icon:"none"})},Te=e({}),Fe=e([{tag:"# 热议",title:"今天你匿名表白了吗？",sub:"真实表达让世界更温柔"},{tag:"# 附近",title:"城市树洞：说说你的小烦恼",sub:"有人正经历着同样的心情"},{tag:"# 推荐",title:"三件让你快乐的小事",sub:"记录微光，让生活发亮"}]),Le=["😊","😂","🤣","❤️","😍","🤔","😒","👍","👎","😳","🥺","😭","😘","🤗","🙄","😴","🤮","🤧","😷","🤒","🤕","😈","👻","👽","🤖","💩","😺","💪","👊","✌️","🤞","🙏","👏","🙌","👐","🤲"];return(e,a)=>{const n=C,o=i,y=x,S=M,P=j,V=I,E=T,J=F,N=L;return u(),l(o,{class:s(["moments-container",pe.value])},{default:t((()=>[d(o,{class:"header"},{default:t((()=>[d(n,{class:"bg-image",src:"https://img1.imgtp.com/2023/07/10/0Qv6Qw4w.png",mode:"aspectFill",style:r({transform:`translateY(${fe.value}px) scale(1.06)`})},null,8,["style"]),d(o,{class:"header-gradient"}),d(o,{class:"header-blur"}),d(o,{class:"header-glow"}),d(o,{class:"header-topbar"},{default:t((()=>[d(y,{class:"brand"},{default:t((()=>[m("匿名圈")])),_:1}),d(o,{class:"top-actions"},{default:t((()=>[d(y,{class:"top-icon",onClick:re},{default:t((()=>[m("🔍")])),_:1}),d(y,{class:"top-icon",onClick:me},{default:t((()=>[m("⋯")])),_:1})])),_:1})])),_:1}),d(o,{class:"hero-card"},{default:t((()=>[d(n,{class:"hero-avatar",src:f("https://qcloud.dpfile.com/pc/pawK4KeJSDNVINhfwh9CoLJPFluB-tnHSd3heJ_jybtNIYslSlGEPeQVyA4hZRCP.jpg"),mode:"aspectFill"},null,8,["src"]),d(o,{class:"hero-text"},{default:t((()=>[d(y,{class:"hero-title"},{default:t((()=>[m(p(f($)),1)])),_:1}),d(y,{class:"hero-sub"},{default:t((()=>[m("匿名 · 温暖 · 真实")])),_:1}),d(o,{class:"hero-chips"},{default:t((()=>[d(y,{class:"chip active"},{default:t((()=>[m("推荐")])),_:1}),d(y,{class:"chip"},{default:t((()=>[m("关注")])),_:1}),d(y,{class:"chip"},{default:t((()=>[m("附近")])),_:1})])),_:1})])),_:1}),d(o,{class:"hero-cta",onClick:oe},{default:t((()=>[d(y,{class:"cta-plus"},{default:t((()=>[m("+")])),_:1})])),_:1})])),_:1})])),_:1}),d(o,{class:"banner-topics"},{default:t((()=>[d(P,{class:"banner-swiper",circular:"",autoplay:"",interval:"4000"},{default:t((()=>[(u(!0),_(h,null,v(Fe.value,((e,a)=>(u(),l(S,{key:a},{default:t((()=>[d(o,{class:"topic-card",onClick:a=>(e=>{c({title:e.tag+" · "+e.title,icon:"none"})})(e)},{default:t((()=>[d(o,{class:"topic-tag"},{default:t((()=>[m(p(e.tag),1)])),_:2},1024),d(y,{class:"topic-title"},{default:t((()=>[m(p(e.title),1)])),_:2},1024),d(y,{class:"topic-sub"},{default:t((()=>[m(p(e.sub),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),d(o,{class:"segmented-tabs"},{default:t((()=>[d(o,{class:"seg-pill active",onClick:a[0]||(a[0]=e=>Ie("recommend"))},{default:t((()=>[m("推荐")])),_:1}),d(o,{class:"seg-pill",onClick:a[1]||(a[1]=e=>Ie("follow"))},{default:t((()=>[m("关注")])),_:1}),d(o,{class:"seg-pill",onClick:a[2]||(a[2]=e=>Ie("nearby"))},{default:t((()=>[m("附近")])),_:1})])),_:1}),d(o,{class:"moments-list"},{default:t((()=>[(u(!0),_(h,null,v(se.value,((e,a)=>(u(),l(o,{class:"moment-item",key:a},{default:t((()=>[d(n,{class:"user-avatar avatar-glow",src:e.avatar,mode:"aspectFill"},null,8,["src"]),d(o,{class:"content-area"},{default:t((()=>[d(o,{class:"meta-row"},{default:t((()=>[d(y,{class:"username"},{default:t((()=>[m(p(e.username),1)])),_:2},1024)])),_:2},1024),d(o,{class:"chip-row"},{default:t((()=>[d(y,{class:"chip"},{default:t((()=>[m("匿名")])),_:1}),e.mediaType?(u(),l(y,{key:0,class:"chip ghost"},{default:t((()=>[m("图文")])),_:1})):k("",!0)])),_:2},1024),d(o,{class:s(["text-block",{clamped:!Te.value[a]}])},{default:t((()=>[d(y,{class:"text-content"},{default:t((()=>[m(p(e.content),1)])),_:2},1024)])),_:2},1032,["class"]),e.content&&e.content.length>60?(u(),l(o,{key:0,class:"expand-btn",onClick:e=>(e=>{Te.value[e]=!Te.value[e]})(a)},{default:t((()=>[m(p(Te.value[a]?"收起":"展开"),1)])),_:2},1032,["onClick"])):k("",!0),e.mediaType?(u(),l(o,{key:1,class:"media-content"},{default:t((()=>["video"===e.mediaType?(u(),l(V,{key:0,src:e.mediaUrl,poster:e.poster,class:"video-content video-radius",controls:"","show-center-play-btn":"","enable-play-gesture":"","show-fullscreen-btn":"","show-play-btn":"","object-fit":"contain",onError:de},null,8,["src","poster"])):"image"===e.mediaType?(u(),l(o,{key:1,class:s(["image-gallery",`columns-${e.mediaUrls.length}`])},{default:t((()=>[(u(!0),_(h,null,v(e.mediaUrls,((a,t)=>(u(),l(n,{key:t,src:a,mode:"aspectFill",class:"image-content image-radius",onClick:l=>{return t=e.mediaUrls,s=a,void(t&&t.length&&b({urls:t,current:s}));var t,s}},null,8,["src","onClick"])))),128))])),_:2},1032,["class"])):k("",!0),d(o,{class:"media-badges"},{default:t((()=>[d(o,{class:"badge ghost"},{default:t((()=>[d(y,{class:"b-ic"},{default:t((()=>[m("🔥")])),_:1}),d(y,{class:"b-txt"},{default:t((()=>{return[m(p((a=Me(e),a||0===a?a>=1e4?(a/1e4).toFixed(1).replace(/\.0$/,"")+"w":a>=1e3?(a/1e3).toFixed(1).replace(/\.0$/,"")+"k":String(a):"0")),1)];var a})),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)):k("",!0),d(o,{class:"bottom-info"},{default:t((()=>[d(y,{class:"time"},{default:t((()=>[m(p(e.time),1)])),_:2},1024),d(o,{class:"actions"},{default:t((()=>[d(o,{class:s(["action-btn like-btn",{liked:e.isLiked,animating:X.value[a]}]),onClick:e=>(async e=>{await be(e),ye(3)})(a)},{default:t((()=>[d(y,{class:"icon iconfont"},{default:t((()=>[m(p(e.isLiked?"❤️":"🤍"),1)])),_:2},1024),d(y,{class:"action-text"},{default:t((()=>[m(p(e.isLiked?"已赞":"点赞"),1)])),_:2},1024),d(y,{class:"action-count"},{default:t((()=>[m(p(e.likes&&e.likes.length||0),1)])),_:2},1024),X.value[a]?(u(),l(o,{key:0,class:"like-burst-particles"},{default:t((()=>[(u(),_(h,null,v(8,(e=>d(o,{key:e,class:s(["particle","p"+e])},null,8,["class"]))),64))])),_:1})):k("",!0)])),_:2},1032,["class","onClick"]),d(o,{class:"action-btn comment-btn",onClick:e=>(e=>{W.value=e,R.value=!0})(a)},{default:t((()=>[d(y,{class:"icon iconfont"},{default:t((()=>[m("💬")])),_:1}),d(y,{class:"action-text"},{default:t((()=>[m("评论")])),_:1}),d(y,{class:"action-count"},{default:t((()=>[m(p(e.comments&&e.comments.length||0),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),e.likes&&e.likes.length?(u(),l(o,{key:2,class:"likes-section"},{default:t((()=>[d(y,{class:"like-users"},{default:t((()=>[m(p(e.likes.join("、")),1)])),_:2},1024)])),_:2},1024)):k("",!0),e.comments&&0!==e.comments.length?(u(),l(o,{key:3,class:"comments-section"},{default:t((()=>[(u(!0),_(h,null,v(e.comments,((e,a)=>(u(),l(o,{class:"comment-item",key:a},{default:t((()=>[d(n,{class:"comment-anon-icon",src:U}),d(y,{class:"comment-user"},{default:t((()=>[m(p(e.username)+"：",1)])),_:2},1024),d(y,{class:"comment-content"},{default:t((()=>[m(p(e.content),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):k("",!0)])),_:2},1024),d(o,{class:"more-btn",onClick:e=>{w({itemList:["举报","拉黑","不感兴趣"],success:e=>{const a=e.tapIndex;0===a?c({title:"已收到举报",icon:"none"}):1===a?c({title:"已拉黑该用户",icon:"none"}):2===a&&c({title:"将减少类似内容",icon:"none"})}})}},{default:t((()=>[m("⋯")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),R.value?(u(),l(o,{key:0,class:"comment-popup",onClick:ie},{default:t((()=>[d(o,{class:"comment-box animated-popup",onClick:a[4]||(a[4]=g((()=>{}),["stop"]))},{default:t((()=>[d(o,{class:"comment-input-area"},{default:t((()=>[d(E,{class:"comment-input",modelValue:O.value,"onUpdate:modelValue":a[3]||(a[3]=e=>O.value=e),placeholder:"@匿名用户 说点什么...",focus:R.value,onConfirm:ce},null,8,["modelValue","focus"]),d(o,{class:"toolbar"},{default:t((()=>[d(y,{class:"emoji-btn",onClick:ue},{default:t((()=>[m("😊")])),_:1}),d(J,{class:s(["submit-btn",{active:O.value.trim()}]),onClick:ce},{default:t((()=>[m("发送")])),_:1},8,["class"])])),_:1})])),_:1}),Z.value?(u(),l(o,{key:0,class:"emoji-panel"},{default:t((()=>[d(N,{"scroll-y":"",class:"emoji-list"},{default:t((()=>[d(o,{class:"emoji-group"},{default:t((()=>[(u(),_(h,null,v(Le,((e,a)=>d(y,{key:a,class:"emoji-item",onClick:a=>(e=>{O.value+=e})(e)},{default:t((()=>[m(p(e),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})):k("",!0)])),_:1})])),_:1})):k("",!0),d(o,{class:"publish-btn",onClick:oe},{default:t((()=>[d(o,{class:"icon-wrapper"},{default:t((()=>[d(y,{class:"iconfont"},{default:t((()=>[m("+")])),_:1})])),_:1})])),_:1}),ve.value?(u(),l(o,{key:1,class:"fireworks"},{default:t((()=>[(u(!0),_(h,null,v(he.value,(e=>(u(),l(o,{key:e.id,class:"fw",style:r({left:e.x+"%",top:e.y+"%"})},{default:t((()=>[(u(),_(h,null,v(12,(a=>d(o,{key:a,class:s(["fw-p","p"+a,e.theme])},null,8,["class"]))),64))])),_:2},1032,["style"])))),128))])),_:1})):k("",!0)])),_:1},8,["class"])}}},[["__scopeId","data-v-22e0c3d8"]]);export{D as default};
