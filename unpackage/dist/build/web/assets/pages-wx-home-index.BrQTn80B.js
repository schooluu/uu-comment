import{r as e,o as t,e as a,w as l,k as s,l as o,s as c,a4 as n,x as u,c as i,f as m,u as r,n as d,h,t as f,i as p,j as v,F as _,A as g,B as k,m as w,q as y,D as b,y as x,v as M,P as C,Q as j,U as I,I as q,z as T,S}from"./index-CGMfUl55.js";import{a as F,b as L,c as E,o as P,d as U}from"./uni-app.es.BGDVTpuT.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=H({__name:"index",setup(H){const V=["星河旅人","夏日微风","蓝莓汽水","橙子汽球","夜空守望","晨曦微光","云端漫步","月下独行","白茶清欢","青柠时光","温柔星球","晴空万里","风中诗人","海盐冰沙","山野听风","橘子海岸","银河信使","微光拾梦","晚风邮差","雾里看花","森林之心","雨后初晴","云朵收集者","夏夜萤火"];function A(){return V[Math.floor(Math.random()*V.length)]}const D=["https://qcloud.dpfile.com/pc/pawK4KeJSDNVINhfwh9CoLJPFluB-tnHSd3heJ_jybtNIYslSlGEPeQVyA4hZRCP.jpg","https://images.unsplash.com/photo-1502685104226-ee32379fefbe?auto=format&fit=crop&w=256&q=60","https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=256&q=60","https://images.unsplash.com/photo-1527980965255-d3b416303d12?auto=format&fit=crop&w=256&q=60","https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?auto=format&fit=crop&w=256&q=60","https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=256&q=60","https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=256&q=60"],Q=D[Math.floor(Math.random()*D.length)],$=["https://img1.imgtp.com/2023/07/10/0Qv6Qw4w.png","https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=1400&q=60","https://images.unsplash.com/photo-1517816743773-6e0fd518b4a6?auto=format&fit=crop&w=1400&q=60","https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d?auto=format&fit=crop&w=1400&q=60","https://images.unsplash.com/photo-1520975693411-0010e4aeba47?auto=format&fit=crop&w=1400&q=60","https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1400&q=60","https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?auto=format&fit=crop&w=1400&q=60"],J=$[Math.floor(Math.random()*$.length)],N=Q,z=["今天也要元气满满！","匿名分享，轻松自在~","每一天都值得记录。","用心感受生活的美好。","科技让匿名更温暖。","世界很大，心情很美。","做自己的小太阳 ☀️","匿名不孤单，温暖在身边。","记录此刻，遇见更好的自己。","保持好奇，保持热爱！"],B=z[Math.floor(Math.random()*z.length)],K=["匿名树洞 · 美好生活","用温柔治愈世界","每一天都值得记录","让心情自由流动","科技让温暖发生","在这里遇见美好","分享你的故事","做自己的小太阳","世界很大，温暖很近","用匿名守护真心"];e(K[0]);const Y=e(""),G=e(!0);let R=null,Z=0,O=0;function W(){clearTimeout(R);const e=K[Z];Y.value="",O=0,function t(){O<=e.length?(Y.value=e.slice(0,O),O++,R=setTimeout(t,60)):setTimeout((()=>{Z=(Z+1)%K.length,W()}),1800)}()}t((()=>{W(),setInterval((()=>{G.value=!G.value}),500)}));const X=e(!1),ee=e(!1),te=e(""),ae=e(-1),le=e({}),se=e(1),oe=e(10),ce=e(!1),ne=e(!0),ue=e([]),ie=async(e=!1)=>{if(!ce.value&&(ne.value||e))try{ce.value=!0;const t=new Promise((e=>setTimeout(e,800))),[{result:a}]=await Promise.all([o.callFunction({name:"wx_get_list",data:{page:e?1:se.value,pageSize:oe.value}}),t]);if(0!==a.code)throw new Error(a.msg);{const t=a.data.list.map((e=>({...e,username:A(),avatar:D[Math.floor(Math.random()*D.length)],comments:(e.comments||[]).map((e=>({...e,username:A(),avatar:D[Math.floor(Math.random()*D.length)]}))),likes:(e.likes||[]).map((()=>A()))})));if(e)ue.value=t,se.value=2;else{const e=new Set((ue.value||[]).map((e=>e._id))),a=t.filter((t=>!e.has(t._id)));ue.value=[...ue.value||[],...a],se.value++}ne.value=a.data.hasMore}}catch(t){c({title:t.message||"获取朋友圈失败",icon:"none"})}finally{ce.value=!1,e&&n()}};F((()=>{qe(),Ie(),setTimeout((()=>{ie(!0)}),33e3),Ne()})),L((()=>{qe(),De()})),E((()=>{qe(),De()})),P((()=>{!ce.value&&ne.value&&ie()}));const me=async()=>{if(te.value.trim()){X.value=!1,ee.value=!1,c({title:"评论成功",icon:"none"});try{const{result:e}=await o.callFunction({name:"wx_add_comment",data:{momentId:ue.value[ae.value]._id,content:te.value}});if(0!==e.code)throw new Error(e.msg);{const e=ue.value[ae.value];e.comments||(e.comments=[]),e.comments.push({username:A(),content:te.value,create_time:Date.now()}),te.value=""}}catch(e){c({title:e.message||"评论失败",icon:"none"})}}},re=async()=>{w({url:"/pages/wx/home/add"})},de=()=>{X.value=!1,ee.value=!1,te.value="",ae.value=-1},he=()=>{ee.value=!ee.value},fe=()=>{c({title:"视频加载失败",icon:"none"})},pe=()=>{c({title:"搜索即将上线",icon:"none"})},ve=()=>{b({itemList:["切换主题","内容偏好","帮助与反馈"],success:e=>{const t=e.tapIndex;0===t&&c({title:"已切换主题",icon:"none"}),1===t&&c({title:"偏好设置暂未开放",icon:"none"}),2===t&&c({title:"感谢你的反馈",icon:"none"})}})},_e=e(0);U((e=>{const t=e.scrollTop||0;_e.value=Math.min(30,.2*t)}));const ge=e("theme-day"),ke=()=>{const e=(new Date).getHours();ge.value=e>=6&&e<11?"theme-morning":e>=11&&e<18?"theme-day":"theme-night"};t((()=>{ke(),setInterval(ke,6e5)}));const we=e(!1),ye=e([]);let be=0;const xe=e=>{const t=ye.value.findIndex((t=>t.id===e));-1!==t&&ye.value.splice(t,1)},Me=(e=4,t=1e3)=>{we.value=!0;const a=Math.max(1,e),l=Math.floor(t/a);for(let s=0;s<a;s++){setTimeout((()=>{const e=be++;ye.value.push({id:e,x:Math.floor(10+80*Math.random()),y:Math.floor(18+54*Math.random()),theme:["t-blue","t-violet","t-gold","t-mint","t-pink"][Math.floor(5*Math.random())]}),setTimeout((()=>{xe(e),0===ye.value.length&&(we.value=!1)}),2200)}),s*l)}},Ce=async e=>{try{const t=ue.value[e];le.value[e]=!0;const{result:a}=await o.callFunction({name:"wx_add_toggle_like",data:{momentId:t._id}});if(0!==a.code)throw new Error(a.msg);t.isLiked=a.data.isLiked,t.isLiked?(t.likes||(t.likes=[]),t.likes.push(A())):t.likes.pop(),setTimeout((()=>{le.value[e]=!1}),1e3)}catch(t){c({title:t.message||"操作失败",icon:"none"})}};let je=null;const Ie=()=>{je||(we.value=!0,je=setInterval((()=>{const e=3+Math.floor(3*Math.random()),t=1e3+Math.floor(600*Math.random());Me(e,t)}),1500+Math.floor(900*Math.random())))},qe=()=>{clearInterval(je),je=null,we.value=!1,ye.value=[]},Te=e=>{const t=e.likes&&e.likes.length||0,a=e.comments&&e.comments.length||0,l="video"===e.mediaType;return Math.floor(3*t+5*a+(l?18:8))};e("recommend");const Se=e({}),Fe=e([{tag:"# 精选",title:"今日热聊：匿名也要有态度",sub:"来一条走心的分享吧"},{tag:"# 新鲜",title:"你的小确幸，值得被看到",sub:"记录当下，温暖一整天"},{tag:"# 附近",title:"发现身边的美好瞬间",sub:"同城热点，马上加入"}]),Le=e([{text:"# 今天你匿名表白了吗",views:"12.3w",posts:"2.1k",emoji:"💌"},{text:"# 城市树洞：说说你的小烦恼",views:"8.7w",posts:"1.2k",emoji:"🌆"},{text:"# 三件让你快乐的小事",views:"6.5w",posts:"980",emoji:"✨"}]),Ee=e(!1);let Pe=null;const Ue=["https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3","https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"];let He=Math.floor(Math.random()*Ue.length);const Ve=()=>Ue[He%Ue.length],Ae=()=>"undefined"==typeof Audio?null:(Pe||(Pe=new Audio(Ve()),Pe.loop=!0,Pe.preload="auto",Pe.volume=.6,Pe.onerror=()=>{try{const e=(He=(He+1)%Ue.length,Ve());Pe.src=e,Ee.value&&Pe.play().catch((()=>{Ee.value=!1,c({title:"背景音乐需手动播放",icon:"none"})}))}catch(e){}}),Pe),De=()=>{if(Pe)try{Pe.pause()}catch(e){}Ee.value=!1},Qe=()=>{const e=Ae();e&&(Ee.value?De():e.play().then((()=>{Ee.value=!0})).catch((()=>{c({title:"需手动点击播放",icon:"none"})})))};let $e=!1;const Je=()=>{Ne()},Ne=()=>{const e=Ae();e&&(e.muted=!0,e.volume=0,e.play().then((()=>{Ee.value=!0,e.muted=!1,((e=.6,t=1200)=>{const a=Pe;if(!a)return;const l=a.volume||0,s=Math.max(1,Math.floor(t/80));let o=0;const c=setInterval((()=>{o++,a.volume=l+o/s*(e-l),o>=s&&clearInterval(c)}),80)})(.6,1200),"undefined"!=typeof document&&(["touchstart","click","wheel","keydown"].forEach((e=>{try{document.removeEventListener(e,Je)}catch(t){}})),$e=!1)})).catch((()=>{"undefined"==typeof document||$e||(["touchstart","click","wheel","keydown"].forEach((e=>{try{document.addEventListener(e,Je,{once:!0,passive:!0})}catch(t){}})),$e=!0)})))},ze=["😊","😂","🤣","❤️","😍","🤔","😒","👍","👎","😳","🥺","😭","😘","🤗","🙄","😴","🤮","🤧","😷","🤒","🤕","😈","👻","👽","🤖","💩","😺","💪","👊","✌️","🤞","🙏","👏","🙌","👐","🤲"];return(e,t)=>{const o=x,n=u,w=M,F=C,L=j,E=I,P=q,U=T,H=S;return i(),a(n,{class:s(["moments-container",ge.value])},{default:l((()=>[m(n,{class:"header"},{default:l((()=>[m(o,{class:"bg-image",src:r(J),mode:"aspectFill",style:d({transform:`translateY(${_e.value}px) scale(1.06)`})},null,8,["src","style"]),m(n,{class:"header-gradient"}),m(n,{class:"header-blur"}),m(n,{class:"header-glow"}),m(n,{class:"header-topbar"},{default:l((()=>[m(w,{class:"brand"},{default:l((()=>[h("匿名圈")])),_:1}),m(n,{class:"top-actions"},{default:l((()=>[m(w,{class:"top-icon",onClick:pe},{default:l((()=>[h("🔍")])),_:1}),m(w,{class:"top-icon",onClick:ve},{default:l((()=>[h("⋯")])),_:1})])),_:1})])),_:1}),m(n,{class:"hero-card"},{default:l((()=>[m(o,{class:"hero-avatar",src:r(N),mode:"aspectFill"},null,8,["src"]),m(n,{class:"hero-text"},{default:l((()=>[m(w,{class:"hero-title"},{default:l((()=>[h(f(r(B)),1)])),_:1}),m(w,{class:"hero-sub"},{default:l((()=>[h("匿名 · 温暖 · 真实")])),_:1}),m(n,{class:"hero-chips"},{default:l((()=>[m(w,{class:"chip active"},{default:l((()=>[h("推荐")])),_:1}),m(w,{class:"chip"},{default:l((()=>[h("关注")])),_:1}),m(w,{class:"chip"},{default:l((()=>[h("附近")])),_:1})])),_:1})])),_:1}),m(n,{class:"hero-cta",onClick:re},{default:l((()=>[m(w,{class:"cta-plus"},{default:l((()=>[h("+")])),_:1})])),_:1})])),_:1})])),_:1}),m(n,{class:"banner-topics"},{default:l((()=>[m(L,{class:"banner-swiper",circular:"",autoplay:"",interval:"4000"},{default:l((()=>[(i(!0),p(_,null,v(Fe.value,((e,t)=>(i(),a(F,{key:t},{default:l((()=>[m(n,{class:"topic-card",onClick:t=>(e=>{c({title:e.tag+" · "+e.title,icon:"none"})})(e)},{default:l((()=>[m(n,{class:"topic-tag"},{default:l((()=>[h(f(e.tag),1)])),_:2},1024),m(w,{class:"topic-title"},{default:l((()=>[h(f(e.title),1)])),_:2},1024),m(w,{class:"topic-sub"},{default:l((()=>[h(f(e.sub),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),m(n,{class:"hot-board"},{default:l((()=>[m(n,{class:"hot-title"},{default:l((()=>[h("今日热榜")])),_:1}),m(n,{class:"hot-list"},{default:l((()=>[(i(!0),p(_,null,v(Le.value,((e,t)=>(i(),a(n,{class:"hot-item",key:t,onClick:t=>(e=>{c({title:e.text,icon:"none"})})(e)},{default:l((()=>[m(w,{class:s(["hot-rank",{top:t<3}])},{default:l((()=>[h(f(t+1),1)])),_:2},1032,["class"]),m(n,{class:"hot-thumb"},{default:l((()=>[e.thumb?(i(),a(o,{key:0,class:"hot-thumb-img",src:e.thumb,mode:"aspectFill"},null,8,["src"])):(i(),a(w,{key:1,class:"hot-thumb-emoji"},{default:l((()=>[h(f(e.emoji),1)])),_:2},1024))])),_:2},1024),m(n,{class:"hot-content"},{default:l((()=>[m(w,{class:"hot-text"},{default:l((()=>[h(f(e.text),1)])),_:2},1024),m(w,{class:"hot-meta"},{default:l((()=>[h(f(e.views)+" 次浏览 · "+f(e.posts)+" 条讨论",1)])),_:2},1024)])),_:2},1024),m(w,{class:"hot-arrow"},{default:l((()=>[h("›")])),_:1})])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),m(n,{class:"moments-list"},{default:l((()=>[(i(!0),p(_,null,v(ue.value,((e,t)=>(i(),a(n,{class:"moment-item",key:t},{default:l((()=>[m(o,{class:"user-avatar avatar-glow",src:e.avatar,mode:"aspectFill"},null,8,["src"]),m(n,{class:"content-area"},{default:l((()=>[m(n,{class:"meta-row"},{default:l((()=>[m(w,{class:"username"},{default:l((()=>[h(f(e.username),1)])),_:2},1024)])),_:2},1024),m(n,{class:"chip-row"},{default:l((()=>[m(w,{class:"chip"},{default:l((()=>[h("匿名")])),_:1}),e.mediaType?(i(),a(w,{key:0,class:"chip ghost"},{default:l((()=>[h("图文")])),_:1})):g("",!0)])),_:2},1024),m(n,{class:s(["text-block",{clamped:!Se.value[t]}])},{default:l((()=>[m(w,{class:"text-content"},{default:l((()=>[h(f(e.content),1)])),_:2},1024)])),_:2},1032,["class"]),e.content&&e.content.length>60?(i(),a(n,{key:0,class:"expand-btn",onClick:e=>(e=>{Se.value[e]=!Se.value[e]})(t)},{default:l((()=>[h(f(Se.value[t]?"收起":"展开"),1)])),_:2},1032,["onClick"])):g("",!0),e.mediaType?(i(),a(n,{key:1,class:"media-content"},{default:l((()=>["video"===e.mediaType?(i(),a(E,{key:0,src:e.mediaUrl,poster:e.poster,class:"video-content video-radius",controls:"","show-center-play-btn":"","enable-play-gesture":"","show-fullscreen-btn":"","show-play-btn":"","object-fit":"contain",onError:fe},null,8,["src","poster"])):"image"===e.mediaType?(i(),a(n,{key:1,class:s(["image-gallery",`columns-${e.mediaUrls.length}`])},{default:l((()=>[(i(!0),p(_,null,v(e.mediaUrls,((t,l)=>(i(),a(o,{key:l,src:t,mode:"aspectFill",class:"image-content image-radius",onClick:a=>{return l=e.mediaUrls,s=t,void(l&&l.length&&y({urls:l,current:s}));var l,s}},null,8,["src","onClick"])))),128))])),_:2},1032,["class"])):g("",!0),m(n,{class:"media-badges"},{default:l((()=>[m(n,{class:"badge ghost"},{default:l((()=>[m(w,{class:"b-ic"},{default:l((()=>[h("🔥")])),_:1}),m(w,{class:"b-txt"},{default:l((()=>{return[h(f((t=Te(e),t||0===t?t>=1e4?(t/1e4).toFixed(1).replace(/\.0$/,"")+"w":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"k":String(t):"0")),1)];var t})),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)):g("",!0),m(n,{class:"bottom-info"},{default:l((()=>[m(w,{class:"time"},{default:l((()=>[h(f(e.time),1)])),_:2},1024),m(n,{class:"actions"},{default:l((()=>[m(n,{class:s(["action-btn like-btn",{liked:e.isLiked,animating:le.value[t]}]),onClick:e=>(async e=>{await Ce(e),Me(3)})(t)},{default:l((()=>[m(w,{class:"icon iconfont"},{default:l((()=>[h(f(e.isLiked?"❤️":"🤍"),1)])),_:2},1024),m(w,{class:"action-text"},{default:l((()=>[h(f(e.isLiked?"已赞":"点赞"),1)])),_:2},1024),m(w,{class:"action-count"},{default:l((()=>[h(f(e.likes&&e.likes.length||0),1)])),_:2},1024),le.value[t]?(i(),a(n,{key:0,class:"like-burst-particles"},{default:l((()=>[(i(),p(_,null,v(8,(e=>m(n,{key:e,class:s(["particle","p"+e])},null,8,["class"]))),64))])),_:1})):g("",!0)])),_:2},1032,["class","onClick"]),m(n,{class:"action-btn comment-btn",onClick:e=>(e=>{ae.value=e,X.value=!0})(t)},{default:l((()=>[m(w,{class:"icon iconfont"},{default:l((()=>[h("💬")])),_:1}),m(w,{class:"action-text"},{default:l((()=>[h("评论")])),_:1}),m(w,{class:"action-count"},{default:l((()=>[h(f(e.comments&&e.comments.length||0),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),e.likes&&e.likes.length?(i(),a(n,{key:2,class:"likes-section"},{default:l((()=>[m(w,{class:"like-users"},{default:l((()=>[h(f(e.likes.join("、")),1)])),_:2},1024)])),_:2},1024)):g("",!0),e.comments&&0!==e.comments.length?(i(),a(n,{key:3,class:"comments-section"},{default:l((()=>[(i(!0),p(_,null,v(e.comments,((e,t)=>(i(),a(n,{class:"comment-item",key:t},{default:l((()=>[m(o,{class:"comment-anon-icon",src:e.avatar||r(Q)},null,8,["src"]),m(w,{class:"comment-user"},{default:l((()=>[h(f(e.username)+"：",1)])),_:2},1024),m(w,{class:"comment-content"},{default:l((()=>[h(f(e.content),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):g("",!0)])),_:2},1024),m(n,{class:"more-btn",onClick:e=>{b({itemList:["举报","拉黑","不感兴趣"],success:e=>{const t=e.tapIndex;0===t?c({title:"已收到举报",icon:"none"}):1===t?c({title:"已拉黑该用户",icon:"none"}):2===t&&c({title:"将减少类似内容",icon:"none"})}})}},{default:l((()=>[h("⋯")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),X.value?(i(),a(n,{key:0,class:"comment-popup",onClick:de},{default:l((()=>[m(n,{class:"comment-box animated-popup",onClick:t[1]||(t[1]=k((()=>{}),["stop"]))},{default:l((()=>[m(n,{class:"comment-input-area"},{default:l((()=>[m(P,{class:"comment-input",modelValue:te.value,"onUpdate:modelValue":t[0]||(t[0]=e=>te.value=e),placeholder:"@匿名用户 说点什么...",focus:X.value,onConfirm:me},null,8,["modelValue","focus"]),m(n,{class:"toolbar"},{default:l((()=>[m(w,{class:"emoji-btn",onClick:he},{default:l((()=>[h("😊")])),_:1}),m(U,{class:s(["submit-btn",{active:te.value.trim()}]),onClick:me},{default:l((()=>[h("发送")])),_:1},8,["class"])])),_:1})])),_:1}),ee.value?(i(),a(n,{key:0,class:"emoji-panel"},{default:l((()=>[m(H,{"scroll-y":"",class:"emoji-list"},{default:l((()=>[m(n,{class:"emoji-group"},{default:l((()=>[(i(),p(_,null,v(ze,((e,t)=>m(w,{key:t,class:"emoji-item",onClick:t=>(e=>{te.value+=e})(e)},{default:l((()=>[h(f(e),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1})):g("",!0),m(n,{class:s(["music-btn",{playing:Ee.value}]),onClick:Qe},{default:l((()=>[m(w,{class:"music-icon"},{default:l((()=>[h("♪")])),_:1})])),_:1},8,["class"]),we.value?(i(),a(n,{key:1,class:"fireworks"},{default:l((()=>[(i(!0),p(_,null,v(ye.value,(e=>(i(),a(n,{key:e.id,class:"fw",style:d({left:e.x+"%",top:e.y+"%"})},{default:l((()=>[(i(),p(_,null,v(12,(t=>m(n,{key:t,class:s(["fw-p","p"+t,e.theme])},null,8,["class"]))),64))])),_:2},1032,["style"])))),128))])),_:1})):g("",!0)])),_:1},8,["class"])}}},[["__scopeId","data-v-79c92b52"]]);export{V as default};
