import{c as a,e,w as l,f as s,x as t,d as c,r as n,g as u,o,a as d,b as i,h as f,n as r,u as _,t as p,A as m,i as v,j as y,F as g,k,B as b,l as h,s as x,m as C,p as w,C as S,D as $,v as F,I as j,y as I,z as L}from"./index-4VJyEHA-.js";import{_ as D}from"./uni-rate.D-L5U1Mq.js";import{o as E,r as T}from"./uni-app.es.DdT-yCZj.js";import{_ as q}from"./uni-popup.CmcbxKw9.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=z({},[["render",function(c,n){const u=t;return a(),e(u,{class:"skeleton-card glass-effect"},{default:l((()=>[s(u,{class:"card-header"},{default:l((()=>[s(u,{class:"company-name skeleton-bg"}),s(u,{class:"rating-wrapper"},{default:l((()=>[s(u,{class:"rating skeleton-bg"})])),_:1})])),_:1}),s(u,{class:"card-content"},{default:l((()=>[s(u,{class:"cons-box skeleton-bg"})])),_:1}),s(u,{class:"card-footer"},{default:l((()=>[s(u,{class:"stats"},{default:l((()=>[s(u,{class:"stat-item skeleton-bg"}),s(u,{class:"stat-item skeleton-bg"}),s(u,{class:"date skeleton-bg"})])),_:1}),s(u,{class:"city-tag skeleton-bg"})])),_:1})])),_:1})}],["__scopeId","data-v-ecb1a65c"]]),B=z(c({__name:"index",setup(c){const z=n([]),B=n(""),P=n(null),R=n(1),A=n(!0),H=n(!1),M=n(""),N=n([]),U=n([]),Y=n(""),G=u().statusBarHeight,J=a=>{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},K=async(a=1,e=!1)=>{e||(H.value=!0);try{const{result:l}=await h.callFunction({name:"getCompanyList",data:{page:a,pageSize:10,keyword:B.value,city:M.value}});if(0===l.code){const s=l.data.map((a=>({...a,isExpanded:!1})));e?z.value=[...z.value,...s]:setTimeout((()=>{z.value=s,H.value=!1}),500),A.value=10===l.data.length,R.value=a}}catch(l){x({title:"获取数据失败",icon:"none"}),H.value=!1}},O=()=>{z.value=[],R.value=1,A.value=!0,K(1)},Q=()=>{O()},W=()=>{B.value="",O()},X=()=>{C({url:"/pages/comment/add/add-review"})};o((()=>{d("hasShownDisclaimer")||P.value.open(),K()}));const Z=()=>{w("hasShownDisclaimer",!0),P.value.close()},aa=n(null),ea=()=>{aa.value.open()},la=()=>{aa.value.close()},sa=()=>{S({data:"962723968@qq.com",success:()=>{x({title:"邮箱已复制",icon:"success"})}})};E((()=>{(async()=>{A.value&&!H.value&&await K(R.value+1,!0)})()})),o((()=>{K()}));const ta=()=>{$({itemList:N.value.map((a=>a.name)),success:async a=>{const e=N.value[a.tapIndex];Y.value=e.name,await(async a=>{try{const{result:e}=await h.callFunction({name:"getCityList",data:{province:a}});0===e.code&&(U.value=e.data)}catch(e){x({title:"获取城市失败",icon:"none"})}})(e.code),$({itemList:U.value.map((a=>a.name)),success:a=>{M.value=U.value[a.tapIndex].name,O()}})}})};o((async()=>{await(async()=>{try{const{result:a}=await h.callFunction({name:"getCityList"});0===a.code&&(N.value=a.data)}catch(a){x({title:"获取省份失败",icon:"none"})}})(),K()}));const ca=n(0),na=n(0),ua=n(0),oa=()=>{x({title:`总计 ${ca.value} 条点评`,icon:"none"})},da=()=>{x({title:`已收录 ${na.value} 家企业`,icon:"none"})},ia=()=>{x({title:`今日新增 ${ua.value} 条点评`,icon:"none"})};o((async()=>{await(async()=>{try{const{result:a}=await h.callFunction({name:"getStatistics"});0===a.code&&(ca.value=a.data.totalReviews,na.value=a.data.totalCompanies,ua.value=a.data.todayReviews)}catch(a){console.error("获取统计数据失败:",a)}})()}));const fa=n("default"),ra=[{name:"default",label:"默认紫"},{name:"blue",label:"深邃蓝"},{name:"green",label:"自然绿"},{name:"red",label:"热情红"}],_a=()=>{$({itemList:ra.map((a=>a.label)),success:a=>{var e;e=ra[a.tapIndex].name,fa.value=e,w("theme",e)}})};return o((()=>{const a=d("theme");a&&(fa.value=a)})),(c,n)=>{const u=F,o=t,d=j,h=I,x=T(i("uni-rate"),D),w=L,S=T(i("uni-popup"),q);return a(),e(o,{class:k(["container",`theme-${fa.value}`])},{default:l((()=>[s(o,{class:"nav-bar",style:r({paddingTop:_(G)+"px"})},{default:l((()=>[s(o,{class:"nav-content"},{default:l((()=>[s(o,{class:"nav-left"},{default:l((()=>[s(u,{class:"app-title"},{default:l((()=>[f("人人点评")])),_:1}),s(u,{class:"app-subtitle"},{default:l((()=>[f("匿名化点评，避雷指南")])),_:1})])),_:1}),s(o,{class:"nav-right"},{default:l((()=>[s(o,{class:"nav-btn",onClick:_a},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("🎨")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),s(o,{class:"intro-section",style:r({marginTop:_(G)+88+"rpx"})},{default:l((()=>[s(o,{class:"intro-cards"},{default:l((()=>[s(o,{class:"intro-card glass-effect",onClick:oa},{default:l((()=>[s(o,{class:"card-content"},{default:l((()=>[s(u,{class:"count"},{default:l((()=>[f(p(ca.value||"0"),1)])),_:1}),s(u,{class:"label"},{default:l((()=>[f("总点评")])),_:1})])),_:1}),s(u,{class:"icon"},{default:l((()=>[f("📝")])),_:1})])),_:1}),s(o,{class:"intro-card glass-effect",onClick:da},{default:l((()=>[s(o,{class:"card-content"},{default:l((()=>[s(u,{class:"count"},{default:l((()=>[f(p(na.value||"0"),1)])),_:1}),s(u,{class:"label"},{default:l((()=>[f("已收录")])),_:1})])),_:1}),s(u,{class:"icon"},{default:l((()=>[f("🏢")])),_:1})])),_:1}),s(o,{class:"intro-card glass-effect",onClick:ia},{default:l((()=>[s(o,{class:"card-content"},{default:l((()=>[s(u,{class:"count"},{default:l((()=>[f(p(ua.value||"0"),1)])),_:1}),s(u,{class:"label"},{default:l((()=>[f("今日新增")])),_:1})])),_:1}),s(u,{class:"icon"},{default:l((()=>[f("🔥")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),s(o,{class:"search-section",style:r({marginTop:_(G)+"rpx"})},{default:l((()=>[s(o,{class:"search-wrapper glass-effect"},{default:l((()=>[s(o,{class:"search-input-box"},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("🔍")])),_:1}),s(d,{class:"input",modelValue:B.value,"onUpdate:modelValue":n[0]||(n[0]=a=>B.value=a),placeholder:"搜索点评标题","placeholder-class":"placeholder","confirm-type":"search",onConfirm:Q},null,8,["modelValue"]),B.value?(a(),e(u,{key:0,class:"clear-icon",onClick:W},{default:l((()=>[f("✕")])),_:1})):m("",!0)])),_:1}),s(o,{class:"divider"}),s(o,{class:"location-picker",onClick:ta},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("📍")])),_:1}),s(u,{class:"location-text"},{default:l((()=>[f(p(M.value||"选择城市"),1)])),_:1}),s(u,{class:"icon-arrow"},{default:l((()=>[f("▼")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),H.value?(a(),v(g,{key:0},y(5,(a=>s(V,{key:a}))),64)):m("",!0),s(o,{class:k(["company-list",{"fade-in":!H.value}])},{default:l((()=>[H.value?(a(),v(g,{key:0},[],64)):0===z.value.length?(a(),e(o,{key:1,class:"empty-state"},{default:l((()=>[s(h,{class:"empty-image",src:"./static/images/empty.png",mode:"aspectFit"}),s(u,{class:"empty-text"},{default:l((()=>[f("暂无数据")])),_:1}),s(u,{class:"empty-tips"},{default:l((()=>[f("快来添加第一条评价吧")])),_:1}),s(o,{class:"empty-btn",onClick:X},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("✏️")])),_:1}),s(u,{class:"text"},{default:l((()=>[f("写点评")])),_:1})])),_:1})])),_:1})):(a(!0),v(g,{key:2},y(z.value,((t,c)=>(a(),e(o,{key:t._id,class:"company-card glass-effect",style:r({"--index":c}),"hover-class":"company-card-hover",onClick:a=>{return e=t._id,void C({url:`/pages/comment/detail/detail?id=${e}`});var e}},{default:l((()=>[s(o,{class:"card-header"},{default:l((()=>[s(u,{class:"company-name"},{default:l((()=>[f(p(t.companyName),1)])),_:2},1024),s(o,{class:"rating-wrapper"},{default:l((()=>[s(x,{value:t.rating,size:"15"},null,8,["value"]),s(u,{class:"rating-text"},{default:l((()=>[f(p(t.rating||0),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),s(o,{class:"card-content"},{default:l((()=>[t.cons?(a(),e(o,{key:0,class:"cons-box"},{default:l((()=>{return[s(u,{class:k(["cons-text",{truncated:!t.isExpanded}])},{default:l((()=>[f(p(t.cons),1)])),_:2},1032,["class"]),(c=t.cons,c.length>100?(a(),e(u,{key:0,class:"expand-btn",onClick:b((a=>(a=>{a.isExpanded=!a.isExpanded})(t)),["stop"])},{default:l((()=>[f(p(t.isExpanded?"收起":"查看更多"),1)])),_:2},1032,["onClick"])):m("",!0))];var c})),_:2},1024)):m("",!0)])),_:2},1024),s(o,{class:"card-footer"},{default:l((()=>[s(o,{class:"stats"},{default:l((()=>[s(o,{class:"stat-item"},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("👁️")])),_:1}),s(u,{class:"count"},{default:l((()=>[f(p(t.viewCount||0),1)])),_:2},1024)])),_:2},1024),s(o,{class:"stat-item"},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("💬")])),_:1}),s(u,{class:"count"},{default:l((()=>[f(p(t.reviewCount||0),1)])),_:2},1024)])),_:2},1024),s(u,{class:"date"},{default:l((()=>[f(p(J(t.createTime)),1)])),_:2},1024)])),_:2},1024),s(u,{class:"city-tag"},{default:l((()=>[f(p(t.city),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["style","onClick"])))),128))])),_:1},8,["class"]),s(o,{class:"float-btns"},{default:l((()=>[s(o,{class:"float-btn glass-effect complaint-btn",onClick:ea},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("📢")])),_:1})])),_:1}),s(o,{class:"float-btn glass-effect",onClick:X},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("✏️")])),_:1})])),_:1})])),_:1}),s(S,{ref_key:"disclaimerPopup",ref:P,type:"center"},{default:l((()=>[s(o,{class:"disclaimer-popup"},{default:l((()=>[s(o,{class:"popup-header"},{default:l((()=>[s(u,{class:"title"},{default:l((()=>[f("免责声明")])),_:1})])),_:1}),s(o,{class:"popup-content"},{default:l((()=>[s(u,{class:"text"},{default:l((()=>[f("1. 本平台仅提供信息分享服务，所有内容均来自用户发布。")])),_:1}),s(u,{class:"text"},{default:l((()=>[f("2. 用户发布的内容仅代表个人观点，请理性对待。")])),_:1}),s(u,{class:"text"},{default:l((()=>[f("3. 如发现违规内容，请及时联系我们处理。")])),_:1}),s(u,{class:"text"},{default:l((()=>[f("4. 平台保留对违规内容的处理权利。")])),_:1})])),_:1}),s(o,{class:"popup-footer"},{default:l((()=>[s(w,{class:"confirm-btn",onClick:Z},{default:l((()=>[f("我已了解")])),_:1})])),_:1})])),_:1})])),_:1},512),z.value.length>0?(a(),e(o,{key:1,class:"load-more"},{default:l((()=>[H.value?(a(),e(o,{key:0,class:"loading"},{default:l((()=>[s(o,{class:"loading-icon"}),s(u,{class:"loading-text"},{default:l((()=>[f("加载中...")])),_:1})])),_:1})):A.value?m("",!0):(a(),e(u,{key:1,class:"no-more"},{default:l((()=>[f("没有多了")])),_:1}))])),_:1})):m("",!0),s(S,{ref_key:"complaintPopup",ref:aa,type:"center"},{default:l((()=>[s(o,{class:"complaint-popup glass-effect"},{default:l((()=>[s(o,{class:"popup-header"},{default:l((()=>[s(u,{class:"title"},{default:l((()=>[f("投诉建议")])),_:1}),s(u,{class:"close-icon",onClick:la},{default:l((()=>[f("✕")])),_:1})])),_:1}),s(o,{class:"popup-content"},{default:l((()=>[s(o,{class:"content-item"},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("📧")])),_:1}),s(o,{class:"item-info"},{default:l((()=>[s(u,{class:"label"},{default:l((()=>[f("邮箱联系")])),_:1}),s(u,{class:"value"},{default:l((()=>[f("962723968@qq.com")])),_:1})])),_:1}),s(w,{class:"copy-btn",onClick:sa},{default:l((()=>[f("复制")])),_:1})])),_:1}),s(o,{class:"content-item"},{default:l((()=>[s(u,{class:"icon"},{default:l((()=>[f("⚠️")])),_:1}),s(o,{class:"item-info"},{default:l((()=>[s(u,{class:"label"},{default:l((()=>[f("温馨提示")])),_:1}),s(u,{class:"desc"},{default:l((()=>[f("如发现任何违规或不当内容，请及时联系我们处理，我们会在24小时内给予回复。")])),_:1})])),_:1})])),_:1})])),_:1}),s(o,{class:"popup-footer"},{default:l((()=>[s(w,{class:"confirm-btn",onClick:la},{default:l((()=>[f("我知道了")])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1},8,["class"])}}}),[["__scopeId","data-v-a498a9b9"]]);export{B as default};
