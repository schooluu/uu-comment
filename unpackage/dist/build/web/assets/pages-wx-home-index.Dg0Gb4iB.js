import{r as e,e as a,w as s,Y as l,s as t,a8 as c,m as n,c as o,f as i,h as u,i as m,j as d,F as r,k as f,z as _,C as v,x as p,q as k,l as y,I as g,t as h,S as b,v as w,X as x}from"./index-0EbhcMDI.js";import{a as C,o as j}from"./uni-app.es.D_ZYNQl_.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";const E="https://img0.baidu.com/it/u=1415523915,841919565&fm=253&app=120&size=w931&n=0&f=JPEG&fmt=auto?sec=1713286800&t=a9e21a0e5650a672fa2cbd3b133ed7e0",L=F({__name:"index",setup(F){const L=e(!1),I=e(!1),T=e(""),U=e(-1),z=e({}),V=e(1),S=e(10),q=e(!1),D=e(!0),G=e([]),J=async(e=!1)=>{if(!q.value&&(D.value||e))try{q.value=!0;const{result:a}=await l.callFunction({name:"wx_get_list",data:{page:e?1:V.value,pageSize:S.value}});if(0!==a.code)throw new Error(a.msg);e?(G.value=a.data.list,V.value=1):(G.value=[...G.value,...a.data.list],V.value++),D.value=a.data.hasMore}catch(a){t({title:a.message||"获取朋友圈失败",icon:"none"})}finally{q.value=!1,e&&c()}};C((()=>{J(!0)})),j((()=>{J()}));const M=async()=>{if(T.value.trim())try{const{result:e}=await l.callFunction({name:"wx_add_comment",data:{momentId:G.value[U.value]._id,content:T.value}});if(0!==e.code)throw new Error(e.msg);{const e=G.value[U.value];e.comments||(e.comments=[]),e.comments.push({username:"我",content:T.value,create_time:Date.now()}),T.value="",L.value=!1,I.value=!1,t({title:"评论成功",icon:"success"})}}catch(e){t({title:e.message||"评论失败",icon:"none"})}},O=async()=>{p({url:"/pages/wx/home/add"})},P=()=>{L.value=!1,I.value=!1,T.value="",U.value=-1},X=()=>{I.value=!I.value},Y=()=>{t({title:"视频加载失败",icon:"none"})},$=["😊","😂","🤣","❤️","😍","🤔","😒","👍","👎","😳","🥺","😭","😘","🤗","🙄","😴","🤮","🤧","😷","🤒","🤕","😈","👻","👽","🤖","💩","😺","💪","👊","✌️","🤞","🙏","👏","🙌","👐","🤲"];return(e,c)=>{const p=k,C=y,j=n,F=x,V=g,S=h,q=b;return o(),a(j,{class:"moments-container"},{default:s((()=>[i(j,{class:"header"},{default:s((()=>[i(p,{class:"bg-image",src:E,mode:"aspectFill"}),i(j,{class:"avatar-area"},{default:s((()=>[i(j,{class:"user-info"},{default:s((()=>[i(C,{class:"nickname"},{default:s((()=>[u("用户昵称")])),_:1}),i(p,{class:"avatar",src:E,mode:"aspectFill"})])),_:1})])),_:1})])),_:1}),i(j,{class:"moments-list"},{default:s((()=>[(o(!0),m(r,null,d(G.value,((e,c)=>(o(),a(j,{class:"moment-item",key:c},{default:s((()=>[i(p,{class:"user-avatar",src:e.avatar,mode:"aspectFill"},null,8,["src"]),i(j,{class:"content-area"},{default:s((()=>[i(j,{class:"username"},{default:s((()=>[u(w(e.username),1)])),_:2},1024),i(C,{class:"text-content"},{default:s((()=>[u(w(e.content),1)])),_:2},1024),e.mediaType?(o(),a(j,{key:0,class:"media-content"},{default:s((()=>["video"===e.mediaType?(o(),a(F,{key:0,src:e.mediaUrl,poster:e.poster,class:"video-content",controls:"","show-center-play-btn":"","enable-play-gesture":"","show-fullscreen-btn":"","show-play-btn":"","object-fit":"contain",onError:Y},null,8,["src","poster"])):"image"===e.mediaType?(o(),a(j,{key:1,class:f(["image-gallery",`columns-${e.mediaUrls.length}`])},{default:s((()=>[(o(!0),m(r,null,d(e.mediaUrls,((e,s)=>(o(),a(p,{key:s,src:e,mode:"aspectFill",class:"image-content"},null,8,["src"])))),128))])),_:2},1032,["class"])):_("",!0)])),_:2},1024)):_("",!0),i(j,{class:"bottom-info"},{default:s((()=>[i(C,{class:"time"},{default:s((()=>[u(w(e.time),1)])),_:2},1024),i(j,{class:"actions"},{default:s((()=>[i(j,{class:f(["action-btn like-btn",{liked:e.isLiked,animating:z.value[c]}]),onClick:e=>(async e=>{try{const a=G.value[e];z.value[e]=!0;const{result:s}=await l.callFunction({name:"wx_add_toggle_like",data:{momentId:a._id}});if(0!==s.code)throw new Error(s.msg);if(a.isLiked=s.data.isLiked,a.isLiked)a.likes||(a.likes=[]),a.likes.push("我");else{const e=a.likes.indexOf("我");e>-1&&a.likes.splice(e,1)}setTimeout((()=>{z.value[e]=!1}),1e3)}catch(a){t({title:a.message||"操作失败",icon:"none"})}})(c)},{default:s((()=>[i(C,{class:"icon"},{default:s((()=>[u(w(e.isLiked?"❤️":"🤍"),1)])),_:2},1024)])),_:2},1032,["class","onClick"]),i(j,{class:"action-btn comment-btn",onClick:e=>(e=>{U.value=e,L.value=!0})(c)},{default:s((()=>[i(C,{class:"icon"},{default:s((()=>[u("💬")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),e.likes&&e.likes.length?(o(),a(j,{key:1,class:"likes-section"},{default:s((()=>[i(C,{class:"like-users"},{default:s((()=>[u(w(e.likes.join("、")),1)])),_:2},1024)])),_:2},1024)):_("",!0),e.comments&&0!==e.comments.length?(o(),a(j,{key:2,class:"comments-section"},{default:s((()=>[(o(!0),m(r,null,d(e.comments,((e,l)=>(o(),a(j,{class:"comment-item",key:l},{default:s((()=>[i(C,{class:"comment-user"},{default:s((()=>[u(w(e.username)+"：",1)])),_:2},1024),i(C,{class:"comment-content"},{default:s((()=>[u(w(e.content),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)):_("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),L.value?(o(),a(j,{key:0,class:"comment-popup",onClick:P},{default:s((()=>[i(j,{class:"comment-box",onClick:c[1]||(c[1]=v((()=>{}),["stop"]))},{default:s((()=>[i(j,{class:"comment-input-area"},{default:s((()=>[i(V,{class:"comment-input",modelValue:T.value,"onUpdate:modelValue":c[0]||(c[0]=e=>T.value=e),placeholder:"评论",focus:L.value,onConfirm:M},null,8,["modelValue","focus"]),i(j,{class:"toolbar"},{default:s((()=>[i(C,{class:"emoji-btn",onClick:X},{default:s((()=>[u("😊")])),_:1}),i(S,{class:f(["submit-btn",{active:T.value.trim()}]),onClick:M},{default:s((()=>[u("发送")])),_:1},8,["class"])])),_:1})])),_:1}),I.value?(o(),a(j,{key:0,class:"emoji-panel"},{default:s((()=>[i(q,{"scroll-y":"",class:"emoji-list"},{default:s((()=>[i(j,{class:"emoji-group"},{default:s((()=>[(o(),m(r,null,d($,((e,a)=>i(C,{key:a,class:"emoji-item",onClick:a=>(e=>{T.value+=e})(e)},{default:s((()=>[u(w(e),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})):_("",!0)])),_:1})])),_:1})):_("",!0),i(j,{class:"publish-btn",onClick:O},{default:s((()=>[i(j,{class:"icon-wrapper"},{default:s((()=>[i(C,{class:"iconfont"},{default:s((()=>[u("+")])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a65f0f71"]]);export{L as default};
