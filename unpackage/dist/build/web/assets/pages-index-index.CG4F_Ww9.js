import{c as t,w as s,v as e,o as a,a as i,b as o,r as n,n as l,d as r,i as c,e as u,f as d,g as h,h as p,j as m,k as f,l as y,m as g,p as k,u as b,t as _,q as w,s as C,F as v,Y as x,x as T,y as $,z as S,A,B as P,C as R,D,I as B,E as I,G as E}from"./index-GysuaU87.js";import{_ as Y,r as j,o as z,a as L}from"./uni-rate.CjiAGgOY.js";class H{constructor(s,e){this.options=s,this.animation=t({...s}),this.currentStepAnimates={},this.next=0,this.$=e}_nvuePushAnimates(t,s){let e=this.currentStepAnimates[this.next],a={};if(a=e||{styles:{},config:{}},M.includes(t)){a.styles.transform||(a.styles.transform="");let e="";"rotate"===t&&(e="deg"),a.styles.transform+=`${t}(${s+e}) `}else a.styles[t]=`${s}`;this.currentStepAnimates[this.next]=a}_animateRun(t={},s={}){let e=this.$.$refs.ani.ref;if(e)return new Promise(((a,i)=>{nvueAnimation.transition(e,{styles:t,...s},(t=>{a()}))}))}_nvueNextAnimate(t,s=0,e){let a=t[s];if(a){let{styles:i,config:o}=a;this._animateRun(i,o).then((()=>{s+=1,this._nvueNextAnimate(t,s,e)}))}else this.currentStepAnimates={},"function"==typeof e&&e(),this.isEnd=!0}step(t={}){return this.animation.step(t),this}run(t){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof t&&t()}),this.$.durationTime)}}const M=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function X(t,s){if(s)return clearTimeout(s.timer),new H(t,s)}M.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((t=>{H.prototype[t]=function(...s){return this.animation[t](...s),this}}));const F=Y({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""},onceRender:{type:Boolean,default:!1}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(t){t?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let t={...this.styles,"transition-duration":this.duration/1e3+"s"},s="";for(let e in t){s+=this.toLine(e)+":"+t[e]+";"}return s},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(t={}){t.duration&&(this.durationTime=t.duration),this.animation=X(Object.assign(this.config,t),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(t,s={}){if(this.animation){for(let s in t)try{"object"==typeof t[s]?this.animation[s](...t[s]):this.animation[s](t[s])}catch(e){console.error(`方法 ${s} 不存在`)}return this.animation.step(s),this}},run(t){this.animation&&this.animation.run(t)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:t,transform:s}=this.styleInit(!1);void 0!==t&&(this.opacity=t),this.transform=s,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=X(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})}),20)}))},close(t){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:t,transform:s}=this.styleInit(!1);this.opacity=t||1,this.transform=s,this.$emit("change",{detail:this.isShow})}))},styleInit(t){let s={transform:""},e=(t,e)=>{"fade"===e?s.opacity=this.animationType(t)[e]:s.transform+=this.animationType(t)[e]+" "};return"string"==typeof this.modeClass?e(t,this.modeClass):this.modeClass.forEach((s=>{e(t,s)})),s},tranfromInit(t){let s=(t,s)=>{let e=null;"fade"===s?e=t?0:1:(e=t?"-100%":"0","zoom-in"===s&&(e=t?.8:1),"zoom-out"===s&&(e=t?1.2:1),"slide-right"===s&&(e=t?"100%":"0"),"slide-bottom"===s&&(e=t?"100%":"0")),this.animation[this.animationMode()[s]](e)};return"string"==typeof this.modeClass?s(t,this.modeClass):this.modeClass.forEach((e=>{s(t,e)})),this.animation},animationType:t=>({fade:t?0:1,"slide-top":`translateY(${t?"0":"-100%"})`,"slide-right":`translateX(${t?"0":"100%"})`,"slide-bottom":`translateY(${t?"0":"100%"})`,"slide-left":`translateX(${t?"0":"-100%"})`,"zoom-in":`scaleX(${t?1:.8}) scaleY(${t?1:.8})`,"zoom-out":`scaleX(${t?1:1.2}) scaleY(${t?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:t=>t.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(t,u,d,h,p,m){const f=c;return s((a(),i(f,{ref:"ani",animation:p.animationData,class:l(d.customClass),style:r(m.transformStyles),onClick:m.onClick},{default:o((()=>[n(t.$slots,"default")])),_:3},8,["animation","class","style","onClick"])),[[e,p.isShow]])}]]);const O=Y({name:"uniPopup",components:{keypress:{name:"Keypress",props:{disable:{type:Boolean,default:!1}},mounted(){const t={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]};document.addEventListener("keyup",(s=>{if(this.disable)return;const e=Object.keys(t).find((e=>{const a=s.key,i=t[e];return i===a||Array.isArray(i)&&i.includes(a)}));e&&setTimeout((()=>{this.$emit(e,{})}),0)}))},render:()=>{}}},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"},borderRadius:{type:String}},watch:{type:{handler:function(t){this.config[t]&&this[this.config[t]](!0)},immediate:!0},isDesktop:{handler:function(t){this.config[t]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(t){this.mkclick=t},immediate:!0},isMaskClick:{handler:function(t){this.mkclick=t},immediate:!0},showPopup(t){document.getElementsByTagName("body")[0].style.overflow=t?"hidden":"visible"}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{backgroundColor:"transparent",borderRadius:this.borderRadius||"0",position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:"top"}},computed:{getStyles(){let t={backgroundColor:this.bg};return this.borderRadius,t=Object.assign(t,{borderRadius:this.borderRadius}),t},isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:t,windowHeight:s,windowTop:e,safeArea:a,screenHeight:i,safeAreaInsets:o}=m();this.popupWidth=t,this.popupHeight=s+(e||0),a&&this.safeArea?this.safeAreaInsets=o.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},activated(){this.setH5Visible(!this.showPopup)},deactivated(){this.setH5Visible(!0)},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(t=!0){document.getElementsByTagName("body")[0].style.overflow=t?"visible":"hidden"},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(t){t.stopPropagation(),this.clearPropagation=!0},open(t){if(this.showPopup)return;t&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(t)||(t=this.type),this.config[t]?(this[this.config[t]](),this.$emit("change",{show:!0,type:t})):console.error("缺少类型：",t)},close(t){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(t){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},t||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.showPoptrans(),this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(t){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},t||this.showPoptrans()},center(t){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center",borderRadius:this.borderRadius||"0"},t||this.showPoptrans()},left(t){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},t||this.showPoptrans()},right(t){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},t||this.showPoptrans()},showPoptrans(){this.$nextTick((()=>{this.showPopup=!0,this.showTrans=!0}))}}},[["render",function(t,s,e,m,f,y){const g=j(u("uni-transition"),F),k=c,b=d("keypress");return f.showPopup?(a(),i(k,{key:0,class:l(["uni-popup",[f.popupstyle,y.isDesktop?"fixforpc-z-index":""]])},{default:o((()=>[h(k,{onTouchstart:y.touchstart},{default:o((()=>[f.maskShow?(a(),i(g,{key:"1",name:"mask","mode-class":"fade",styles:f.maskClass,duration:f.duration,show:f.showTrans,onClick:y.onTap},null,8,["styles","duration","show","onClick"])):p("",!0),h(g,{key:"2","mode-class":f.ani,name:"content",styles:f.transClass,duration:f.duration,show:f.showTrans,onClick:y.onTap},{default:o((()=>[h(k,{class:l(["uni-popup__wrapper",[f.popupstyle]]),style:r(y.getStyles),onClick:y.clear},{default:o((()=>[n(t.$slots,"default",{},void 0,!0)])),_:3},8,["style","class","onClick"])])),_:3},8,["mode-class","styles","duration","show","onClick"])])),_:3},8,["onTouchstart"]),f.maskShow?(a(),i(b,{key:0,onEsc:y.onTap},null,8,["onEsc"])):p("",!0)])),_:3},8,["class"])):p("",!0)}],["__scopeId","data-v-fc99ec19"]]),V=Y(f({__name:"index",setup(t){const s=y([]),e=y(""),n=y(null),d=y(1),f=y(!0),Y=y(!1),H=y(""),M=y([]),X=y([]),F=y(""),V=m().statusBarHeight,N=t=>{const s=new Date(t);return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`},W=async(t=1,a=!1)=>{if(!Y.value){Y.value=!0;try{const{result:i}=await x.callFunction({name:"getCompanyList",data:{page:t,pageSize:10,keyword:e.value,city:H.value}});0===i.code&&(s.value=a?[...s.value,...i.data]:i.data,f.value=10===i.data.length,d.value=t)}catch(i){T({title:"获取数据败",icon:"none"})}finally{Y.value=!1,$()}}},Z=()=>{s.value=[],d.value=1,f.value=!0,W(1)},q=()=>{Z()},U=()=>{e.value="",Z()},G=()=>{S({url:"/pages/add/add-review"})};g((()=>{n.value.open(),W()}));const K=()=>{A("hasShownDisclaimer",!0),n.value.close()},J=()=>{P({title:"投诉建议",content:"如果您发现任何违规或不当内容，请联系我们处理。\n邮箱：962723968@qq.com",showCancel:!1,confirmText:"我知道了"})};z((()=>{(async()=>{f.value&&!Y.value&&await W(d.value+1,!0)})()})),g((()=>{W()}));const Q=()=>{R({itemList:M.value.map((t=>t.name)),success:async t=>{const s=M.value[t.tapIndex];F.value=s.name,await(async t=>{try{const{result:s}=await x.callFunction({name:"getCityList",data:{province:t}});0===s.code&&(X.value=s.data)}catch(s){T({title:"获取城市失败",icon:"none"})}})(s.code),R({itemList:X.value.map((t=>t.name)),success:t=>{H.value=X.value[t.tapIndex].name,Z()}})}})};return g((async()=>{await(async()=>{try{const{result:t}=await x.callFunction({name:"getCityList"});0===t.code&&(M.value=t.data)}catch(t){T({title:"获取省份失败",icon:"none"})}})(),W()})),(t,d)=>{const m=D,y=c,g=B,x=I,T=j(u("uni-rate"),L),$=E,A=j(u("uni-popup"),O);return a(),i(y,{class:"container"},{default:o((()=>[h(y,{class:"nav-bar",style:r({paddingTop:b(V)+"px"})},{default:o((()=>[h(y,{class:"nav-content"},{default:o((()=>[h(y,{class:"nav-left"},{default:o((()=>[h(m,{class:"app-title"},{default:o((()=>[k("人人点评")])),_:1}),h(m,{class:"app-subtitle"},{default:o((()=>[k("匿名化点评，避雷指南")])),_:1})])),_:1}),h(y,{class:"nav-right"},{default:o((()=>[h(y,{class:"nav-btn",onClick:J},{default:o((()=>[h(m,{class:"icon"},{default:o((()=>[k("📢")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),h(y,{class:"search-section",style:r({marginTop:b(V)+88+"rpx"})},{default:o((()=>[h(y,{class:"search-wrapper glass-effect"},{default:o((()=>[h(y,{class:"search-input-box"},{default:o((()=>[h(m,{class:"icon"},{default:o((()=>[k("🔍")])),_:1}),h(g,{class:"input",modelValue:e.value,"onUpdate:modelValue":d[0]||(d[0]=t=>e.value=t),placeholder:"搜索点评标题","placeholder-class":"placeholder","confirm-type":"search",onConfirm:q},null,8,["modelValue"]),e.value?(a(),i(m,{key:0,class:"clear-icon",onClick:U},{default:o((()=>[k("✕")])),_:1})):p("",!0)])),_:1}),h(y,{class:"divider"}),h(y,{class:"location-picker",onClick:Q},{default:o((()=>[h(m,{class:"icon"},{default:o((()=>[k("📍")])),_:1}),h(m,{class:"location-text"},{default:o((()=>[k(_(H.value||"选择城市"),1)])),_:1}),h(m,{class:"icon-arrow"},{default:o((()=>[k("▼")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),h(y,{class:l(["company-list",{"fade-in":!Y.value}])},{default:o((()=>[0===s.value.length?(a(),i(y,{key:0,class:"empty-state"},{default:o((()=>[h(x,{class:"empty-image",src:"./static/images/empty.png",mode:"aspectFit"}),h(m,{class:"empty-text"},{default:o((()=>[k("暂无数据")])),_:1}),h(m,{class:"empty-tips"},{default:o((()=>[k("快来添加第一条评价吧")])),_:1}),h(y,{class:"empty-btn",onClick:G},{default:o((()=>[h(m,{class:"icon"},{default:o((()=>[k("✏️")])),_:1}),h(m,{class:"text"},{default:o((()=>[k("写点评")])),_:1})])),_:1})])),_:1})):(a(!0),w(v,{key:1},C(s.value,((t,s)=>(a(),i(y,{key:t._id,class:"company-card glass-effect",style:r({"--index":s}),"hover-class":"company-card-hover",onClick:s=>{return e=t._id,void S({url:`/pages/detail/detail?id=${e}`});var e}},{default:o((()=>[h(y,{class:"card-header"},{default:o((()=>[h(m,{class:"company-name"},{default:o((()=>[k(_(t.companyName),1)])),_:2},1024),h(y,{class:"rating-wrapper"},{default:o((()=>[h(T,{value:t.rating,size:"18",color:"#FFB800"},null,8,["value"]),h(m,{class:"rating-text"},{default:o((()=>[k(_(t.rating||0),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),h(y,{class:"card-content"},{default:o((()=>[t.cons?(a(),i(y,{key:0,class:"cons-box"},{default:o((()=>[h(m,{class:"cons-text"},{default:o((()=>[k(_(t.cons),1)])),_:2},1024)])),_:2},1024)):p("",!0)])),_:2},1024),h(y,{class:"card-footer"},{default:o((()=>[h(y,{class:"stats"},{default:o((()=>[h(y,{class:"stat-item"},{default:o((()=>[h(m,{class:"icon"},{default:o((()=>[k("👁️")])),_:1}),h(m,{class:"count"},{default:o((()=>[k(_(t.viewCount||0),1)])),_:2},1024)])),_:2},1024),h(y,{class:"stat-item"},{default:o((()=>[h(m,{class:"icon"},{default:o((()=>[k("💬")])),_:1}),h(m,{class:"count"},{default:o((()=>[k(_(t.reviewCount||0),1)])),_:2},1024)])),_:2},1024),h(m,{class:"date"},{default:o((()=>[k(_(N(t.createTime)),1)])),_:2},1024)])),_:2},1024),h(m,{class:"city-tag"},{default:o((()=>[k(_(t.city),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["style","onClick"])))),128))])),_:1},8,["class"]),h(y,{class:"float-btns"},{default:o((()=>[h(y,{class:"float-btn glass-effect complaint-btn",onClick:J},{default:o((()=>[h(m,{class:"icon"},{default:o((()=>[k("📢")])),_:1})])),_:1}),h(y,{class:"float-btn glass-effect",onClick:G},{default:o((()=>[h(m,{class:"icon"},{default:o((()=>[k("✏️")])),_:1})])),_:1})])),_:1}),h(A,{ref_key:"disclaimerPopup",ref:n,type:"center"},{default:o((()=>[h(y,{class:"disclaimer-popup"},{default:o((()=>[h(y,{class:"popup-header"},{default:o((()=>[h(m,{class:"title"},{default:o((()=>[k("免责声明")])),_:1})])),_:1}),h(y,{class:"popup-content"},{default:o((()=>[h(m,{class:"text"},{default:o((()=>[k("1. 本平台仅提供信息分享服务，所有内容均来自用户发布。")])),_:1}),h(m,{class:"text"},{default:o((()=>[k("2. 用户发布的内容仅代表个人观点，请理性对待。")])),_:1}),h(m,{class:"text"},{default:o((()=>[k("3. 如发现违规内容，请及时联系我们处理。")])),_:1}),h(m,{class:"text"},{default:o((()=>[k("4. 平台保留对违规内容的处理权利。")])),_:1})])),_:1}),h(y,{class:"popup-footer"},{default:o((()=>[h($,{class:"confirm-btn",onClick:K},{default:o((()=>[k("我已了解")])),_:1})])),_:1})])),_:1})])),_:1},512),s.value.length>0?(a(),i(y,{key:0,class:"load-more"},{default:o((()=>[Y.value?(a(),i(y,{key:0,class:"loading"},{default:o((()=>[h(y,{class:"loading-icon"}),h(m,{class:"loading-text"},{default:o((()=>[k("加载中...")])),_:1})])),_:1})):f.value?p("",!0):(a(),i(m,{key:1,class:"no-more"},{default:o((()=>[k("没有更多了")])),_:1}))])),_:1})):p("",!0)])),_:1})}}}),[["__scopeId","data-v-900f66b8"]]);export{V as default};
