import{r as a,O as l,e,w as s,x as t,c,f as u,h as o,k as n,t as i,i as d,j as r,F as f,A as p,G as _,H as v,l as m,s as h,a5 as y,J as k,a1 as g,q as w,v as b,L as C,S as j,y as q,U as x,I as V,a6 as Q}from"./index-DwU0Xoyq.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=F({__name:"add",setup(F){const P=a(""),E=a([]),I=a(""),U=a("public");a([]);const J=a(!1);l((()=>({public:"ÂÖ¨ÂºÄ",friends:"‰ªÖÂ•ΩÂèãÂèØËßÅ",private:"‰ªÖËá™Â∑±ÂèØËßÅ"}[U.value])));const L=l((()=>P.value.trim()||E.value.length>0)),O=["üòä","üòÇ","ü§£","‚ù§Ô∏è","üòç","ü§î","üòí","üëç","üëé","üò≥","ü•∫","üò≠","üòò","ü§ó","üôÑ","üò¥","ü§Æ","ü§ß","üò∑","ü§í","ü§ï","üòà","üëª","üëΩ","ü§ñ","üí©","üò∫","üí™","üëä","‚úåÔ∏è","ü§û","üôè","üëè","üôå","üëê","ü§≤"],S=a(!1),T=()=>{S.value=!S.value},$=()=>{_()},A=async()=>{if(L.value){J.value=!0;try{v({title:"ÂèëÂ∏É‰∏≠..."});const{result:a}=await m.callFunction({name:"wx_add_moment",data:{content:P.value,mediaList:E.value,location:I.value,privacy:U.value,contactType:H.value,contactValue:M.value}});if(0!==a.code)throw new Error(a.msg);h({title:"ÂèëÂ∏ÉÊàêÂäü",icon:"success"}),y("refreshMoments"),setTimeout((()=>{_()}),1500)}catch(a){h({title:a.message||"ÂèëÂ∏ÉÂ§±Ë¥•",icon:"none"})}finally{k(),J.value=!1}}},D=()=>{g({count:9-E.value.length,success:async a=>{v({title:"‰∏ä‰º†‰∏≠..."});try{const l=await(async a=>{console.log("uploadImages",a[0]);try{const l=a.map((a=>new Promise(((l,e)=>{Q({url:"http://117.72.208.124:40027/api/v1/upload",filePath:a,name:"file",formData:{},success:a=>{try{const s=JSON.parse(a.data);s.status?l({type:"image",url:s.data.links.url,key:s.data.key,thumbnail_url:s.data.links.thumbnail_url}):e(new Error(s.message||"‰∏ä‰º†Â§±Ë¥•"))}catch(s){e(new Error("Ëß£Êûê‰∏ä‰º†ÁªìÊûúÂ§±Ë¥•"))}},fail:a=>{console.error("‰∏ä‰º†Â§±Ë¥•:",a),e(a)}})}))));return await Promise.all(l)}catch(l){return console.error(l),h({title:l.message||"ÂõæÁâá‰∏ä‰º†Â§±Ë¥•",icon:"none"}),[]}})(a.tempFilePaths);E.value.push(...l)}finally{k()}}})},G=a(!1),H=a("wechat"),M=a(""),N={wechat:"ËØ∑ËæìÂÖ•ÂæÆ‰ø°Âè∑",phone:"ËØ∑ËæìÂÖ•ÊâãÊú∫Âè∑",qq:"ËØ∑ËæìÂÖ•QQÂè∑",email:"ËØ∑ËæìÂÖ•ÈÇÆÁÆ±"},z=l((()=>N[H.value])),B=l((()=>{if(!M.value)return"Êú™Â°´ÂÜô";return`${{wechat:"ÂæÆ‰ø°",phone:"ÊâãÊú∫",qq:"QQ",email:"ÈÇÆÁÆ±"}[H.value]}: ${M.value}`})),K=()=>{G.value=!G.value},R=a=>{H.value=a},W=()=>{G.value=!1},X=()=>{M.value=""};return(a,l)=>{const _=b,v=t,m=C,h=j,y=q,k=x,g=V;return c(),e(v,{class:"publish-container"},{default:s((()=>[u(v,{class:"nav-bar gradient-bar"},{default:s((()=>[u(v,{class:"nav-left"},{default:s((()=>[u(_,{class:"cancel",onClick:$},{default:s((()=>[u(_,{class:"cancel-icon"},{default:s((()=>[o("‚úï")])),_:1}),o(" ÂèñÊ∂à ")])),_:1})])),_:1}),u(v,{class:"nav-center"},{default:s((()=>[u(_,{class:"nav-title"},{default:s((()=>[o("ÂèëÂ∏ÉÂä®ÊÄÅ")])),_:1})])),_:1}),u(v,{class:"nav-right"},{default:s((()=>[u(_,{class:n(["publish",{active:L.value}]),onClick:A},{default:s((()=>[o(" ÂèëË°® ")])),_:1},8,["class"])])),_:1})])),_:1}),u(v,{class:"content-area"},{default:s((()=>[u(v,{class:"input-header"},{default:s((()=>[u(_,{class:"input-label"},{default:s((()=>[o("ÂàÜ‰∫´‰Ω†ÁöÑÊÉ≥Ê≥ï")])),_:1}),u(_,{class:"char-count"},{default:s((()=>[o(i(P.value.length)+"/1000",1)])),_:1})])),_:1}),u(m,{class:"content-input",modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=a=>P.value=a),placeholder:"Ëøô‰∏ÄÂàªÁöÑÊÉ≥Ê≥ï...ÊîØÊåÅË°®ÊÉÖüòä","placeholder-style":"color: #a0aec0;",maxlength:"1000","auto-height":""},null,8,["modelValue"]),u(v,{class:"input-footer"},{default:s((()=>[u(v,{class:"emoji-toolbar"},{default:s((()=>[u(_,{class:"emoji-btn",onClick:T},{default:s((()=>[u(_,{class:"emoji-icon"},{default:s((()=>[o("üòä")])),_:1}),o(" Ë°®ÊÉÖ ")])),_:1})])),_:1}),u(v,{class:"input-actions"},{default:s((()=>[u(_,{class:n(["word-count",{warning:P.value.length>800}])},{default:s((()=>[o(i(P.value.length),1)])),_:1},8,["class"])])),_:1})])),_:1}),S.value?(c(),e(v,{key:0,class:"emoji-panel"},{default:s((()=>[u(v,{class:"emoji-header"},{default:s((()=>[u(_,{class:"emoji-title"},{default:s((()=>[o("ÈÄâÊã©Ë°®ÊÉÖ")])),_:1}),u(_,{class:"emoji-close",onClick:T},{default:s((()=>[o("‚úï")])),_:1})])),_:1}),u(h,{"scroll-x":"",class:"emoji-list"},{default:s((()=>[(c(),d(f,null,r(O,((a,l)=>u(_,{key:l,class:"emoji-item",onClick:l=>(a=>{P.value+=a})(a)},{default:s((()=>[o(i(a),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})):p("",!0)])),_:1}),(E.value.length,c(),e(v,{key:0,class:"media-area"},{default:s((()=>[u(v,{class:"media-header"},{default:s((()=>[u(_,{class:"media-title"},{default:s((()=>[o("ÁÖßÁâá")])),_:1}),u(_,{class:"media-count"},{default:s((()=>[o(i(E.value.length)+"/9",1)])),_:1})])),_:1}),u(v,{class:"media-grid"},{default:s((()=>[(c(!0),d(f,null,r(E.value,((a,l)=>(c(),e(v,{key:l,class:"media-item"},{default:s((()=>[u(v,{class:"media-wrapper"},{default:s((()=>["image"===a.type?(c(),e(y,{key:0,src:a.url,mode:"aspectFill",class:"media-img",onClick:a=>(a=>{const l=E.value.filter((a=>"image"===a.type)).map((a=>a.url));w({urls:l,current:l[a]})})(l)},null,8,["src","onClick"])):"video"===a.type?(c(),e(v,{key:1,class:"video-preview-wrap"},{default:s((()=>[u(k,{src:a.url,class:"video-preview"},null,8,["src"]),u(v,{class:"video-overlay"},{default:s((()=>[u(_,{class:"video-play-icon"},{default:s((()=>[o("‚ñ∂")])),_:1}),u(_,{class:"video-duration"},{default:s((()=>[o("00:30")])),_:1})])),_:1})])),_:2},1024)):p("",!0),u(v,{class:"media-actions"},{default:s((()=>[u(_,{class:"delete-btn",onClick:a=>(a=>{E.value.splice(a,1)})(l)},{default:s((()=>[o("‚úï")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),E.value.length<9?(c(),e(v,{key:0,class:"add-btn",onClick:D},{default:s((()=>[u(v,{class:"add-icon"},{default:s((()=>[o("+")])),_:1}),u(_,{class:"add-text"},{default:s((()=>[o("Ê∑ªÂä†")])),_:1})])),_:1})):p("",!0)])),_:1})])),_:1})),u(v,{class:"bottom-options"},{default:s((()=>[u(v,{class:"options-header"},{default:s((()=>[u(_,{class:"options-title"},{default:s((()=>[o("ÂèëÂ∏ÉËÆæÁΩÆ")])),_:1})])),_:1}),u(v,{class:"option-item",onClick:K},{default:s((()=>[u(v,{class:"option-left"},{default:s((()=>[u(_,{class:"option-icon"},{default:s((()=>[o("üìû")])),_:1}),u(_,{class:"option-label"},{default:s((()=>[o("ËÅîÁ≥ªÊñπÂºè")])),_:1})])),_:1}),u(v,{class:"option-right"},{default:s((()=>[u(_,{class:"option-value"},{default:s((()=>[o(i(B.value),1)])),_:1}),u(_,{class:"option-arrow"},{default:s((()=>[o("‚Ä∫")])),_:1})])),_:1})])),_:1})])),_:1}),G.value?(c(),e(v,{key:1,class:"contact-panel"},{default:s((()=>[u(v,{class:"cp-row"},{default:s((()=>[u(_,{class:"cp-label"},{default:s((()=>[o("ÊñπÂºè")])),_:1}),u(v,{class:"cp-types"},{default:s((()=>[u(_,{class:n(["cp-type","wechat"===H.value?"active":""]),onClick:l[1]||(l[1]=a=>R("wechat"))},{default:s((()=>[o("ÂæÆ‰ø°")])),_:1},8,["class"]),u(_,{class:n(["cp-type","phone"===H.value?"active":""]),onClick:l[2]||(l[2]=a=>R("phone"))},{default:s((()=>[o("ÊâãÊú∫")])),_:1},8,["class"]),u(_,{class:n(["cp-type","qq"===H.value?"active":""]),onClick:l[3]||(l[3]=a=>R("qq"))},{default:s((()=>[o("QQ")])),_:1},8,["class"]),u(_,{class:n(["cp-type","email"===H.value?"active":""]),onClick:l[4]||(l[4]=a=>R("email"))},{default:s((()=>[o("ÈÇÆÁÆ±")])),_:1},8,["class"])])),_:1})])),_:1}),u(v,{class:"cp-row"},{default:s((()=>[u(_,{class:"cp-label"},{default:s((()=>[o("Âè∑Á†Å/Ë¥¶Âè∑")])),_:1}),u(g,{class:"cp-input",modelValue:M.value,"onUpdate:modelValue":l[5]||(l[5]=a=>M.value=a),placeholder:z.value},null,8,["modelValue","placeholder"])])),_:1}),u(v,{class:"cp-actions"},{default:s((()=>[u(_,{class:"cp-btn ghost",onClick:X},{default:s((()=>[o("Ê∏ÖÁ©∫")])),_:1}),u(_,{class:"cp-btn primary",onClick:W},{default:s((()=>[o("ÂÆåÊàê")])),_:1})])),_:1})])),_:1})):p("",!0),J.value?(c(),e(v,{key:2,class:"tech-loading"},{default:s((()=>[(c(),d(f,null,r(4,(a=>u(v,{class:"dot",key:a}))),64)),u(_,{class:"loading-text"},{default:s((()=>[o("ÂèëÂ∏É‰∏≠...")])),_:1})])),_:1})):p("",!0)])),_:1})}}},[["__scopeId","data-v-087cb3d1"]]);export{P as default};
